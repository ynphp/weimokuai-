{template 'header'}
<link type="text/css" rel="stylesheet" href="../addons/dayu_yuyuepay/template/mobile/mobile.css" />
<style>
body{background-color:#f0f0f0;}
.title{float:left;width:100%;height:38px;color:#333;}
.title h3{font-size:14px;font-weight:bolder;margin:0;line-height:36px;}
.title span, .mobile-div ul.list span{float:right;height:25px;display:block;line-height:20px;background-color:#3bb4f2;color:#fff;padding:2px 5px;margin:5px 5px;}
.title h3 span{background-color:#fff;color:#666;font-weight:normal;font-size:14px;line-height:13px;}
.mobile-div{width:100%;margin:0;border:0;background-color:#f0f0f0;}
.mobile-hds{height:45px;line-height:45px;font-size:16px;padding:0 10px;color: #fff;border-bottom:1px solid #C6C6C6;background-color:#dd514c;}
.mobile-li{display:block;padding:0;width:96%;margin:10px auto 20px;}
.mobile-li p{height:38px;}
.time{width:100%;height:20px;background-color:#fff;margin:0;}
a.mobile-li:hover{color:#333;}
.mobile-div ul.list{float:left;line-height:25px;font-size:12px;padding:10px 10px 5px;background-color:#fdfdfd;width:100%;margin:-1px auto 10px;border:1px solid #ccc;}
.zt{float:right;font-size:16px;display:block;padding:0 10px;background-color:#f0f0f0;font-weight:bolder;text-align:center;line-height:46px;;overflow: hidden;color:#e20000;}
.info label{margin-right:2px;width:80px;text-align:right;}
.mobile-div ul.list span{background-color:#bd0000;height:58px;-webkit-border-radius: 2px;-moz-border-radius: 2px;-o-border-radius: 2px;text-align:center;line-height:28px;font-size:14px;}
.mobile-div ul.list span.no{background-color:#28507e;}

.mobile-hds .listbn{display:inline-block; height:30px; line-height:45px; padding:0; font-size:26px; color:#FFF; text-decoration:none;}
.mobile-hds .list{filter:Alpha(opacity=70);max-height:280px;list-style:none;padding:0px; background:rgba(0, 0, 0, 0.7); position:absolute; z-index:9999; right:0; overflow-x:hidden; overflow-y:scroll;}
.mobile-hds .list li > a{display:block; padding:0 10px; min-width:100px; height:35px; line-height:35px;border-bottom:1px solid #C6C6C6; font-size:14px; color:#333; text-decoration:none;}
.mobile-hds .list li > a i{display:inline-block; width:20px;}
.mobile-hds .list li > a.smtype{padding-left:15px; font-size:15px;}
</style>
{if $operation == 'display'}
<div class="mobile-div img-rounded">
	<div class="mobile-hds" style="border-bottom:0;">{if empty($activity['mname'])}我的预约{else}{$activity['mname']}{/if}列表<span class="pull-right"></span>
	<a href="javascript:;" onclick="$('.mobile-hds .list').toggleClass('hide');" class="listbn pull-right"><i class="fa fa-reorder"></i></a>
		<ul class="list hide">
		<li>
			<a href="{php echo $this->createMobileUrl('mydayu_yuyuepay', array('name' => 'dayu_yuyuepay', 'weid' => $rows[weid]))}" class="bigtype"><i class="fa fa-list-alt"></i> 全部预约主题</a>
		</li>
		{loop $list $item}
		<li>
			<a href="{php echo $this->createMobileUrl('Mydayu_yuyuepay', array('name' => 'dayu_yuyuepay', 'weid' => $item[weid], 'id' => $item[reid], 'status' => 0))}" class="bigtype"><i class="fa fa-list-alt"></i> {$item['title']}</a>
		</li>
		{/loop}
	</ul>
	</div>
	<div style='height:28px;margin:15px auto 20px;width:96%;'>
		<div {if $status==0}class='sel'{else}class="nosel"{/if} style='border-top-left-radius: 5px;border-bottom-left-radius:5px;border:1px solid #e9342a;text-align: center;float:left;width:25%' onclick="location.href='{php echo $this->createMobileUrl('mydayu_yuyuepay',array('name' => 'dayu_yuyuepay', 'weid' => $row[weid], 'id' => $reid, 'status'=>0))}'">
			待确认
		</div>
		<div {if $status==1}class='sel'{else}class="nosel"{/if} style='border:1px solid #e9342a;margin-left:-1px;float:left;width:25%;text-align: center;' onclick="location.href='{php echo $this->createMobileUrl('mydayu_yuyuepay',array('name' => 'dayu_yuyuepay', 'weid' => $row[weid], 'id' => $reid, 'status'=>1))}'">
			已确认
		</div>
		<div {if $status==2 || $status==-1}class='sel'{else}class="nosel"{/if} style='border:1px solid #e9342a;margin-left:-1px;float:left;width:25%;text-align: center;' onclick="location.href='{php echo $this->createMobileUrl('mydayu_yuyuepay',array('name' => 'dayu_yuyuepay', 'weid' => $row[weid], 'id' => $reid, 'status'=>2))}'">
			已取消
		</div>
		<div {if $status==3}class='sel'{else}class="nosel"{/if} style='border-top-right-radius: 5px;margin-left:-1px;border-bottom-right-radius:5px;text-align: center;border:1px solid #e9342a;float:left;width:25%' onclick="location.href='{php echo $this->createMobileUrl('mydayu_yuyuepay',array('name' => 'dayu_yuyuepay', 'weid' => $row[weid], 'id' => $reid, 'status'=>3))}'">
			已完成
		</div>
	</div>
	{loop $rows $item}
				<?php $xm=$this->get_xiangmu($item['reid'],$item['xmid']);?>
				<?php $yy=$this->get_yuyuepay($item['reid']);?>
	<a class="mobile-li" href="{php echo $this->createMobileUrl('Mydayu_yuyuepay', array('id' => $item['rerid'], 'op' => 'detail'))}">
	<div class="title tag">
				<span>
				{if $item['status'] == 0} 等待客服确认
                {elseif $item['status'] == 1} 客服已确认
                {elseif $item['status'] == 2} 被拒绝受理
                {elseif $item['status'] == 3} 完成预约
                {elseif $item['status'] == -1} 我已取消预约
				{/if}
				</span>
				<h3><i class="fa fa-user"></i> {$item['member']}<span><i class="fa fa-tablet"></i> {$item['mobile']}</span></h3></div>
            <ul class="list">
				
				{if $item['paystatus'] == 1}<span class="no">未支付<br>{if $item['paytype'] == 1}在线支付{elseif $item['paytype'] == 2}店付或面付{/if}</span>
                {elseif $item['paystatus'] == 2}<span>已支付<br>{if $item['paytype'] == 1}在线支付{elseif $item['paytype'] == 2}店付或面付{/if}</span>
				{/if}
				
                <li>预约主题：{$yy['title']}<br>
					预约内容：{$xm['title']} - <i class="fa fa-rmb">{$item['price']}</i><br>
                    {if $activity['is_time'] == 0}{$yy['yuyuename']}：{php echo date('Y年m月d日 H:i', $item['yuyuetime'])}{/if}
                </li>
            </ul>
	</a>
	{/loop}
<div style='margin:5px auto;width:96%;'>{$pager}</div>
</div>
{elseif $operation == 'detail'}
<style>
.pay span{float:right;display:inline-block;font-weight:bold}
</style>
				<?php $xm=$this->get_xiangmu($row['reid'],$row['xmid']);?>
<div class="mobile-div img-rounded">
	<div class="mobile-hds">预约状态
	<span class="zt">
            {if $row['status'] == 0} <em class="no">等待客服确认</em>
                {elseif $row['status'] == 1} <em class="no"><font color="red">客服已确认</font></em> 
                {elseif $row['status'] == 2} <em class="no"><font color="red">该预约被拒绝受理</font></em> 
                {elseif $row['status'] == 3} <em class="no"><font color="green">已完成</font></em> 	
                {elseif $row['status'] == -1} <em class="no"><font color="red">我已取消预约</font></em>
            {/if}
	</span>
	</div>
	{if !empty($dish)}<div class="mobile-content">客服答复：{$row['kfinfo']}</div>{/if}
{if $row['status'] == 0}
<script>
function conf()
{
if(confirm("您确定要取消预约吗？"))
return true;
else
return false;
}
</script>
	<div class="mobile-content">
    <form class="form" method="post" id="form" action="">
	<div style="display:none">
        <select id="status" name="status" class="form-control">
             <option value="-1" {if $row['status'] == -1}selected="selected"{/if}>取消我的预约</option>
        </select>
	</div>
    <input type="hidden" name="id" value="{$row['rerid']}" />
    <button type="submit" name="button" class="btn btn-primary span3" onclick="return conf();">取 消 预 约</button> 
    <input type="hidden" name="token" value="{$_W['token']}" />
    </form>
	</div>
{/if}
</div>

{if $row['status'] == 1 && $dayu_yuyuepay['code'] == 1}
<div class="mobile-div img-rounded">
	<div class="mobile-hds">到店后请出示二维码
	</div>
	<div class="mobile-content" style="margin:10px auto;text-align:center;"><img src="../addons/dayu_yuyuepay/hexiao/hexiao{$id}.png"></div>
</div>
{/if}
<div class="mobile-div img-rounded">
	<div class="mobile-hds pay" style="background-color:#0e90d2">我的预约信息	
				<span>{if $row['paystatus'] == 1}未支付 - {if $row['paytype'] == 1}在线支付{elseif $row['paytype'] == 2}店付或面付{/if}
                {elseif $row['paystatus'] == 2}已支付 - {if $row['paytype'] == 1}在线支付{elseif $row['paytype'] == 2}店付或面付{/if}
				{/if}</span>
	</div>
	<div class="mobile-content info">
	<p><label>订单编号：</label>{$row['ordersn']}</p>
	<p><label>客户姓名：</label>{$row['member']}</p>
	<p><label>客户手机：</label>{$row['mobile']}</p>
	<p><label>服务项目：</label>{$xm['title']} <i class="fa fa-rmb">{$row['price']}</i></p>
	<p><label>提交时间：</label>{php echo date('Y年m月d日 H:i', $row['createtime'])}</p>
	{if $dayu_yuyuepay['is_time'] == 0}<p><label>预约时间：</label>{php echo date('Y年m月d日 H:i', $row['yuyuetime'])}</p>{/if}
			{loop $dayu_yuyuepay['fields'] $item}
	<p><label>{$item['title']}：</label>
				{if $item['type'] == 'image'}
	<a target="_blank" href="{php echo tomedia($item['data']);}" class="btn">点击查看附件</a>
				{else}
	<span class="label label-success" style="font-size:12px;">{if !empty($item['data'])}{$item['data']}{else}无{/if}</span>
				{/if}
	</p>
			{/loop}
	</div>
</div>
{if $row['paystatus'] != 2}
{if $row['status'] != 2 || $row['status'] != -1}
{if $row['paytype'] != 2}
<a class="btn btn-primary span3" style="width:90%;margin:8px auto 30px;display:block;height:45px;line-height:36px;font-size:18px;color:#fff;" href="{php echo $this->createMobileUrl('pay', array('orderid' => $row['rerid'],'weid'=>$_GPC['weid'],'id'=>$_GPC['id']))}">未支付 现在去付款</a>
{/if}
{/if}
{/if}
<div class="mobile-div img-rounded">
	<div class="mobile-hds" style="background-color:#f37b1d">{$dayu_yuyuepay['title']}</div>
	<div class="mobile-content">{$dayu_yuyuepay['content']}</div>
</div>
{/if}
{template 'footer'}
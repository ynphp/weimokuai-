var app=angular.module("app",["infinite-scroll","ngSanitize","oitozero.ngSweetAlert","timer"]);app.controller("pageloadController",["$scope",function(e){e.dohide=false;e.$on("pageload-hide",function(t,o){e.dohide=o})}]);app.factory("TabData",function(){var e={op:"normal",tabs:[{name:"即将开始",op:"begin"},{name:"进行中",op:"normal"},{name:"往期",op:"past"}]};return e});app.controller("tabController",["$scope","TabData",function(e,t){e.op=t.op;e.tabs=t.tabs;e.tabclick=function(o){e.op=o.op;t.op=o.op}}]);app.factory("Reddit",["$rootScope","$http","TabData",function(e,t,o){var r=function(){this.items=[];this.load=false;this.page=1;this.last=false};r.prototype.nextPage=function(){if(this.load||this.last)return;this.load=true;var r=LIST_URL;t.post(r,{page:this.page,op:o.op}).success(function(t){for(var o=0;o<t.length;o++){this.items.push(t[o])}this.page+=1;this.load=false;if(t.length<=0){this.last=true}e.$broadcast("pageload-hide",true)}.bind(this))};return r}]);app.controller("scrollController",["$scope","Reddit","TabData",function(e,t,o){e.reddit=new t;e.$watch(function(){return o.op},function(t,o){if(t!=o){e.reddit.items=[];e.reddit.load=false;e.reddit.page=1;e.reddit.last=false;e.reddit.nextPage()}})}]);app.factory("Kanjia",["$rootScope","$http",function(e,t){var o=function(){this.obj={};this.shownotice=false};o.prototype.loaddetail=function(){var o=KANJIA_DETAIL_URL;t.get(o).success(function(t){this.obj=t;e.$broadcast("pageload-hide",true)}.bind(this))};o.prototype.showNotice=function(){this.shownotice=true};o.prototype.HideNotice=function(){this.shownotice=false};return o}]);app.controller("detailController",["$scope","Kanjia",function(e,t){e.kanjia=new t;e.kanjia.loaddetail()}]);app.factory("Record",["$http",function(e){var t=function(){this.obj={}};t.prototype.loadmykanjia=function(){e.get(KANJIA_MY_URL).success(function(e){this.obj=e}.bind(this))};return t}]);app.controller("recordController",["$scope","$http","Record","SweetAlert",function(e,t,o,r){e.helpstatus=false;e.record=new o;e.record.loadmykanjia();e.buy=function(e){var o=KANJIA_BUY_URL;t.post(o,{id:e}).success(function(e){if(e.errcode==0){r.swal({title:"购买失败",text:"亲，您又调皮了！",type:"error",confirmButtonText:"关闭"})}else if(e.errcode==1e4){r.swal({title:"购买失败",text:"获取不到您的粉丝信息，请先关注我们吧~",type:"warning",showCancelButton:true,confirmButtonColor:"#DD6B55",confirmButtonText:"关注",closeOnConfirm:false,cancelButtonText:"关闭",animation:false},function(t){if(t){window.location.href=e.href}})}else if(e.errcode==10001){r.swal({title:"购买失败",text:"亲，这不是您的砍价哦~",type:"error",confirmButtonText:"关闭"})}else if(e.errcode==10002){r.swal({title:"购买失败",text:"亲，您已经下单啦，我们会尽快处理的~",type:"error",confirmButtonText:"关闭"})}else if(e.errcode==10003){r.swal({title:"购买失败",text:"亲，请在活动时间内购买~",type:"error",confirmButtonText:"关闭"})}else if(e.errcode==10004){r.swal({title:"购买失败",text:"亲，您来晚了，已经抢购一空了~",type:"error",confirmButtonText:"关闭"})}else if(e.errcode==10005){r.swal({title:"购买失败",text:"亲，您还没砍到底价呢~",type:"error",confirmButtonText:"关闭"})}else if(e.errcode==1){window.location.href=e.href}else if(e.errcode==2){r.swal({title:"人工处理",text:"亲，请您通过下方的联系方式和客服沟通购买商品。~",type:"success",confirmButtonText:"确定"})}else{r.swal({title:"未知错误",text:"请稍后再试试~",type:"error",confirmButtonText:"关闭"})}})};e.help=function(o){var n=KANJIA_HELP_URL;t.post(n,{id:o}).success(function(t){if(t.errcode==0){r.swal({title:"帮砍失败",text:"亲，您又调皮了！",type:"error",confirmButtonText:"关闭"})}else if(t.errcode==1e4){r.swal({title:"帮砍失败",text:"获取不到您的粉丝信息，请先关注我们吧~",type:"warning",showCancelButton:true,confirmButtonColor:"#DD6B55",confirmButtonText:"关注",closeOnConfirm:false,cancelButtonText:"关闭",animation:false},function(e){if(e){window.location.href=t.href}})}else if(t.errcode==10001){r.swal({title:"帮砍失败",text:"亲，您已帮该好友砍过了~",type:"error",confirmButtonText:"关闭"})}else if(t.errcode==10002){r.swal({title:"帮砍失败",text:"亲，已经砍到底价了，再砍小编就要睡大街了~",type:"error",confirmButtonText:"关闭"})}else if(t.errcode==10003){r.swal({title:"帮砍失败",text:"亲，您的雷锋精神深深感动了小编，请放下小刀休息会吧~",type:"error",confirmButtonText:"关闭"})}else if(t.errcode==1){e.record.obj.price=parseFloat(e.record.obj.price)-parseFloat(t.price);e.record.obj.number_help=parseInt(e.record.obj.number_help)+1;r.swal({title:t.price+"元",text:"亲，您的小刀一挥便砍了这么多~",type:"success",confirmButtonText:"确定"})}else{r.swal({title:"未知错误",text:"请稍后再试试~",type:"error",confirmButtonText:"关闭"})}})};e.needhelp=function(){e.helpstatus=true};e.closehelp=function(){e.helpstatus=false}}]);app.controller("helpController",["$scope","$http",function(e,t){e.helplist={};t.post(KANJIA_HELPLIST_URL,{rid:KANJIA_RECORD_ID}).success(function(t){e.helplist.items=t})}]);app.controller("buyController",["$scope","$http","SweetAlert",function(e,t,o){e.address={};e.showAddress=false;e.pay=false;e.remark="";e.weixinAddress=function(){WeixinJSBridge.invoke("editAddress",ADDRESS_TOKEN,function(t){if(t.err_msg=="edit_address:ok"){e.showAddress=true;e.address.name=t.userName;e.address.telnumber=t.telNumber;e.address.address=t.proviceFirstStageName+t.addressCitySecondStageName+t.addressCountiesThirdStageName+t.addressDetailInfo;e.$apply()}else{o.swal({title:"获取地址失败",text:"亲，请刷新后再试试~",type:"error",confirmButtonText:"关闭"})}})};e.WechatPay=function(r,n){if(e.address.address==undefined||e.address.address==""){o.swal({title:"支付失败",text:"亲，先选择好您的收货地址",type:"error",confirmButtonText:"关闭"});return false}e.pay=true;t.post(KANJIA_UNIFIEDORDER_URL,{id:r}).success(function(i){if(i.errcode!=undefined){if(i.errcode==0){o.swal({title:"支付失败",text:"亲，改砍价记录不存在哦~",type:"error",confirmButtonText:"关闭"})}else if(i.errcode==10001){o.swal({title:"支付失败",text:"亲，您已下过单了，请不要再次下单啦~",type:"error",confirmButtonText:"关闭"})}else if(i.errcode==10002){o.swal({title:"支付失败",text:"亲，管理员忘记开启支付功能，联系下管理员呗~",type:"error",confirmButtonText:"关闭"})}else if(i.errcode==10003){o.swal({title:"支付失败",text:"亲，您来晚了，已经抢购一空了~",type:"error",confirmButtonText:"关闭"})}else if(i.errcode==1){t.post(KANJIA_ORDER_SAVE_URL,{id:r,remark:n,address:e.address}).success(function(t){e.pay=false;if(t.errcode==0){o.swal({title:"砍价记录",text:"亲，您确定该砍价记录是对的？",type:"error",confirmButtonText:"关闭"})}else if(t.errcode==1){o.swal({title:"支付成功",text:"我们会尽快为您处理该订单。",type:"success",showCancelButton:false,confirmButtonColor:"#DD6B55",confirmButtonText:"确定",closeOnConfirm:false,animation:false},function(e){window.location.href=KANJIA_URL})}else if(t.errcode==10001){o.swal({title:"支付失败",text:"亲，您已下过单了，请不要再次下单啦~",type:"error",confirmButtonText:"关闭"})}else if(t.errcode==10002){o.swal({title:"支付失败",text:"亲，保存订单时出错了，请联系管理员~",type:"error",confirmButtonText:"关闭"})}else{o.swal({title:"未知错误",text:"请稍后再试试~",type:"error",confirmButtonText:"关闭"})}})}e.pay=false;return false}wx.chooseWXPay({timestamp:i.timeStamp,nonceStr:i.nonceStr,"package":i.package,signType:i.signType,paySign:i.paySign,success:function(s){console.log("a");if(s.errMsg=="chooseWXPay:ok"){t.post(KANJIA_ORDER_SAVE_URL,{id:r,remark:n,data:i,address:e.address}).success(function(t){e.pay=false;if(t.errcode==0){o.swal({title:"砍价记录错误",text:"亲，您确定该砍价记录是对的？",type:"error",confirmButtonText:"关闭"})}else if(t.errcode==1){o.swal({title:"支付成功",text:"我们会尽快为您处理该订单。",type:"success",showCancelButton:false,confirmButtonColor:"#DD6B55",confirmButtonText:"确定",closeOnConfirm:false,animation:false},function(e){window.location.href=KANJIA_URL})}else if(t.errcode==10001){o.swal({title:"支付失败",text:"亲，您已下过单了，请不要再次下单啦~",type:"error",confirmButtonText:"关闭"})}else if(t.errcode==10002){o.swal({title:"支付失败",text:"亲，保存订单时出错了，请联系管理员~",type:"error",confirmButtonText:"关闭"})}else{o.swal({title:"未知错误",text:"请稍后再试试~",type:"error",confirmButtonText:"关闭"})}})}else{e.pay=false}},fail:function(t){e.pay=false;o.swal({title:"支付失败",text:"请稍后再试试~",type:"error",confirmButtonText:"关闭"})},cancel:function(){e.pay=false;e.$apply()}})})}}]);app.factory("TopReddit",["$rootScope","$http",function(e,t){var o=function(){this.items=[];this.load=false;this.page=1;this.last=false};o.prototype.nextPage=function(){if(this.load||this.last)return;this.load=true;var o=KANJIA_TOP_URL;t.post(o,{page:this.page,id:KANJIA_ID}).success(function(t){for(var o=0;o<t.length;o++){this.items.push(t[o])}this.page+=1;this.load=false;if(t.length<=0){this.last=true}e.$broadcast("pageload-hide",true)}.bind(this))};return o}]);app.controller("topController",["$scope","TopReddit",function(e,t){e.topreddit=new t}]);
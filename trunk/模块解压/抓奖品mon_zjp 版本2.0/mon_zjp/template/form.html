<style>
    .red {
        color: red;
    }
</style>
<input type="hidden" name="zid" value="{$reply['id']}"/>

<div class="panel panel-default">
    <div class="panel-heading">
        基本设置
    </div>
    <div class="panel-body">

        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style='color:red'>*</span> 活动名称：</label>

            <div class="col-sm-9 col-xs-12">
                <input type="text" id="title" class="form-control span7"
                       placeholder="" name="title" value="{$reply['title']}">
            </div>
        </div>


        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span class='red'>*</span>活动开始时间：</label>

            <div class="col-sm-9 col-xs-12">
                {php echo tpl_form_field_date('starttime',$reply['starttime'],true)}
            </div>
        </div>

        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span class='red'>*</span>活动结束时间：</label>

            <div class="col-sm-9 col-xs-12">
                {php echo tpl_form_field_date('endtime',$reply['endtime'],true)}
            </div>
        </div>


        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span class='red'>*</span>活动首页背景：</label>

            <div class="col-sm-9 col-xs-12">
                {php echo tpl_form_field_image('index_pic',$reply['index_pic'],$this->defaultImg(0));}
                建议宽*高(720*1031)
            </div>
        </div>


        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span class='red'>*</span>活动宣传图片：</label>

            <div class="col-sm-9 col-xs-12">
                {php echo tpl_form_field_image('banner_ad_pic',$reply['banner_ad_pic'],$this->defaultImg(2));}
                建议宽*高(519*451)
            </div>
        </div>




        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span class='red'>*</span>每个用户抽奖次数</label>

            <div class="col-sm-9 col-xs-12">
                <div class="input-group">
                    <input type="text" name="play_count" id="play_count" class="form_time form-control"
                           value="{if $reply['play_count']}{$reply['play_count']}{else}1{/if}">
                                    <span class="input-group-addon">
                                       次/人
                                    </span>
                </div>

            </div>
        </div>


        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span class='red'>*</span>每天抽奖次数限制</label>

            <div class="col-sm-9 col-xs-12">
                <div class="input-group">
                    <input type="text" name="day_play_count" id="day_play_count" class="form_time form-control"
                           value="{if $reply['day_play_count']}{$reply['day_play_count']}{else}1{/if}">
                                    <span class="input-group-addon">
                                       次/人
                                    </span>
                </div>

            </div>
        </div>



        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span class='red'>*</span>每个用户中奖次数限制：</label>

            <div class="col-sm-9 col-xs-12">
                <div class="input-group">
                    <input type="text" name="u_award_count" id="award_count" class="form_time form-control"
                           value="{if $reply['u_award_count']}{$reply['u_award_count']}{else}1{/if}">
                                    <span class="input-group-addon">
                                       人/次
                                    </span>
                </div>

            </div>
        </div>




        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span class='red'>*</span>关注图文介绍链接：</label>

            <div class="col-sm-9 col-xs-12">
                <input type="text" id="follow_url" class="form-control span7"
                       placeholder="" name="follow_url" value="{$reply['follow_url']}">
            </div>
        </div>


        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span class='red'>*</span>奖品说明：</label>

            <div class="col-sm-9 col-xs-12">
                <textarea name="prize_intro" class="form-control span7 richtext" id="prize_intro" cols="70">{$reply['prize_intro']}</textarea>
            </div>
        </div>


        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span class='red'>*</span>活动说明：</label>

            <div class="col-sm-9 col-xs-12">
                <textarea name="rule_intro" class="form-control span7 richtext" id="rule_intro" cols="70">{$reply['rule_intro']}</textarea>
            </div>
        </div>


        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span class='red'>*</span>分享奖励设置：</label>


            <div class="col-sm-9" style="margin-top:5px;">

                <div class="checkbox  col-sm-1">

                    <label>
                        <input type="checkbox" id="share_award_enable" name="share_award_enable" {if $reply['share_award_enable']==1}checked="checked"{/if} value="{$reply['share_award_enable']}" >启用
                    </label>
                </div>

                <div class="input-group col-sm-4" style="float:left">
                    <span class="input-group-addon">每个用奖励次数</span>
                    <input type="text" class="form-control span1" name="share_award_count" value="{$reply['share_award_count']}">
                    <span class="input-group-addon">次</span>

                </div>
                <div class="input-group col-sm-4" style="float:left">
                    <span class="input-group-addon">每次分享奖励抽奖机会</span>
                    <input type="text" class="form-control span1" name="share_award_time" value="{$reply['share_award_time']}">
                    <span class="input-group-addon">次</span>
                </div>

            </div>


        </div>




        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span class='red'>*</span>我的奖品分享按钮名称：</label>

            <div class="col-sm-9 col-xs-12">
                <input type="text" class="form-control span1" name="prize_sharebtn_name" value="{if $reply['prize_sharebtn_name'] }{$reply['prize_sharebtn_name']}{else}邀请好友参加活动{/if}">
            </div>
        </div>


        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span class='red'>*</span>中奖名单分享按钮文字：</label>

            <div class="col-sm-9 col-xs-12">
                <input type="text" class="form-control span1" name="luck_sharebtn_name" value="{if $reply['luck_sharebtn_name'] }{$reply['luck_sharebtn_name']}{else}邀请好友参加活动{/if}">
            </div>
        </div>




        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span class='red'>*</span>分享奖励提示文字：</label>

            <div class="col-sm-9 col-xs-12">
                <input type="text" class="form-control span1" name="lock_tip" value="{if $reply['lock_tip'] }{$reply['lock_tip']}{else}不勇敢点,永远不知道好运什么时候临幸自己{/if}">
            </div>
        </div>


<!--  随机广告语-->
        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span class='red'>*</span>抽奖对话框随机广告语：</label>

            <div class="col-sm-9 col-xs-12">
                <textarea name="dialog_tips" class="form-control span7 richtext" id="dialog_tips" cols="70">{if $reply['dialog_tips']}{$reply['dialog_tips']}{else}{php echo CRUD::$DIALOG_MSG}{/if}</textarea>
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"></label>
            <div class="help-block col-sm-9 col-xs-12">每句广告语直接请以回车换行进行分隔！</div>
        </div>




        <!--  中奖广告语-->
        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span class='red'>*</span>中奖广告语：</label>

            <div class="col-sm-9 col-xs-12">
                <textarea name="success_award_tips" class="form-control span7 richtext" id="success_award_tips" cols="70">{if $reply['success_award_tips']}{$reply['success_award_tips']}{else}{php echo CRUD::$SUCC_MSG}{/if}</textarea>
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"></label>
            <div class="help-block col-sm-9 col-xs-12">每句广告语直接请以回车换行进行分隔！</div>
        </div>






        <!--  没有中奖广告语-->
        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span class='red'>*</span>没有中奖广告语：</label>

            <div class="col-sm-9 col-xs-12">
                <textarea name="fail_award_tips" class="form-control span7 richtext" id="fail_award_tips" cols="70">{if $reply['fail_award_tips']}{$reply['fail_award_tips']}{else}{php echo CRUD::$FAIL_MSG}{/if}</textarea>
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"></label>
            <div class="help-block col-sm-9 col-xs-12">每句广告语直接请以回车换行进行分隔！</div>
        </div>
















    </div>

</div>


<div class="panel panel-default">
    <div class="panel-heading">
        奖品设置
    </div>
    <div class="panel-body">

        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"></label>

            <div class="col-sm-9 col-xs-12">
                <span class="label label-danger" id="p_text">未中奖概率:100%</span>
                <table class="table table-hover">
                    <thead>
                    <tr>
                        <th width="60px">排序</th>
                        <th width="100px">奖品名称</th>
                        <th width="100px">奖品说明</th>
                        <th width="80px">奖品数量</th>
                        <th width="80px">奖品单位</th>
                        <th width="80px">中奖概率</th>
                        <th width="150px">奖品图片(大小69*78)</th>
                        <th width="200px">操作</th>
                    </tr>
                    </thead>

                    <tbody class="prize-items">


                    {loop $prizes $pr}
                        <tr>
                            <td><input type="text" class="form-control" name="sort[]" value="{$pr['sort']}"/></td>
                            <td><input type="text" class="form-control" name="pname[]" value="{$pr['pname']}"/></td>
                            <td><input type="text" class="form-control" name="psummary[]" value="{$pr['psummary']}"/></td>
                            <td><input type="text" class="form-control" name="count[]" value="{$pr['count']}"/></td>
                            <td><input type="text" class="form-control" name="unit[]" value="{$pr['unit']}"/></td>

                            <td><input type="text" class="form-control" name="percent[]" value="{$pr['percent']}" onkeyup="pChange();"/></td>
                            <td>
                                <div id="img_div">
                                    <img src="{if $pr['picon']}{$_W['attachurl']}{$pr['picon']}{else}{php echo $this->defaultImg(1)}{/if}"
                                                       style="max-width: 80px; max-height: 80px;">
                                    <input name="picon[]" type="hidden" value="{$pr['picon']}" />
                                </div>
                            </td>

                            <td><input name="pids[]" type="hidden" value="{$pr['id']}"/><span onclick="upimg(this)"
                                                                                   class="btn btn-primary"><i
                                    class="fa fa-plus"></i>上传图片</span>&nbsp;<a href="javascript:;"
                                                                               onclick="removePrize(this)"><i class="glyphicon glyphicon-remove"></i> 删除</a></td>

                        </tr>

                    {/loop}


                    </tbody>

                </table>
            </div>
        </div>


        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"></label>

            <div class="col-sm-9 col-xs-12">
                <a href="javascript:void(0);" onclick="addPrize();"><i class="gglyphicon glyphicon-plus"
                                                                       title="添加奖品"></i>添加奖品</a>
            </div>
        </div>


    </div>

</div>


<div class="panel panel-default">
    <div class="panel-heading">
        图文设置
    </div>
    <div class="panel-body">

        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span class='red'>*</span>图文标题：</label>

            <div class="col-sm-9 col-xs-12">
                <input type="text" id="new_title" class="form-control span7" placeholder="" name="new_title"
                       value="{$reply['new_title']}">
            </div>
        </div>


        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span class='red'>*</span>图文 图标：</label>

            <div class="col-sm-9 col-xs-12">
                {php echo tpl_form_field_image('new_icon',$reply['new_icon']);}
            </div>
        </div>

        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span class='red'>*</span>图文描述：</label>

            <div class="col-sm-9 col-xs-12">
			<textarea style="height: 60px;" name="new_content"
                      class="form-control span7" cols="60">{$reply['new_content']}</textarea>
            </div>
        </div>


    </div>
</div>


<div class="panel panel-default">
    <div class="panel-heading">
        分享设置
    </div>
    <div class="panel-body">

        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span class='red'>*</span>分享标题：</label>

            <div class="col-sm-9 col-xs-12">
                <input type="text" id="share_title" class="form-control span7" placeholder="" name="share_title"
                       value="{$reply['share_title']}">
            </div>
        </div>


        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span class='red'>*</span>分享图标：</label>

            <div class="col-sm-9 col-xs-12">
                {php echo tpl_form_field_image('share_icon',$reply['share_icon']);}
            </div>
        </div>

        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span class='red'>*</span>分享描述：</label>

            <div class="col-sm-9 col-xs-12">
			<textarea style="height: 60px;" name="share_content"
                      class="form-control span7" cols="60">{$reply['share_content']}</textarea>
            </div>
        </div>


    </div>
</div>


<script>

    require(['jquery', 'util'], function ($, u) {
        $(function () {
            u.editor($('#prize_intro')[0]);
            u.editor($('#rule_intro')[0]);
        });
    });


</script>


<script type="text/javascript">



</script>


<script>


    $(function(){


        pChange();
       $("#share_award_enable").click(function(){



           if($(this).get(0).checked){

               $(this).val(1);
           }else{
               $(this).val(0);
           }


       });

    });

    function pChange(){

        var totalP=0;

         $(".prize-items tr input[name='percent[]']").each(function () {

            var vp=$(this).val();


             if(!isNaN(vp)){

                 totalP+=parseInt(vp);

             }



         });




        $("#p_text").html("未中奖概率:"+(100-totalP)+"%");





    }

    /**
     * 添加奖品
     */
    function addPrize() {


        var index = $(".prize-items tr").length + 1;
        var html = "<tr>";
        html += '<td><input type="text" class="form-control" name="sort[]"  value="' + index + '"/></td>';
        html += '<td><input type="text" class="form-control" name="pname[]"  value=""/></td>';
        html += '<td><input type="text" class="form-control" name="psummary[]"  value=""/></td>';
        html += '<td><input type="text" class="form-control" name="count[]"  value="1"/></td>';
        html += '<td><input type="text" class="form-control" name="unit[]"  value="台"/></td>';
        html += '<td><input type="text" class="form-control" name="percent[]"  value="0" onkeyup="pChange();" /></td>';
        html += '<td><div id="img_div"><img src="{php echo $this->defaultImg(1)}" style="max-width: 80px; max-height: 80px;"></div></td>';

        html += '<td> <input  name="pids[]" type="hidden" value="" /><span onclick="upimg(this)" class="btn btn-primary"><i class="fa fa-plus"></i>上传图片</span>&nbsp;<a href="javascript:;" onclick="removePrize(this)" ><i class="glyphicon glyphicon-remove"></i> 删除</a></td>';

        html += "</tr>";

        $(".prize-items").append(html);






    }

    function upimg(obj) {


        require(['jquery', 'util'], function ($, util) {

            util.image('', function (data) {
                $(obj).parent().parent().find('#img_div').html('<img src="' + data['url'] + '" style="max-width: 80px; max-height: 80px;"><input name="picon[]" type="hidden" value="' + data['filename'] + '" />');

            });

        });


    }
    function removePrize(obj) {


       var pid= $(obj).parent().parent().find("input[name='pids[]']").val();

        if(pid!=""){

            $.post("{php echo $this->createWebUrl('DeletePrize')}",{"pid":pid},function(res){


                if(res.code==200){
                    $(obj).parent().parent().remove();
                    pChange();

                }else{

                    alert("该奖品有用户中奖记录不能删除！请删除该奖品的用户中奖记录后再删除此奖品！");
                }


            },'json');


        }else{
            $(obj).parent().parent().remove();
            pChange();
        }



    }


</script>

<!DOCTYPE html>
<head>
  <meta charset=utf-8"utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>{$keyword}活动</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="{RES}style/shake/css/style.css"  media="screen" rel="stylesheet" type="text/css" />
  <script src="{RES}style/shake/js/shake.js"  type="text/javascript"></script>
<script src="{RES}style/js/jquery-1.8.3.min.js" ></script>
<style type="text/css">
			    #fulls {
background-color:#ccc;
width: 35px;
height: 35px;
float:left;
background: url({RES}icons.png) no-repeat;
text-indent: -9999em;
margin:10px;
margin-left:25px;
background-position: 0 -40px;
}
.bg-bottom {
	position: absolute;
	width: 100%;
	height: 208px;
	left: 0;
	bottom: 116px
}

.bg-bottom-game {
	bottom: -600px;
	background-size: 100% 100%
}
{if !empty($ridwall['background'])}

 .html {
 background: url("{$_W['attachurl']}{$ridwall['background']}");
 }
{else}
.bg-bottom {background: url("{RES}style/shake/images/bottom_bg.jpg");}
.bg-bottom-game {background: url("{RES}style/shake/images/bottom_bg_game.png") no-repeat;} 
{/if}

{if !empty($ridwall['user1']) && !strexists($ridwall['user1'],'shake')}
    .user-1 {background-image: url("{$_W['attachurl']}{$ridwall['user1']}")}
{else}
   .user-1 {background-image: url("{RES}style/shake/images/user_1.png")}
{/if}
{if !empty($ridwall['user2']) && !strexists($ridwall['user2'],'shake')}
    .user-2 {background-image: url("{$_W['attachurl']}{$ridwall['user2']}")}
{else}
   .user-2{background-image: url("{RES}style/shake/images/user_2.png")}
{/if}
{if !empty($ridwall['user3']) && !strexists($ridwall['user3'],'shake')}
    .user-3 {background-image: url("{$_W['attachurl']}{$ridwall['user3']}")}
{else}
   .user-3{background-image: url("{RES}style/shake/images/user_3.png")}
{/if}
{if !empty($ridwall['user4']) && !strexists($ridwall['user4'],'shake')}
    .user-4 {background-image: url("{$_W['attachurl']}{$ridwall['user4']}")}
{else}
   .user-4 {background-image: url("{RES}style/shake/images/user_4.png")}
{/if}
{if !empty($ridwall['user5']) && !strexists($ridwall['user1'],'shake')}
    .user-5{background-image: url("{$_W['attachurl']}{$ridwall['user5']}")}
{else}
   .user-5{background-image: url("{RES}style/shake/images/user_5.png")}
{/if}
{if !empty($ridwall['user6']) && !strexists($ridwall['user6'],'shake')}
    .user-6 {background-image: url("{$_W['attachurl']}{$ridwall['user6']}")}
{else}
   .user-6{background-image: url("{RES}style/shake/images/user_6.png")}
{/if}
{if !empty($ridwall['user7']) && !strexists($ridwall['user7'],'shake')}
    .user-7 {background-image: url("{$_W['attachurl']}{$ridwall['user7']}")}
{else}
   .user-7{background-image: url("{RES}style/shake/images/user_7.png")}
{/if}
{if !empty($ridwall['user8']) && !strexists($ridwall['user8'],'shake')}
    .user-8 {background-image: url("{$_W['attachurl']}{$ridwall['user8']}")}
{else}
   .user-8{background-image: url("{RES}style/shake/images/user_8.png")}
{/if}
</style>
</head>
<body>
  
<div class="html">
  <div class="index">
    <div class="index-logo">
      <a class="btn-start"></a>
    </div>
    <div class="airplane" id="airplane"></div>
    <div class="index-number mod-number">
      当前已有<span><i>0</i></span>人加入
    </div>
  </div>
    <div class="index-users">
        <div class="index-users-li index-1 animate-move-clound">
          <div class="user user-3 animate-move-user-1"></div>
          <div class="clound clound-1">
            <i></i>
            <em></em>
          </div>
        </div>
        <div class="index-users-li index-2 animate-move-clound">
          <div class="user user-6 animate-move-user-2"></div>
          <div class="clound clound-2">
            <i></i>
            <em></em>
          </div>
        </div>
        <div class="index-users-li index-3 animate-move-clound">
          <div class="user user-4 animate-move-user-3"></div>
          <div class="clound clound-3">
            <i></i>
            <em></em>
          </div>
        </div>
        <div class="index-users-li index-4 animate-move-clound">
          <div class="user user-5 animate-move-user-4"></div>
          <div class="clound clound-4">
            <i></i>
            <em></em>
          </div>
        </div>
        <div class="index-users-li index-5 animate-move-clound">
          <div class="user user-8 animate-move-user-5"></div>
          <div class="clound clound-5">
            <i></i>
            <em></em>
          </div>
        </div>
        <div class="index-users-li index-6 animate-move-clound">
          <div class="user user-7 animate-move-user-6"></div>
          <div class="clound clound-6">
            <i></i>
            <em></em>
          </div>
        </div>
    </div>
  <div class="bg-shine animate-twinkling" id="bg-shine"></div>
  <section id="game">
    <div class="game">
	  <div class="game-code mod-code" style="float:left">
        <div>
          
          <p><span><img src="{$_W['attachurl']}{$ridwall['logo']}"></span></p>
		  <p>
            <span>
              <span class="animate-move-right"><strong>{$ridwall['power']}</strong></span>
			  
            </span>
          </p>
        </div>
      </div>
	  <div onclick="requestFullScreen()" id="fulls" ></div>
      <div class="game-code mod-code">
        <div>
          <p>
            <span>
              <span class="animate-move-left"><span>扫描二维码或搜索 “ <strong>{$_W['account']['name']}</strong> ” 关注</span><i class="bg-arrow"></i></span>
              <small>并发送“{$keyword}”即可参与</small>
            </span>
          </p>
          <p><span><img src="{$_W['attachurl']}{$cfg['erweima']}"  class="bottom-code"></span></p>
        </div>
      </div>
    </div>
    <div class="pop-time" id="countDown">
      <p>
          <i class="number number-8"></i>
      </p>
    </div>
    <div class="list">
        <div class="list-li list-1" id="list-1">
          <div class="list-user"><img src="{RES}style/shake/images/user.png" ></div>
          <div class="list-progress">
            <div class="list-name"><p></p></div>
            <div class="progress-bar">
              <span></span>
            </div>
            <div class="progress-user">
              <span></span>
              <div class="user user-1 animate-move-user"></div>
            </div>
            <i></i>
          </div>
        </div>
        <div class="list-li list-2" id="list-2">
          <div class="list-user"><img src="{RES}style/shake/images/user.png"></div>
          <div class="list-progress">
            <div class="list-name"><p></p></div>
            <div class="progress-bar">
              <span></span>
            </div>
            <div class="progress-user">
              <span></span>
              <div class="user user-2 animate-move-user"></div>
            </div>
            <i></i>
          </div>
        </div>
        <div class="list-li list-3" id="list-3">
          <div class="list-user"><img src="{RES}style/shake/images/user.png"></div>
          <div class="list-progress">
            <div class="list-name"><p></p></div>
            <div class="progress-bar">
              <span></span>
            </div>
            <div class="progress-user">
              <span></span>
              <div class="user user-3 animate-move-user"></div>
            </div>
            <i></i>
          </div>
        </div>
        <div class="list-li list-4" id="list-4">
          <div class="list-user"><img src="{RES}style/shake/images/user.png"></div>
          <div class="list-progress">
            <div class="list-name"><p></p></div>
            <div class="progress-bar">
              <span></span>
            </div>
            <div class="progress-user">
              <span></span>
              <div class="user user-4 animate-move-user"></div>
            </div>
            <i></i>
          </div>
        </div>
        <div class="list-li list-5" id="list-5">
          <div class="list-user"><img src="{RES}style/shake/images/user.png"></div>
          <div class="list-progress">
            <div class="list-name"><p></p></div>
            <div class="progress-bar">
              <span></span>
            </div>
            <div class="progress-user">
              <span></span>
              <div class="user user-5 animate-move-user"></div>
            </div>
            <i></i>
          </div>
        </div>
        <div class="list-li list-6" id="list-6">
          <div class="list-user"><img src="{RES}style/shake/images/user.png" ></div>
          <div class="list-progress">
            <div class="list-name"><p></p></div>
            <div class="progress-bar">
              <span></span>
            </div>
            <div class="progress-user">
              <span></span>
              <div class="user user-6 animate-move-user"></div>
            </div>
            <i></i>
          </div>
        </div>
        <div class="list-li list-7" id="list-7">
          <div class="list-user"><img src="{RES}style/shake/images/user.png" ></div>
          <div class="list-progress">
            <div class="list-name"><p></p></div>
            <div class="progress-bar">
              <span></span>
            </div>
            <div class="progress-user">
              <span></span>
              <div class="user user-7 animate-move-user"></div>
            </div>
            <i></i>
          </div>
        </div>
        <div class="list-li list-8" id="list-8">
          <div class="list-user"><img src="{RES}style/shake/images/user.png"></div>
          <div class="list-progress">
            <div class="list-name"><p></p></div>
            <div class="progress-bar">
              <span></span>
            </div>
            <div class="progress-user">
              <span></span>
              <div class="user user-8 animate-move-user"></div>
            </div>
            <i></i>
          </div>
        </div>
    </div>
      <div class="clounds">
          <div class="clound clound-1 animate-move-clound">
            <i></i>
            <em></em>
          </div>
          <div class="clound clound-2 animate-move-clound">
            <i></i>
            <em></em>
          </div>
          <div class="clound clound-3 animate-move-clound">
            <i></i>
            <em></em>
          </div>
          <div class="clound clound-4 animate-move-clound">
            <i></i>
            <em></em>
          </div>
      </div>
  </section>
    <div class="bg-bottom" id="index-bottom"></div>
  <div class="bg-bottom bg-bottom-game" id="game-bottom">
    <a class="btn-home">
        <div class="home-botton"></div>
        <div class="home-icon">
          <div class="home-fly animate-move-fly"></div>
        </div>
    </a>
    <a class="btn-restart">
        <div class="restart-botton"></div>
        <div class="airplane"></div>
    </a>
  </div>
  <div class="bottom mod-code" id="start-bottom">
    <div>
      <p><span>
      <img src="{$_W['attachurl']}{$cfg['erweima']}"  class="bottom-code">
    </span></p>
      <p><span>
      <b>{$ridwall['yyyzhuti']}</b>
      <span class="animate-move-left"><i class="bg-arrow"></i><span>扫描二维码关注</span></span>
      <small>并发送“{$keyword}”即可参与</small>
    </span></p>
    </div>
  </div>
</div>
<div class="pop" id="pop-code">
  <a class="pop-close" href="javascript:;"></a>
  <div class="pop-code">
    <p>
      <span><img src="{$_W['attachurl']}{$cfg['erweima']}" ></span>
      <small>微信扫一扫，发送<b>{$keyword}</b>即可参与</small>
    </p>
  </div>
</div>
<div class="pop-message hidden">
  <img src="{RES}style/shake/images/gameOver.png" >
</div>
<div class="game-music" id="game-music">
  <audio {if empty($ridwall['music'])}src="{RES}style/shake/images/bg.mp3"{else}src="{$ridwall['music']}"{/if}  loop></audio>
</div>
<script>
$(function(){
var users = new Array();
var user_list  = new Array();
var gameTimer     = null;
var gameIsOver    = false;
var $userDivList  = $(".list-li");
var $userSpanList = $('.list-li span');
var gameMusic     = $("#game-music audio")[0];
var $restartBtn   = $(".btn-restart");
var $airplane     = $("#airplane");
var $countDown    = $("#countDown");
var maxShakeCount = 150.0;
var defaultUser   = {id: '', nickname: '', avatar: '{RES}style/shake/images/user.png', point: 0};
var defaultUsers = [{"id":"","nickname":"","avatar":"{RES}style/shake/images/user.png","point":0},{"id":"","nickname":"","avatar":"{RES}style/shake/images/user.png","point":0},{"id":"","nickname":"","avatar":"{RES}style/shake/images/user.png","point":0},{"id":"","nickname":"","avatar":"{RES}style/shake/images/user.png","point":0},{"id":"","nickname":"","avatar":"{RES}style/shake/images/user.png","point":0},{"id":"","nickname":"","avatar":"{RES}style/shake/images/user.png","point":0},{"id":"","nickname":"","avatar":"{RES}style/shake/images/user.png","point":0},{"id":"","nickname":"","avatar":"{RES}style/shake/images/user.png","point":0}];
function start(){ 

  

  $.ajax({ 

  type: "post", 

  url : "{php echo $this->createMobileUrl('date')}",

  dataType:'text', 

  data: 'judge=3&rid={$rid}',

  success: function(data){}});

   }
function resetstart(){ 

  

  $.ajax({ 

  type: "post", 

  url : "{php echo $this->createMobileUrl('date')}",

  dataType:'text', 

  data: 'judge=5&rid={$rid}',

  success: function(data){}});

   }
  function end(){ 

  

  $.ajax({ 

  type: "post", 

  url : "{php echo $this->createMobileUrl('date')}",

  dataType:'text', 

  data: 'judge=4&rid={$rid}',

  success: function(data){}});

   }

  

  function getman(){

  $.ajax({ 

  type: "post", 

  url : "{php echo $this->createMobileUrl('date')}",

  dataType:'text', 

  data: 'judge=2&rid={$rid}',

  success: function(user_count){

       $('.mod-number span').html('<i>'+user_count+'</i>').find('i').toggleClass('animate-rotate2');

      }

    

    });

   }

 
function playGame() {
    gameTimer = window.setInterval(renderUsers, 600);
    $(".time-go").animate({top:"200%"}, 0, function() {
        gameMusic.play();
    });
}

function readyStart() {
        countDown({$ridwall["countdown"]}, function(seconds) {
            var $countDownP = $countDown.find("p").html(secondsHtml(seconds));
            $countDown.removeClass("time-go");
            if (seconds <= 0) {
				start();
                $countDown.addClass("time-go");
                $countDownP.html('<i class="number number-go"></i>');
                window.setTimeout(playGame, 1000);
            }
        });
   
}

function beforeReadyGame() {
    $("#game-bottom").animate({bottom: "+=600px"}, "5000", function () {
        $("#game").fadeIn();
    });
    readyStart();
}
function secondsHtml(seconds) {
    return seconds.toString().split('').map(function (x) {
        return '<i class="number number-' + x + '"></i>';
    }).join('');
}
function renderUsers() {
    $userSpanList.stop();
	$.getJSON("{php echo $this->createMobileUrl('date',array('rid'=>$rid,'judge'=>1))}",{},function(json){
		//console.log(json);
					if(json){
						$.each(json, function(i,v){
							$userDivList.each(function (i, el) {
								var $userDiv = $(el);
								var user = json[i] || defaultUser;
								//console.log(user);
								var maxShakeCount = {php echo $ridwall["maxshake"].'.0';};
								var realcount = maxShakeCount + 5;
								if (user.point >= realcount) {
									//alert(user.point);// 活动结束
								    if(!gameIsOver) {
										gameIsOver = true;
										window.clearInterval(gameTimer);
						                $.get("{php echo $this->createMobileUrl('date',array('rid'=>$rid,'judge'=>4))}", function(e) {
											$restartBtn.addClass("btn-restart-active");
											window.setTimeout(function() {
												$(".pop-message").show().removeClass('hidden');
												gameMusic.pause();
											}, 600);
										});
									}
								} else {
									$userDiv.find('img').attr('src', user.avatar);
								    $userDiv.find('.list-name p').html(user.phone);
								    var shakeBarWidth = user.point / maxShakeCount * 100;	
								    shakeBarWidth = Math.min(Math.max(9, shakeBarWidth), 100) + '%';
								    $userDiv.find('span').animate({width: shakeBarWidth},0);
								}
								
							});
							
							
						});
						renderLevel();
					}else{
					    $.each(defaultUsers, function(i,v){
							$userDivList.each(function (i, el) {
								var $userDiv = $(el);
								var user = defaultUsers[i] || defaultUser;
								//console.log(user);
								var maxShakeCount = {$ridwall["maxshake"]};
								var realcount = maxShakeCount + 5;
								if (user.point >= realcount) {
									//alert(user.point);// 活动结束
								    if(!gameIsOver) {
										gameIsOver = true;
										window.clearInterval(gameTimer);
						                $.get("{php echo $this->createMobileUrl('date',array('rid'=>$rid,'judge'=>4))}", function(e) {
											$restartBtn.addClass("btn-restart-active");
											window.setTimeout(function() {
												$(".pop-message").show().removeClass('hidden');
												gameMusic.pause();
											}, 1000);
										});
									}
								} else {
									$userDiv.find('img').attr('src', user.avatar);
								    $userDiv.find('.list-name p').html(user.phone);
								    var shakeBarWidth = user.point / maxShakeCount * 100;
								    shakeBarWidth = Math.min(Math.max(9, shakeBarWidth), 100) + '%';
								    $userDiv.find('span').animate({width: shakeBarWidth}, 500);
									
								}
								
							});
							
						});
						renderLevel();
					
					} 
					
				   });
    
}
function renderLevel() {
    $userDivList.toggleClass("animate-rotate2").find(".user").toggleClass("animate-move-user");

    window.setTimeout(function () {
        if( $(".list-li:animated") ) {
            $userDivList.find(".user").toggleClass("animate-move-user");
        }
    }, 10);
}
$(".pop-close,.bottom-code").click(function() { $("#pop-code").fadeToggle(); });

    $restartBtn.click(function () {
        if ($restartBtn.hasClass("btn-restart-active")) {
			resetstart();
            gameIsOver = false;
            $restartBtn.removeClass("btn-restart-active");
            $(".pop-message").hide().addClass('hidden');
            gameMusic.pause();
            $countDown.animate({top: "50%"}, 1000, function () {
                $(".progress-bar span, .progress-user span").removeAttr("style");
            });
            readyStart();
        }
    });
$(".btn-start").click(function () {
        window.clearInterval(yuni);
        $airplane.addClass("active");
        window.setTimeout(function () {
            $airplane.animate({right: "-=600%", opacity: "0"}, "2000", function () {
                $(".index-logo, #bg-shine, .index-number").animate({opacity: "0"}, 1000);
                $(".index-users").animate({opacity: "0"}, "3000");
                $("#start-bottom").animate({bottom: "-=100%"}, "3000");
                $("#index-bottom").animate({bottom: "-=100%"}, "4000", beforeReadyGame);
            });
        }, 1000);
    });
 $(".btn-home").click(function () {
	    //alert('');
		if(confirm("此操作将重置摇一摇哦！确定么？")){
				   $.ajax({ 

			  type: "post", 

			  url : "{php echo $this->createMobileUrl('date')}",

			  dataType:'text', 

			  data: 'judge=5&rid={$rid}',

			  success: function(data){
				 window.location.reload();
			  }
		   });
         }

       
				  
});
var yuni=setInterval(getman,3000);
//renderUsers();
   

})

</script>
<script>
function requestFullScreen() {
     var de = document.documentElement;
     if (de.requestFullscreen) {
         de.requestFullscreen();
     } else if (de.mozRequestFullScreen) {
         de.mozRequestFullScreen();
     } else if (de.webkitRequestFullScreen) {
         de.webkitRequestFullScreen();
     }
}
</script>
</body>
</html>

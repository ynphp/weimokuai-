﻿﻿

<div class="form-group">
	<label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style='color:red'>*</span>旅行名称</label>
	<div class="col-sm-9 col-xs-12">
		<input type="text" name="goodsname" id="goodsname" class="form-control" value="{$item['title']}" />
	</div>
</div>
<div class="form-group">
	<label class="col-xs-12 col-sm-3 col-md-2 control-label">参与单位</label>
	<div class="col-sm-6 col-xs-6">
		<input type="text" name="unit" id="unit" class="form-control" value="{$item['unit']}" />
		<span class="help-block">如: 人次</span>
	</div>
</div>
<!--
<div class="form-group">
	<label class="col-xs-12 col-sm-3 col-md-2 control-label">商品属性</label>
	<div class="col-sm-9 col-xs-12" >
		<label for="isrecommand" class="checkbox-inline">
			<input type="checkbox" name="isrecommand" value="1" id="isrecommand" {if $item['isrecommand'] == 1}checked="true"{/if} /> 首页推荐
		</label>
		<label for="isnew" class="checkbox-inline">
			<input type="checkbox" name="isnew" value="1" id="isnew" {if $item['isnew'] == 1}checked="true"{/if} /> 新品推荐
		</label>
		<label for="ishot" class="checkbox-inline">
			<input type="checkbox" name="ishot" value="1" id="ishot" {if $item['ishot'] == 1}checked="true"{/if} /> 热卖推荐
		</label>
		<label for="isdiscount" class="checkbox-inline">
			<input type="checkbox" name="isdiscount" value="1" id="isdiscount" {if $item['isdiscount'] == 1}checked="true"{/if} /> 折扣商品
		</label>
		<label for="istime" class="checkbox-inline">
			<input type="checkbox" name="istime" value="1" id="istime" {if $item['istime'] == 1}checked="true"{/if} /> 限时卖
		</label>
	</div>
</div>
<div class="form-group">
	<label class="col-xs-12 col-sm-3 col-md-2 control-label">限时卖时间</label>
	<div class="col-sm-4 col-xs-6">
		{php echo tpl_form_field_date('timestart', !empty($item['timestart']) ? date('Y-m-d H:i',$item['timestart']) : date('Y-m-d H:i'), 1)}
	</div>
	<div class="col-sm-4 col-xs-6">
		{php echo tpl_form_field_date('timeend', !empty($item['timeend']) ? date('Y-m-d H:i',$item['timeend']) : date('Y-m-d H:i'), 1)}
	</div>
</div>-->

<div class="form-group">
	<label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style='color:red'>*</span>分类{$set['phone']}</label>
	<div class="col-sm-8 col-xs-12">
		{php echo tpl_form_field_category_2level('category', $parent, $children, $item['pcate'], $item['ccate'])}
	</div>
</div>

<div class="form-group">
	<label class="col-xs-12 col-sm-3 col-md-2 control-label">热度星级</label>
	<div class="col-sm-6 col-xs-6">
		<input type="number" name="xingji" id="xingji" min="1" max="100"class="form-control" value="{$item['xingji']}" />
       <span class="help-block">如: 1到100</span>
	</div>
</div>


<div class="form-group">
	<label class="col-xs-12 col-sm-3 col-md-2 control-label">展示图</label>
	<div class="col-sm-9 col-xs-12">
		{php echo tpl_form_field_image('thumb', $item['thumb'], '', array('extras' => array('text' => 'readonly')))}
	</div>
</div>
<div class="form-group">
	<label class="col-xs-12 col-sm-3 col-md-2 control-label">其他展示图片</label>
	<div class="col-sm-9 col-xs-12">
		{php echo tpl_form_field_multi_image('thumbs',$piclist)}
	</div>
</div>

<!--原选择时间控件-->
<!--
<div class="form-group">
	<label class="col-xs-12 col-sm-3 col-md-2 control-label">参团时间</label>
	<div class="col-sm-4 col-xs-6">
    <?php
      $start = date('Y-m-d',$item['starttime']);
      $end = date('Y-m-d',$item['endtime']);
    $birth = array(
    'start' => $start,
    'end'   => $end,
);
    ?>
	{php echo tpl_form_field_daterange('birth', $birth);}
	</div>

</div>

<div class="form-group">
	<label class="col-xs-12 col-sm-3 col-md-2 control-label">点击选定无效时间</label>
	<div class="col-sm-6 col-xs-6 col-sm-3 col-md-2">
		<input type="text" name="time1" id="time1" class="form-control" onfocus="WdatePicker({dateFmt:'yyyy-MM-dd'})" value="" readonly="readonly" /><input type="button" value="增加" onclick="addtime();" />
		
	</div>
</div>

<div class="form-group">
	<label class="col-xs-12 col-sm-3 col-md-2 control-label">无效时间列表</label>
	<div class="col-sm-8 col-xs-12">
		<textarea  id="time2" class="form-control" rows="3" name="time2" readonly="readonly">{$item['time2']}</textarea><input type="button" onclick="qingkong();" value="清空" /> 
	</div>
</div>
-->


<div class="form-group">
	<label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style='color:red'>*</span>行程特色</label>
	<div class="col-sm-8 col-xs-12">
		<textarea id="xc" class="form-control" rows="3" name="xingcheng">{$item['xingcheng']}</textarea>
	</div>
</div>

<?php
	
	$detime = $item['detime'];
	$detime =json_decode($detime);
/*	echo "<pre>";
		print_r($detime[0]);
		echo "</pre>";*/
	?>

<div class="form-group" >
	<label class="col-xs-12 col-sm-3 col-md-2 control-label">出行日期和价格管理</label>
	<div class="col-sm-8 col-xs-12" >
                <div class="alert-new">
					<table class="table table-hover" id="adtime0">
					
						
						<tbody >
			   {if $item['detime']==''}
			   
			           <tr id="Adt0">
							<td>
								<div class="form-group">
									<label class="col-xs-1 col-sm-1 col-md-1 control-label"><a href="javascript:;" onclick="deleteItem(this)" data-toggle="tooltip" data-placement="bottom" title="删除此条目" class="btn btn-default btn-sm"><i class="fa fa-times"></i></a></label>
									<label class="col-xs-4 col-sm-4 col-md-4 control-label" style="font-weight: 500;"><input name="detime[0][]" type="text"  id ="detime" placeholder="日期" onfocus="WdatePicker({dateFmt:'yyyy-MM-dd',minDate:new Date()})" value="" readonly="readonly" value=""/></label>
									<label class="col-xs-4 col-sm-4 col-md-4 control-label" style="font-weight: 500;"><input name="detime[1][]" type="text"  id ="money" placeholder="价格" value=""/></label>
								</div>
							</td>
						</tr>
			  
			  {else}
			   
			         	{loop $detime[0] $index $v} 
						<tr id="Adt{$index}">
							<td>
								<div class="form-group">
									<label class="col-xs-1 col-sm-1 col-md-1 control-label" style="font-weight: 500;"><a href="javascript:;" onclick="deleteItem(this)" data-toggle="tooltip" data-placement="bottom" title="删除此条目" class="btn btn-default btn-sm"><i class="fa fa-times"></i></a></label>
									<label class="col-xs-4 col-sm-4 col-md-4 control-label" style="font-weight: 500;"><input name="detime[0][]" type="text"  id ="detime{$index}" placeholder="日期" onfocus="WdatePicker({dateFmt:'yyyy-MM-dd',minDate:new Date()})" readonly="readonly" value="{$detime[0][$index]}"/></label>
									<label class="col-xs-4 col-sm-4 col-md-4 control-label" style="font-weight: 500;"><input name="detime[1][]" type="text"  id ="money{$index}" placeholder="价格" value="{$detime[1][$index]}"/></label>
								</div>
							</td>
						</tr>
							{/loop}
			   
			   {/if}
					
									</tbody>
					</table>
				</div>{if $item['detime']==''}
				<input type="hidden" id="timeNum" name="timeNum" value="0" />
				{else}
				<input type="hidden" id="timeNum" name="timeNum" value="{$index}" />
			{/if}
				<div class="btn-group">
  <button type="button" class="btn btn-default" id="timeadd" >添加</button>
  </div>
</div>
</div>


<div class="form-group">
	<label class="col-xs-12 col-sm-3 col-md-2 control-label">本团价格</label>
	<div class="col-sm-9 col-xs-12">
		<div class="input-group form-group">
			<span class="input-group-addon">成人票价</span>
			<input type="text" name="marketprice" id="marketprice" class="form-control" value="{$item['marketprice']}" />
			<span class="input-group-addon">元</span>
		</div>
		<div class="input-group form-group">
			<span class="input-group-addon">儿童票价</span>
			<input type="text" name="productprice" id="productprice" class="form-control" value="{$item['productprice']}" />
			<span class="input-group-addon">元</span>
		</div>
		
	</div>
</div>

<div class="form-group">
	<label class="col-xs-12 col-sm-3 col-md-2 control-label">游玩人数</label>
	<div class="col-sm-6 col-xs-12">
		<div class="input-group">
			<input type="text" name="total" id="total" class="form-control" value="{$item['total']}" />
			<span class="input-group-addon">人</span>
		</div>
		<span class="help-block">当前已经参加人数</span>
	</div>
</div>
<div class="form-group">
	<label class="col-xs-12 col-sm-3 col-md-2 control-label">减人数方式</label>
	<div class="col-sm-9 col-xs-12">
		<label for="totalcnf1" class="radio-inline"><input type="radio" name="totalcnf" value="0" id="totalcnf1" {if empty($item) || $item['totalcnf'] == 0}checked="true"{/if} /> 拍下减库存</label>
		&nbsp;&nbsp;&nbsp;
		<label for="totalcnf2" class="radio-inline"><input type="radio" name="totalcnf" value="1" id="totalcnf2"  {if !empty($item) && $item['totalcnf'] == 1}checked="true"{/if} /> 付款减库存</label>
		&nbsp;&nbsp;&nbsp;
		<label for="totalcnf3" class="radio-inline"><input type="radio" name="totalcnf" value="2" id="totalcnf3"  {if !empty($item) && $item['totalcnf'] == 2}checked="true"{/if} /> 永不减库存</label>
	</div>
</div>
<div class="form-group">
	<label class="col-xs-12 col-sm-3 col-md-2 control-label">单次最多购买量</label>
	<div class="col-sm-6 col-xs-12">
		<div class="input-group">
			<input type="text" name="maxbuy" id="maxbuy" class="form-control" value="{$item['maxbuy']}" />
			<span class="input-group-addon">人次</span>
		</div>
	</div>
</div>
<div class="form-group">
	<label class="col-xs-12 col-sm-3 col-md-2 control-label">用户最多购买量</label>
	<div class="col-sm-6 col-xs-12">
		<div class="input-group">
			<input type="text" name="usermaxbuy" class="form-control" value="{$item['usermaxbuy']}" />
			<span class="input-group-addon">人次</span>
		</div>
	</div>
</div>
<div class="form-group">
	<label class="col-xs-12 col-sm-3 col-md-2 control-label">已出售数</label>
	<div class="col-sm-6 col-xs-12">
		<div class="input-group">
			<input type="text" name="sales" id="sales" class="form-control" value="{$item['sales']}" />
			<span class="input-group-addon">人次</span>
		</div>
	</div>
</div>
<div class="form-group">
	<label class="col-xs-12 col-sm-3 col-md-2 control-label">购买积分</label>
	<div class="col-sm-6 col-xs-12">
		<div class="input-group">
			<input type="text" name="credit" id="credit" class="form-control" value="{$item['credit']}" />
			<span class="input-group-addon">分</span>
		</div>
		<p class="help-block">会员购买积分, 如果不填写，则默认为不奖励积分</p>
	</div>
</div>

<script language="javascript">

	   var result5 = $("input[name='birth[start]']").val();
	    var result6 = $("input[name='birth[end]']").val();
	  var time1 = $('#time1').val();
	  var time2 = $('#time2').val();
	  var time_date = time2;
	
	function addtime() {
		time1 = $('#time1').val();
		time2 = $('#time2').val();
		checkTime(time1,result5,result6);
		if(!time1) return false;
		if(time2) time_date += '|';
		time_date += time1;
		$('#time2').val(time_date);
		$('#time1').val('');	//time1 = '';
	
		return false;
	}
	

	//清空无效时间列表
	function qingkong()
	{
  
	$('#time2').val("");
	time_date = '';
	}
	
	
	
		function checkTime(time1,result5,result6){  
			
		   var start = new Date(result5.replace("-", "/").replace("-", "/"));  
		   var time1 = new Date(time1.replace("-", "/").replace("-", "/"));
		   var end=new Date(result6.replace("-", "/").replace("-", "/"));
		
		   if(time1<start || time1>end){ 
			 alert('请选择参团时间内的时间'); 
			e.stopPropagation();   
		   }  
		 
		   return true;  
		}  
	$(function () {
		
	  
		var i = 0;
		$('#selectimage').click(function () {
			var editor = KindEditor.editor({
				allowFileManager: false,
				imageSizeLimit: '30MB',
				uploadJson: './index.php?act=attachment&do=upload'
			});
			editor.loadPlugin('multiimage', function () {
				editor.plugin.multiImageDialog({
					clickFn: function (list) {
						if (list && list.length > 0) {
							for (i in list) {
								if (list[i]) {
									html = '<li class="imgbox" style="list-type:none">' +
												'<a class="item_close" href="javascript:;" onclick="deletepic(this);" title="删除"></a>' +
												'<span class="item_box"> <img src="' + list[i]['url'] + '" style="height:80px"></span>' +
												'<input type="hidden" name="attachment-new[]" value="' + list[i]['filename'] + '" />' +
											'</li>';
									$('#fileList').append(html);
									i++;
								}
							}
							editor.hideDialog();
						} else {
							alert('请先选择要上传的图片！');
						}
					}
				});
			});
		});
	});

	function deletepic(obj) {
		if (confirm("确认要删除？")) {
			var $thisob = $(obj);
			var $liobj = $thisob.parent();
			var picurl = $liobj.children('input').val();
			$.post('{php echo $this->createMobileUrl('ajaxdelete',array())}', {pic: picurl}, function (m) {
				if (m == '1') {
					$liobj.remove();
				} else {
					alert("删除失败");
				}
			}, "html");
		}
	}
	
	
	//增加时间
	
	$(function() {
					 	
					 	$("#timeadd").click(function(){
					 	
					 		
					 		var num = $("#timeNum").val(); //
					 		     num = parseInt(num);
                                 num++; //点击自加
                            $("#timeNum").val(num); //重新赋值	
                          
                            $("#Adt0").clone(true).attr("id", "Adt" + num).appendTo("#adtime0"); //clone tr 并重新给定ID,装到table
                            
					 		 $("#Adt"+num).find("input[type='text']").val(""); //清空克隆行的数据
					 		
					 		 $("#Adt"+num).find("input[name='detime[0][]']").attr("id", "detime" + num);
					 		 $("#Adt"+num).find("input[name='detime[1][]']").attr("id", "money" + num);
					 	});
			});
	
	

</script>
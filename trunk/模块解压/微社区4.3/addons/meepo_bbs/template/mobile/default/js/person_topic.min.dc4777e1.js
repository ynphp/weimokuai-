!function(a,b){"function"==typeof define&&define.amd?define(b):a.TmplInline_person_topic=b()}(this,function(){var a={},b=function(a){function b(b){return c("undefined"==typeof a[b]?this[b]:a[b])}function c(a){return"undefined"==typeof a?"":a}a=a||{};var d=b("rs"),e=b("imgHandle"),f=b("plain2rich"),g="";g+="";var h=0,i=arguments[1];for(h;h<d.length;++h){var j=d[h].feed_value;if(j.post.pic_list||(j.post.pic_list=[]),g+=' <li class="section-1px unit_link" data-action="toTopic" data-pid="',g+=c(j.pid),g+='" data-bid="',g+=c(j.bid),g+='" data-type="',g+=c(j.type),g+='" ',g+=c("openact"===j.post.from?'openactid="'+j.post.openact_id+'"':""),g+="> ",j.post.audio_list&&j.post.audio_list.length>0&&(g+=' <div class="p-topic-img"> <img src="',g+=c(j.user.pic),g+='"> <span class="p-audio">',g+=c(i.formatDuration(j.post.audio_list[0].duration)),g+="</span> </div> "),g+=" ",j.post.video_list&&j.post.video_list.length>0&&(g+=' <div class="p-topic-img"> <img src=\'http://shp.qpic.cn/qqvideo/0/',g+=c(j.post.video_list[0].vid),g+='/400\' > <span class="p-video"></span> </div> '),g+=" ",j.post.qqmusic_list&&j.post.qqmusic_list.length>0&&(g+=' <div class="p-topic-img"> <img src=\'',g+=c(j.post.qqmusic_list[0].image_url),g+='\' > <span class="p-music"></span> </div> '),g+=" ",400!=j.type&&j.post.pic_list&&j.post.pic_list.length>0){var k=e.formatThumb(j.post.pic_list,!0,90,90);k=k[0],g+=' <div class="p-topic-img"> <img lazy-src="',g+=c(k.url),g+='" style="width:',g+=c(k.width),g+="px; height:",g+=c(k.height),g+="px; margin-left:",g+=c(k.marginLeft),g+="px; margin-top:",g+=c(k.marginTop),g+='px;" > ',j.post.pic_list.length>1&&(g+=' <span class="p-banner">共',g+=c(j.post.pic_list.length),g+="张</span> "),g+=" </div> "}if(g+=' <div class="p-t-wrapper" > <h2 class="p-t-title">',g+=c(f(j.title||"")),g+="</h2> ",""!==j.post.content&&(g+=' <p class="p-t-content">',g+=c(f(j.post.content||"","",j.post.urlInfo||"",!0)),g+="</p> "),g+=" </div> ",400===j.type&&j.post.pic_list.length>0){{i.resizeImg(j.post.pic_list[0])}g+=' <div class="p-img-gallery"> ';for(var l=0,m=j.post.pic_list;l<m.length&&3>l;++l){var n=e.formatThumb(j.post.pic_list,!0,100,100);g+=' <div class="p-g-img"><img lazy-src = "',g+=c(n[l].url),g+='" style="width:',g+=c(n[l].width),g+="px; height:",g+=c(n[l].height),g+="px; margin-left:",g+=c(n[l].marginLeft),g+="px; margin-top:",g+=c(n[l].marginTop),g+='px;" >',2==l&&m.length>3&&(g+='<span class="p-banner" >共',g+=c(m.length),g+="张</span>"),g+="</div> "}g+=" </div> "}g+=' <div class="p-t-footer"> <span class="p-barname">',g+=c(j.bname),g+='部落</span> <div class="p-panel" ><span class="icon p-read"></span><span>',g+=c(j.readnum),g+='</span> <span class="icon p-chat"></span><span>',g+=c(j.total_comment_v2||j.total_comment),g+="</span></div> </div> </li> "}return g+=" "};return a.topic_list="TmplInline_person_topic.topic_list",Tmpl.addTmpl(a.topic_list,b),a}),function(a,b){"function"==typeof define&&define.amd?define(["imgHandle"],b):a.imgHandle=b(a.imgHandle)}(this,function(a){a=a||{};var b,c,d,e,f,g,h,i,j,k,l;b=function(a,b,c){b.removeAttribute(c),g(a,b)},c="http://pub.idqqimg.com/qqun/xiaoqu/mobile/img/hot-error.png",d=function(a,b,d){c&&d!==c&&b.parentNode&&(b.src=c,b.className+=" error",b.style.marginTop="0px",b.parentNode.className+=" err-img"),Badjs("image error: "+d,location.href,0,387647,2,504991),console.error("image error: "+d)},e=function(a,b,c,d){if(!a)return{url:"img/error.png",w:0,h:0,t:"",marginTop:0};b=b||328,c=c||228,d=d||50;var e=a.w,f=a.h;if(b>e)return d>f&&(a.marginTop=(d-f)/2+"px"),a;var g=f/e*b,h=0;return g>c&&(h=(c-g)/2+"px"),{url:a.url,w:b,h:g,t:a.t,marginTop:h}},f=function(a,b,c,d,e){if(a&&a.length){var f;if(1!==a.length||b)for(var g=0,h=a.length;h>g;g++)f=a[g],c=e?c||77:Math.min(f.w||c,c)||77,d=e?d||77:Math.min(f.h||d,d)||77,f.boxWidth=f.width=c,f.boxHeight=f.height=d,f.marginTop=0,f.marginLeft=0,f.w&&f.h&&(f.h*c/f.w>d?(f.height=f.h*c/f.w,f.marginTop=.382*(f.boxHeight-f.height)):(f.width=f.w*d/f.h,f.marginLeft=(f.boxWidth-f.width)/2));else f=a[0],c=Math.min(f.w||c,c)||150,d=Math.min(f.h||d,d)||225,f.boxWidth=f.width=c,f.boxHeight=f.height=d,f.marginTop=0,f.marginLeft=0,f.w&&f.h&&(f.h*c/f.w>d?(f.width=f.w*d/f.h,f.boxWidth=f.width):(f.height=f.h*c/f.w,f.boxHeight=f.height))}return a},g=function(a,b){if(b.getAttribute("noSize")&&""!==b.getAttribute("noSize")){for(var c=b.getAttribute("noSize").split("&"),d={},e=0;e<c.length;e++)d[c[e].split(":")[0]]=c[e].split(":")[1];try{(a.target.width<50||a.target.height<50)&&window.location.pathname.indexOf("/index.html")>-1&&b.parentNode&&$(b).parent().hasClass("feed-img")&&(b.parentNode.style.display="none",$(b).parents(".img-wrap").find(".total-img").hide())}catch(g){}var h=d.w,i=[{w:a.target.width,h:a.target.height,url:a.target.src}],j=d.h;i=f(i,!0,h,j,!0),b.style.cssText="width:"+i[0].width+"px; height:"+i[0].height+"px;margin-left:"+i[0].marginLeft+"px; margin-top:"+i[0].marginTop+"px;"}"true"===b.getAttribute("needHideBg")&&b.parentNode&&(b.parentNode.className+=" hide-bg"),"true"===b.getAttribute("hidebg")&&b.parentNode&&(b.parentNode.style.background="none")};var m=function(a,b){a=a||"";var c=a;"object"==typeof c&&(c.t&&"gif"===c.t&&(a+="0"),a=c.url),a.indexOf("mmbiz.qpic.cn")>-1&&$.os.ios&&(a=a.replace("tp=webp",""));var d=a.split("/");return!d[d.length-1]&&"0"!==d[d.length-1]||-1!==a.indexOf("ugc.qpic.cn/gbar_pic")?(a.indexOf("p.qlogo.cn")>-1?a+="0":a.indexOf("p.qpic.cn")>-1||a.indexOf("ugc.qpic.cn/qqac/")>-1?a+="160":a.indexOf("ugc.qpic.cn/gbar_pic")>-1&&(a=a.replace(/\/(\d+)$/,"/"),a+=b||"200"),a):(a.indexOf("ugc.qpic.cn/qqac/")>-1&&(d[d.length-1]="160",a=d.join("/")),a)};return k=document.documentElement.clientHeight,$(document).on("touchmove",function(){l=document.body.scrollTop;for(var a,b,c=0;c<i.length&&(a=i[c],b=a.getBoundingClientRect().top,1.5*k>b-l);c++)j(a),i.splice(c,1)}),i=[],j=function(a,c){c=c||"lazy-src";var e=a.getAttribute(c);if(e){a.setAttribute("page-lazyload-time",Date.now());var f=[951766002,1310720359,1591771530,1873705937,2024781614,2062695960,2359834172,2410808470,2716387061,2794353141,2795169601,2795341204,2842800574,2892764449,2894406678,2915266032,2923136367,2978718130,2982660671,2995344389];a.onerror=function(b){var c=a.getAttribute("data-festival-uin"),g=c%20;if(c){var h=$(a).addClass("offline-pic avatar-"+f[g]);h.removeAttr("src")}else d(b,a,e)},a.onload=function(d){b(d,a,c)},a.src=e}},h=function(a){if(a){var b;if(l=document.body.scrollTop,"IMG"===a.tagName)return b=a.getBoundingClientRect().top,void(l+k>b?j(a):i.push(a));for(var c=a.getElementsByTagName("img"),d=0,e=c.length;e>d;d++)a=c[d],b=a.getBoundingClientRect().top,l+k>b?j(a):i.push(a)}},a.setErrImg=function(a){c=a},a.lazy=h,a.format=e,a.formatThumb=f,a.getThumbUrl=m,a.dealWithFeedImage=g,a}),function(a,b){a.PersonTopic=b(a.$,a.DB)}(this,function(){function a(a){for(var b,c=(window.innerWidth,0),d=a.length,e=0;d>c;++c){var f=a[c].feed_value.post.pic_list;if(f)for(e=0;e<f.length;++e)f[e].url||(b=f[e],f[e]={url:f[e],w:196,h:196}),f[e].url=imgHandle.getThumbUrl(f[e].url,120);else a[c].feed_value.post.pic_list=[]}}function b(){m.rock(),n.bind()}var c=(Login.getUin(),Util.getHash("uin")),d=function(a,b){var d,e={opername:"Grp_tribe",module:"person_data",action:a,ver1:Util.queryString("bid")||Util.getHash("bid"),ver2:Util.getHash("from"),ver3:c===Login.getUin()?"0":"1"};for(d in b)b.hasOwnProperty(d)&&(e[d]=b[d]);Q.tdw(e)},e=Util.getHash("type"),f="发表过的话题";"pulished"!==e&&e?(document.title="赞过的话题",f="赞过的话题",d("exp_like")):(e="pulished",document.title="发表的话题",d("exp_post"));var g=function(){return"pulished"!==e&&e?function(){d("Clk_like")}:function(){d("Clk_post")}}();mqq.ui.refreshTitle();var h="pulished"===e?1:3,i={formatDuration:function(a){a=Number(a);var b=a%60,c=~~(a/60);return(c>=10?c:"0"+c)+":"+(b>=10?b:"0"+b)},resizeImg:function(a){var b=a,c=196,d=b.w/b.h,e=b.w,f=b.h;return b.w>b.h?b.w>c&&(e=c,f=c/d):b.h>c&&(f=c,e=f*d),b._width=e,b._height=f,b}},j=$("#main_wrapper"),k=10,l=!1,m=new scrollModel({comment:"personal_topic",renderTmpl:TmplInline_person_topic.topic_list,renderContainer:"#main_list",cgiName:"/cgi-bin/bar/card/topic_fix",renderTool:i,param:function(){var a=-k;return function(){return a+=k,{fixtotal:0,targetuin:c,startnum:a,neednum:k,type:h}}}(),myData:{type:1},processData:function(b,c){if($("#loading").hide(),0!==b.retcode)return void Tip.show("网络环境异常,请稍后重试");if(b.result){if("pulished"!==e)for(var d=0,f=b.result;d<f.rs.length;++d){{f.rs[d].feed_value.post.post.user}f.rs[d].feed_value.pid=f.rs[d].feed_value.post.pid,f.rs[d].feed_value.bid=f.rs[d].feed_value.post.bid,f.rs[d].feed_value.title=f.rs[d].feed_value.post.title,f.rs[d].feed_value.user=f.rs[d].feed_value.post.user,f.rs[d].feed_value.post=f.rs[d].feed_value.post.post}{b.result.total}b.result.isend>0?(l=!0,b.result.rs||(b.result.rs=[]),this.freeze(),$("#extra_loading").html("")):0!==c&&$("#extra_loading").show(),a(b.result.rs)}},events:function(){},onreset:function(){},complete:function(a,b){$("#main_list").show(),b>0&&(imgHandle.lazy($("#main_list")[0]),imgHandle.setErrImg("http://pub.idqqimg.com/qqun/xiaoqu/mobile/img/recommend-default-icon.png")),a.result&&0!=a.result.rs.length||1!=b||($("#extra_loading").hide(),$("<div class='p-empty'>"+f+"</div>").appendTo(j))}}),n={isBind:!1,bind:function(){$("body").on("tap",".unit_link",function(a){{var b=a.srcElement||a.target,c=this,d=c.getAttribute("data-action"),e=c.getAttribute("openactid");b.getAttribute("data-action")}if("toTopic"===d){g();var f=(c.getAttribute("data-pid"),Number(c.getAttribute("data-type")));e?Util.openQunAct(e):Util.openDetail({"#bid":c.getAttribute("data-bid"),"#pid":c.getAttribute("data-pid"),"#source":"personal"},!1,f)}})}};return{load:function(){b()},error:function(){}}});
var i_n_count=randomString(1);i_n_count>0&&($(".input-i-n-count").val(i_n_count),$(".i-n-count").text("("+i_n_count+")")),$(".input-i-n-count").bind("input propertychange",function(){var a=$(this).val();return isNaN(a)||0==a?($(".i-n-count").text(""),!1):(a="("+$(this).val()+")",void $(".i-n-count").text(a))}),$(".btn-del-i-n-count").click(function(){return $(".i-n-count").text(""),$(".input-i-n-count").val(""),!1}),$("body").on("click",".a-u-dialog a",function(){var a=$(this).parents(".add-user"),b=(a.index(),a.find(".a-u-name .a-u-data-name").val()),c=a.find(".a-u-name textarea").val(),d=$(this).parent().parent().find(".a-u-pic-show img").clone(),e=a.find(".a-u-dialog-master a").hasClass("btn-success");if(""==b)return alert("请输入用户名！"),!1;if(""==c)return alert("请输入聊天内容！"),!1;d.length||(d='<img src="/asset/images/tools/default-head.png" />'),c=replace_qq_emoji(c);var f=e?"i-b-sen-text":"i-b-rec-text",g=e?"":'<p class="i-b-nick">'+b+"</p>",h=$('<div class="'+f+'"><div>'+g+"<span><i></i><em>"+c+'</em><a class="msg-del"></a></span></div></div>');return h.prepend(d),$(".i-body").append(h),!1}),$(".add-time-btn").click(function(){var a=$(".slt-xinqi option:selected").val(),b=$(".slt-shi option:selected").val(),c=$(".slt-hour option:selected").val(),d=$(".slt-minite option:selected").val(),e="";"-"!=a&&(e+=a+" "),"-"!=b&&(e+=b),e+=c+":",e+=d;var f='<div class="i-b-time"><span>'+e+'</span><a class="msg-del"></a></div>';return $(".i-body").append(f),!1});var set_body_bg=function(){var a=$(".a-u-pic-bodybg img"),b=a.attr("src");$(".i-body").css("background-image","url("+b+")"),is_login};$("body").on("change",".a-u-pic-show input",function(){var img=document.createElement("img"),_this=$(this),callback=_this.attr("data-callback");window.URL=window.URL||window.webkitURL;var imgFile=$(this).get(0);if(window.URL&&imgFile.files[0]){var reader=new FileReader;reader.readAsDataURL(imgFile.files[0]),reader.onload=function(e){var img='<img src="'+this.result+'" alt=""/>';_this.parent().find("img").remove(),_this.parent().append(img),callback&&eval(callback+"()")}}}),$("#add-user").click(function(){var a=(new Date).valueOf(),b=$('<div class="add-user"><div class="a-u-pic"><div class="a-u-pic-show"><input type="file" accept="image/jpeg,image/x-png" /></div></div><div class="a-u-name"><p><span>用户名：</span><input class="a-u-data-name" type="text" value="" /></p><p><span>聊天内容：</span><textarea class="a-u-content'+a+'"></textarea><a class="a-u-face btn-add-face" data-input="a-u-content'+a+'" href="#">表情</a></p><p><span>转账/收钱金额：</span><input class="a-u-data-pay" type="text" value="" placeholder="转账/收钱金额" /></p><p><span>语音时长：</span><input class="a-u-data-voice create_time" type="text" value="" placeholder="语音时长" /></p><p><input style="margin-right:5px;" class="btn-rand-username" type="button" value="随机用户名" /><input class="btn-rand-face" type="button" value="随机头像" /></p></div><div class="a-u-dialog" style="clear:both;"><a class="btn btn-primary" data-type="left" href="#">添加文字对话</a></div><div class="a-u-dialog-voice"><a class="btn btn-primary" data-type="left" href="#">添加语音对话</a></div><div class="a-u-dialog-pay"><a class="btn btn-primary" data-dir="send" data-type="left" href="#">添加转账对话</a></div><div class="a-u-dialog-pay"><a class="btn btn-primary" data-dir="rec" data-type="left" href="#">添加收钱对话</a></div><div class="a-u-dialog-master"><a class="btn btn-primary" href="#">设为主人</a></div><div class="a-u-dialog-del"><a class="btn btn-danger" href="#">删除用户</a></div></div>');$(".users").append(b),b.find(".btn-rand-username").click()}),$("body").on("click",".a-u-dialog-del",function(){return confirm("您确认要删除？")&&$(this).parents(".add-user").remove(),!1}),$("body").on("click",".msg-del",function(){$(this).parents(".i-b-time,.i-b-rec-text,.i-b-sen-text").remove()}),$(".clear-dialog").click(function(){confirm("您确认要清除所有对话？")&&$(".i-b-time,.i-b-rec-text,.i-b-sen-text").remove()}),$("body").on("click",".a-u-dialog-pay a",function(){var a=$(this).attr("data-dir"),b=$(this).parents(".add-user"),c=b.find(".a-u-dialog-master a").hasClass("btn-success"),d=(b.index(),b.find(".a-u-name .a-u-data-name").val()),e=b.find(".a-u-name .a-u-data-pay").val(),f=$(this).parent().parent().find(".a-u-pic-show img").clone();if(""==d)return alert("请输入用户名！"),!1;if(""==e)return alert("请输入转账/收钱金额！"),!1;if(isNaN(e))return alert("您输入的金额有误！"),!1;f.length||(f='<img src="/asset/images/tools/default-head.png" />');var g=c?"i-b-sen-text":"i-b-rec-text",h="send"==a?"i-pay-send":"i-pay-rec",i=c?"":'<p class="i-b-nick">'+d+"</p>",j=$('<div class="'+g+'"><div class="i-b-pay">'+i+'<span class="'+h+'"><i></i><em>'+toDecimal2(e)+'</em><a class="msg-del"></a></span></div></div>');return j.prepend(f),$(".i-body").append(j),!1}),$("body").on("click",".a-u-dialog-voice a",function(){var a=$(this).parents(".add-user"),b=a.find(".a-u-name .a-u-data-name").val(),c=$(this).parent().parent().find(".a-u-pic-show img").clone(),d=a.find(".a-u-name .a-u-data-voice").val(),e=a.find(".a-u-dialog-master a").hasClass("btn-success");if(""==b)return alert("请输入用户名！"),!1;if(""==d)return alert("请输入语音时间！"),!1;if(isNaN(d))return alert("您输入的语音时间有误！"),!1;c.length||(c='<img src="/asset/images/tools/default-head.png" />');var f=e?"i-b-sen-text":"i-b-rec-text",g=e?"":'<p class="i-b-nick">'+b+"</p>",h=0,i=0;h=d>60?60:d,i=4.4*h+96;var j="",k=$('<div class="'+f+'"><div class="i-b-voice">'+g+'<span style="width:'+i+'px"><i></i><b></b><em>'+d+"''</em>"+j+'<a class="msg-del"></a></span></div></div>');return k.prepend(c),$(".i-body").append(k),!1}),$("body").on("click",".a-u-dialog-master a",function(){var a=$(this).parents(".users");return a.find(".a-u-dialog-master a").removeClass("btn-success"),$(this).addClass("btn-success"),!1}),$(".body_bg_del").click(function(){return $(".i-body").css("background-image","none"),$(".a-u-pic-bodybg img").remove(),!1}),$("#save").click(function(){var a=$(this),b=$("#iphone").clone(),c=$(".my-image"),d=$(".mask");return c.length||(c=$('<div class="my-image">成功生成图片，<a class="my-image-view" href="#">现在就查看</a> 或 <a class="my-image-continue" href="#">继续制作</a></div>'),$("body").append(c)),d.length||$("body").append('<div class="mask"></div>'),b.removeClass("iphone-preview"),b.prop("id","iphonePreview"),b.css({position:"relative"}),a.hide(),$("body").append(b),$(".loading").show(),$(".my-image,.mask").hide(),html2canvas(b,{onrendered:function(b){var c=b.toDataURL("image/png");$.post("/index.html",{data:c,type:1},function(b){b.status?($(".my-image a.my-image-view").attr("href",b.data.url),$(".my-image,.mask").show()):alert(b.data),$(".loading").hide(),a.show(),$("#iphonePreview").remove()})}}),!1}),$(function(){});
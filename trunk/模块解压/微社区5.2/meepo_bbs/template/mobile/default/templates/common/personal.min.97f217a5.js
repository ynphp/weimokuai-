!function(a,b){"function"==typeof define&&define.amd?define(b):a.TmplInline_actionsheet=b()}(this,function(){var a={},b=function(a){function b(b){return c("undefined"==typeof a[b]?this[b]:a[b])}function c(a){return"undefined"==typeof a?"":a}a=a||{};var d=b("title"),e=b("items"),f="";f+=" ",d&&(f+=' <div class="sheet-item sheet-title">',f+=c(d),f+="</div> "),f+=" ";for(var g=0;g<e.length;g++)f+=' <div class="sheet-item ',f+=c(e[g].type||""),f+='" value="',f+=c(g),f+='"> <div class="sheet-item-text" >',f+=c(e[g].text||e[g]),f+="</div> </div> ";return f+=' <div class="sheet-item" value="-1" > <div class="sheet-item-text">取消</div> </div> '};return a.frame="TmplInline_actionsheet.frame",Tmpl.addTmpl(a.frame,b),a}),function(a,b){a.ActionSheet=b(a.$,a.Tmpl)}(this,function(a,b){function c(){i=a('<div class="action-sheet"></div>'),h=a('<div class="action-sheet-mask"></div>'),a(document.body).append(i).append(h),h.on("tap",function(){f()}).on("webkitTransitionEnd",function(){h.hasClass("show")||h.hide()}),i.on("tap",".sheet-item",e).on("webkitTransitionEnd",function(){i.hasClass("show")||(h.removeClass("show"),i.hide())}),k=!0}function d(a){mqq.compare("4.7")>=0&&!a.useH5?mqq.ui.showActionSheet({items:a.items,cancel:"取消"},function(b,c){0===b?a.onItemClick&&a.onItemClick(c):a.onCancel&&a.onCancel(c)}):(k||c(),j=a,document.body.style.overflow="hidden",i.html(""),l.on("touchmove",g),b(window.TmplInline_actionsheet.frame,a).appendTo(i),h.show(),i.show(),setTimeout(function(){h.addClass("show"),i.addClass("show")},50))}function e(){var b=a(this).attr("value");b=Number(b),-1===b?j.onCancel&&j.onCancel():j.onItemClick&&j.onItemClick(b),f()}function f(a){i&&(a?(h.hide().removeClass("show"),i.hide().removeClass("show")):i.removeClass("show"),l.off("touchmove",g),document.body.style.overflow="")}function g(a){a.preventDefault()}var h,i,j,k,l=a(document);return{show:d,hide:f}}),function(a,b){a.ViewPreloader=b(a.$,a.DB)}(this,function(){var a,b=15e3;return a={canUseViewPreload:$.os.android&&mqq.compare("5.0")>=0,open:function(a){if(this.canUseViewPreload){var b=this,c=a.cgiMap;localStorage.setItem("storageConfirm",1),$.each(c,function(a,c){b.__send(a,c)})}this.__openView(a)},__openView:function(a){if(a.url){var b=a.url;this.canUseViewPreload&&(b+=b.indexOf("?")>-1?"&viewPreLoad=1":"?viewPreLoad=1"),Util.openUrl(b,!0)}else a.callback&&a.callback(this.canUseViewPreload?1:0)},__send:function(a,b){var c,d=this;DB.cgiHttp({url:b.cgi,param:b.param,type:"get",succ:function(b){try{c=b,localStorage.setItem("viewPreloadData-"+a,JSON.stringify(c)),mqq.dispatchEvent("preloadDataSuccess",{dataName:a,preloadData:c})}catch(e){localStorage.setItem("viewPreloadData-"+a,JSON.stringify({type:"error"})),d.__dispatchError(a)}},err:function(){localStorage.setItem("viewPreloadData-"+a,JSON.stringify({type:"error"})),d.__dispatchError(a)}})},__dispatchError:function(a){mqq.dispatchEvent("preloadDataError",{dataName:a})},__removeDataStorage:function(a){localStorage.removeItem("viewPreloadData-"+a)},__callbackHandler:function(a,b,c,d){c&&c({dataName:b,status:a,preloadData:d})},useViewPreload:function(){return~~(Util.queryString("viewPreLoad")||Util.getHash("viewPreLoad"))},receive:function(a,c){var d=this,e=this.useViewPreload();if(a=a||[],e){var f,g,h={},i=localStorage.getItem("storageConfirm");if(localStorage.removeItem("storageConfirm"),"1"===i){for(var j=0;j<a.length;j++)g=a[j],f=localStorage.getItem("viewPreloadData-"+g),f&&(f=JSON.parse(f),a.splice(j,1),j--,h[g]=1,"error"!==f.type?d.__callbackHandler(0,g,c,f):d.__callbackHandler(2,g,c)),this.__removeDataStorage(g);a.length&&($.each(a,function(a,b){d.__callbackHandler(1,b,c)}),mqq.addEventListener("preloadDataSuccess",function(a){var b=a.dataName;if(d.__removeDataStorage(b),!h[b]){h[b]=1;try{f=a.preloadData,f?d.__callbackHandler(0,b,c,f):d.__callbackHandler(2,b,c)}catch(e){d.__callbackHandler(2,b,c)}}}),mqq.addEventListener("preloadDataError",function(a){var b=a.dataName;d.__removeDataStorage(b),h[b]=1,d.__callbackHandler(2,b,c)}),setTimeout(function(){$.each(a,function(a,b){h[b]||(d.__removeDataStorage(b),d.__callbackHandler(3,b,c))})},b))}else d.__callbackHandler(4,g,c)}}}}),function(a,b){"function"==typeof define&&define.amd?define(b):a.TmplInline_person=b()}(this,function(){var a={},b=function(a){function b(b){return c("undefined"==typeof a[b]?this[b]:a[b])}function c(a){return"undefined"==typeof a?"":a}a=a||{};var d=b("_type"),e=b("_title"),f=b("followbarnum"),g=b("followbars"),h=b("imgHandle"),i=b("Util"),j=b("_isAdmin"),k="";k+='<div class="p-wrapper section-1px"> <h1 class ="p-title section-1px ',d&&(k+="unit_link"),k+='" ',d&&(k+=' data-action="toFollowBar" '),k+=' ><span class="icon icon-tribe"></span>',k+=c(e),k+=" ",d&&(k+="(",k+=c(f),k+=")"),k+=" ",d&&(k+='<span class="icon right-arrow"></span>'),k+='</h1> <ul class="p-follow-list"> ';for(var l=0;l<g.length;++l)k+=' <li class="section-1px unit_link" data-action="toBar" data-bid="',k+=c(g[l].bid),k+='" > <img class="p-round-img" src="',k+=c(h.getThumbUrl(g[l].pic,120)),k+='"> <ul class="info-list" > <li><h2>',k+=c(g[l].name),k+="</h2></li> <li><span>关注",k+=c(i.numHelper(g[l].fans)),k+="</span><span>今日话题",k+=c(i.numHelper(g[l].today_pids)),k+="</span></li> </ul> ",j||(k+=" ",1!==g[l].ifollowed?(k+='<div class="follow border-1px" data-action="bfollow" data-id="',k+=c(g[l].bid),k+='" >关注</div>'):(k+='<div class="followed" data-id="',k+=c(g[l].bid),k+='" >已关注</div>'),k+=" "),k+=" </li> ";return k+=" </ul> </div>"};a.followed_bar="TmplInline_person.followed_bar",Tmpl.addTmpl(a.followed_bar,b);var c=function(a){function b(b){return c("undefined"==typeof a[b]?this[b]:a[b])}function c(a){return"undefined"==typeof a?"":a}a=a||{};var d=b("faceurl"),e=b("userinfo"),f=b("isWeChat"),g=b("_isAdmin"),h=b("follow_other"),i=b("followers"),j=b("isFollow"),k=b("uin"),l=b("showXingYing"),m=b("hostDataAction"),n=b("xyRedPoint"),o=b("Number"),p=b("rynum"),q=b("ryStyle"),r=b("ryname"),s="";return s+='<div class=\'p-header\'> <div class="info-bar" > <div class="p-round-border"> <img class="p-round-img" data-action="scale" src="',s+=c(d),s+='"> </div> <ul> <li class="p-nick-name"><strong>',s+=c(e.nick_name),s+='</strong></li> <li class="p-info"><span>',1==e.gender?s+="男":2==e.gender&&(s+="女"),s+="</span> ",e.age>0&&(s+="<span>",s+=c(e.age),s+="岁</span>"),s+=" ",e.city&&(s+="<span>",s+=c(e.city),s+="</span>"),s+='</li> <li class="p-words p-fold" id="p_fold" data-action="expand" >',s+=c(e.lnick),s+="</li> </ul> </div> ",f||(s+=' <div class="follow-bar"> <div class="follow-wrapper ',g&&(s+="f-admin"),s+='" > <ul class="unit_link" data-action="toFollows" > <li>',s+=c(h),s+='</li> <li class="f-desc" >关注的人</li> </ul><div class="p-split"></div><ul class="unit_link fans" data-action="toFans" > <li><span id="fans_counter">',s+=c(i),s+='</span></li> <li class="f-desc" >粉丝</li> </ul> ',g||(s+=" ",0===j?(s+='<div id="follow_btn" class="p-btn blue follow" data-action="pfollow" data-id = "',s+=c(k),s+='" >关注</div> '):(s+='<div id="follow_btn" data-action="disfollow" class="p-btn blue followed" data-id = "',s+=c(k),s+='" >已关注</div> ')),s+=" </div> </div> "),s+=' <canvas style="display:block;" class="p-blur-bg" id="h_bg"></canvas> <div class="p-black-bg" ></div> </div> <div class="up-wrapper"> <div class="msg-wrapper section-1px unit_link" data-action=\'toMsg\' > <span class="icon icon-msg"></span>我的消息 <span class="icon right-arrow"></span> </div> ',l&&(s+=' <div data-action="',s+=c(m),s+='" class="honor-wrapper section-1px unit_link"> <span class="icon icon-star"></span>星影会员 ',n&&(s+=' <span class="vip-red-point">领取爱心<b></b></span> '),s+=' <span class="icon right-arrow"></span> </div> '),s+=" ",o(p)>0&&(s+=" <div data-action='toHonor' class='honor-wrapper section-1px unit_link'> <span class=\"icon icon-honor\"></span>荣誉 (",s+=c(p),s+=') <span class="icon right-arrow"></span> <span class="honor ',s+=c(q),s+='">',s+=c(r),s+="</span> </div> "),s+=" </div>"};a.header="TmplInline_person.header",Tmpl.addTmpl(a.header,c);var d=function(a){function b(b){return c("undefined"==typeof a[b]?this[b]:a[b])}function c(a){return"undefined"==typeof a?"":a}a=a||{};var d=b("rs"),e=b("_type"),f=b("_title"),g=b("total"),h=b("plain2rich"),i=b("imgHandle"),j=b("Util"),k=(b("width"),b("url"),b("height"),"");if(k+="",d.length<1)return"";k+=' <div class="p-wrapper section-1px"> <h1 class="p-title section-1px unit_link" data-action="toComment" data-type="reply" ',e&&(k+='data-forward="true"'),k+=' ><span class="icon ',k+=e?"icon-forward":"icon-reply",k+='"></span>',k+=c(f),k+=" (",k+=c(g),k+=') <span class="icon right-arrow"></span></h1> <ul class="p-reply-list"> ';for(var l=0;l<d.length;++l){var m=d[l].feed_value;if(k+=' <li class="section-1px unit_link" ',k+=m.reply&&!m.ref_comment?'data-action="toReply"':'data-action="toTopic"',k+=' data-pid="',k+=c(m.post.pid),k+='" data-bid = "',k+=c(m.bid),k+="\" data-cid = '",k+=c(m.cid),k+="' data-type=\"",k+=c(m.post.type),k+='" data-cate="',k+=c(e?"forward":"reply"),k+='" ',k+=c("openact"===m.post.post.from?'openactid="'+m.post.post.openact_id+'"':""),k+=' data-floor = "',k+=c(m.new_index||m.post.total),k+='" > ',m.reply?(k+=' <div class="p-r-reply" >回复',k+=c(m.prereply?m.prereply.nick:m.comment.user.nick_name),k+=": ",m.reply.pic_list&&m.reply.pic_list.length>0&&(k+="[图]"),m.reply.qqmusic_list&&m.reply.qqmusic_list.length>0&&(k+="[音乐]"),m.reply.video_list&&m.reply.video_list.length>0&&(k+="[视频]"),m.reply.audio_list&&m.reply.audio_list.length>0&&(k+="[音频]"),k+=c(h(m.reply.content,"",m.reply.urlInfo,!0)),k+="</div> "):m.ref_comment?(k+=' <div class="p-r-reply" >回复',k+=c(m.ref_comment.user.nick_name),k+=": ",m.comment.pic_list&&m.comment.pic_list.length>0&&(k+="[图]"),m.comment.qqmusic_list&&m.comment.qqmusic_list.length>0&&(k+="[音乐]"),m.comment.video_list&&m.comment.video_list.length>0&&(k+="[视频]"),m.comment.audio_list&&m.comment.audio_list.length>0&&(k+="[音频]"),k+=c(h(m.comment.content,"",m.comment.urlInfo,!0)),k+="</div> "):m.comment?(k+=' <div class="p-r-reply" >',m.comment.pic_list&&m.comment.pic_list.length>0&&(k+="[图]"),m.comment.qqmusic_list&&m.comment.qqmusic_list.length>0&&(k+="[音乐]"),m.comment.video_list&&m.comment.video_list.length>0&&(k+="[视频]"),m.comment.audio_list&&m.comment.audio_list.length>0&&(k+="[音频]"),k+=c(h(m.comment.content,"",m.comment.urlInfo,!0)),k+="</div> "):m.content&&(k+=' <div class="p-r-reply"> ',k+=c(h(m.content)),k+=" </div> "),k+=' <div class="p-r-topic" > ',m.post.post.audio_list&&m.post.post.audio_list.length&&(k+=' <div class="p-img" > ',m.post.user&&(k+=' <img src="',k+=c(i.getThumbUrl(m.post.user.pic,120)),k+='"> '),k+=' <span class="p-audio">',k+=c(j.formatDuration(m.post.post.audio_list[0].duration)),k+="</span> </div> "),k+=" ",m.post.post.video_list&&m.post.post.video_list.length&&(k+=' <div class="p-img" > <img src=\'http://shp.qpic.cn/qqvideo/0/',k+=c(m.post.post.video_list[0].vid),k+='/400\'> <span class="p-video"></span> </div> '),k+=" ",m.post.post.qqmusic_list&&m.post.post.qqmusic_list.length&&(k+=' <div class="p-img" > <img src=\'',k+=c(i.getThumbUrl(m.post.post.qqmusic_list[0].image_url,120)),k+='\'> <span class="p-music"></span> </div> '),k+=" ",400!=m.post.type&&m.post.post.pic_list&&m.post.post.pic_list.length>0){var n=i.formatThumb(m.post.post.pic_list,!0,65,65);if(!n[0].url){var o={width:65,url:n[0],height:65};n[0]=o}k+=' <div class="p-img" > <img style="width:',k+=c(n[0].width),k+="px; height:",k+=c(n[0].height),k+="px; margin-left:",k+=c(n[0].marginLeft),k+="px; margin-top:",k+=c(n[0].marginTop),k+='px;" src="',k+=c(n[0].url),k+='"> ',n.length>1&&(k+=' <span class="p-banner">共',k+=c(n.length),k+="张</span> "),k+=" </div> "}k+=" ",(200===m.post.type||201===m.post.type)&&(k+=" ",m.post.post.image1&&(k+=' <div class="p-img" > <img width="65" height="65" src="',k+=c(i.getThumbUrl(m.post.post.image1,120)),k+='"> </div> '),k+=" "),k+=' <h2 class="p-r-title" >',k+=c(h(m.post.title)),k+='</h2> <p class="p-r-content" >',k+=c(h(m.post.post.content,"",m.post.post.urlInfo,!0)),k+="</p> </div> </li> "}return k+=" </ul> </div> "};a.reply="TmplInline_person.reply",Tmpl.addTmpl(a.reply,d);var e=function(a){function b(b){return c("undefined"==typeof a[b]?this[b]:a[b])}function c(a){return"undefined"==typeof a?"":a}a=a||{};var d=b("rs"),e=b("_type"),f=b("_title"),g=b("total"),h=b("Util"),i=b("imgHandle"),j=b("plain2rich"),k="";if(k+="",d.length<1)return"";k+=' <div class="p-wrapper section-1px"> <h1 class="p-title section-1px unit_link" data-action="toTopicList" data-type="',k+=c(e),k+='" ><span class="icon ',k+="liked"==e?"icon-like":"icon-topic",k+='"></span>',k+=c(f),k+=" (",k+=c(g),k+=') <span class="icon right-arrow"></span></h1> <ul class="p-topic-list"> ';for(var l=0;l<d.length;++l){var m=d[l].feed_value;if(k+=' <li class="section-1px unit_link" data-action="toTopic" data-type="',k+=c(m.type),k+='" data-pid="',k+=c(m.pid),k+='" data-bid = "',k+=c(m.bid),k+='" data-cate="',k+="liked"==e?"like":"pub",k+='" ',k+=c("openact"===m.post.from?'openactid="'+m.post.openact_id+'"':""),k+="> ",m.post.audio_list&&m.post.audio_list.length>0&&(k+=' <div class="p-topic-img"> <img src="',k+=c(m.post.user.pic),k+='"> <span class="p-audio">',k+=c(h.formatDuration(m.post.audio_list[0].duration)),k+="</span> </div> "),k+=" ",m.post.video_list&&m.post.video_list.length>0&&(k+=' <div class="p-topic-img"> <img src=\'http://shp.qpic.cn/qqvideo/0/',k+=c(m.post.video_list[0].vid),k+='/400\' > <span class="p-video"></span> </div> '),k+=" ",m.post.qqmusic_list&&m.post.qqmusic_list.length>0&&(k+=' <div class="p-topic-img"> <img src=\'',k+=c(i.getThumbUrl(m.post.qqmusic_list[0].image_url,120)),k+='\' > <span class="p-music"></span> </div> '),k+=" ",(200==m.type||201==m.type)&&(k+=' <div class="p-topic-img"> <img src=\'',k+=c(i.getThumbUrl(m.post.image1,120)),k+='\' width="65" height="65" > </div> '),k+=" ",400!=m.type&&m.post.pic_list&&m.post.pic_list.length>0){var n=i.formatThumb(m.post.pic_list,!0,90,90);n=n[0],k+=' <div class="p-topic-img"> <img src="',k+=c(n.url),k+='" style="width:',k+=c(n.width),k+="px; height:",k+=c(n.height),k+="px; margin-left:",k+=c(n.marginLeft),k+="px; margin-top:",k+=c(n.marginTop),k+='px;" > ',m.post.pic_list.length>1&&(k+=' <span class="p-banner">共',k+=c(m.post.pic_list.length),k+="张</span> "),k+=" </div> "}if(k+=' <div class="p-t-wrapper" > <h2 class="p-t-title">',k+=c(j(m.title)),k+="</h2> ",""!==m.post.content&&(k+=' <p class="p-t-content">',k+=c(j(m.post.content,"",m.post.urlInfo,!0)),k+="</p> "),k+=" </div> ",400===m.type&&m.post.pic_list){{h.resizeImg(m.post.pic_list[0])}k+=' <div class="p-img-gallery"> ';for(var o=0,p=m.post.pic_list;o<p.length&&3>o;++o){var q=i.formatThumb(m.post.pic_list,!0,100,100);k+=' <div class="p-g-img"><img src = "',k+=c(q[o].url),k+='" style="width:',k+=c(q[o].width),k+="px; height:",k+=c(q[o].height),k+="px; margin-left:",k+=c(q[o].marginLeft),k+="px; margin-top:",k+=c(q[o].marginTop),k+='px;" >',2==o&&p.length>3&&(k+='<span class="p-banner" >共',k+=c(p.length),k+="张</span>"),k+="</div> "}k+=" </div> "}k+=" </li> "}return k+=" </ul> </div>"};return a.topic="TmplInline_person.topic",Tmpl.addTmpl(a.topic,e),a}),function(a,b){"function"==typeof define&&define.amd?define(["imgHandle"],b):a.imgHandle=b(a.imgHandle)}(this,function(a){a=a||{};var b,c,d,e,f,g,h,i,j,k,l;b=function(a,b,c){b.removeAttribute(c),g(a,b)},c="http://pub.idqqimg.com/qqun/xiaoqu/mobile/img/hot-error.png",d=function(a,b,d){c&&d!==c&&b.parentNode&&(b.src=c,b.className+=" error",b.style.marginTop="0px",b.parentNode.className+=" err-img"),Badjs("image error: "+d,location.href,0,387647,2,504991),console.error("image error: "+d)},e=function(a,b,c,d){if(!a)return{url:"img/error.png",w:0,h:0,t:"",marginTop:0};b=b||328,c=c||228,d=d||50;var e=a.w,f=a.h;if(b>e)return d>f&&(a.marginTop=(d-f)/2+"px"),a;var g=f/e*b,h=0;return g>c&&(h=(c-g)/2+"px"),{url:a.url,w:b,h:g,t:a.t,marginTop:h}},f=function(a,b,c,d,e){if(a&&a.length){var f;if(1!==a.length||b)for(var g=0,h=a.length;h>g;g++)f=a[g],c=e?c||77:Math.min(f.w||c,c)||77,d=e?d||77:Math.min(f.h||d,d)||77,f.boxWidth=f.width=c,f.boxHeight=f.height=d,f.marginTop=0,f.marginLeft=0,f.w&&f.h&&(f.h*c/f.w>d?(f.height=f.h*c/f.w,f.marginTop=.382*(f.boxHeight-f.height)):(f.width=f.w*d/f.h,f.marginLeft=(f.boxWidth-f.width)/2));else f=a[0],c=Math.min(f.w||c,c)||150,d=Math.min(f.h||d,d)||225,f.boxWidth=f.width=c,f.boxHeight=f.height=d,f.marginTop=0,f.marginLeft=0,f.w&&f.h&&(f.h*c/f.w>d?(f.width=f.w*d/f.h,f.boxWidth=f.width):(f.height=f.h*c/f.w,f.boxHeight=f.height))}return a},g=function(a,b){if(b.getAttribute("noSize")&&""!==b.getAttribute("noSize")){for(var c=b.getAttribute("noSize").split("&"),d={},e=0;e<c.length;e++)d[c[e].split(":")[0]]=c[e].split(":")[1];try{(a.target.width<50||a.target.height<50)&&window.location.pathname.indexOf("/index.html")>-1&&b.parentNode&&$(b).parent().hasClass("feed-img")&&(b.parentNode.style.display="none",$(b).parents(".img-wrap").find(".total-img").hide())}catch(g){}var h=d.w,i=[{w:a.target.width,h:a.target.height,url:a.target.src}],j=d.h;i=f(i,!0,h,j,!0),b.style.cssText="width:"+i[0].width+"px; height:"+i[0].height+"px;margin-left:"+i[0].marginLeft+"px; margin-top:"+i[0].marginTop+"px;"}"true"===b.getAttribute("needHideBg")&&b.parentNode&&(b.parentNode.className+=" hide-bg"),"true"===b.getAttribute("hidebg")&&b.parentNode&&(b.parentNode.style.background="none")};var m=function(a,b){a=a||"";var c=a;"object"==typeof c&&(c.t&&"gif"===c.t&&(a+="0"),a=c.url),a.indexOf("mmbiz.qpic.cn")>-1&&$.os.ios&&(a=a.replace("tp=webp",""));var d=a.split("/");return!d[d.length-1]&&"0"!==d[d.length-1]||-1!==a.indexOf("ugc.qpic.cn/gbar_pic")?(a.indexOf("p.qlogo.cn")>-1?a+="0":a.indexOf("p.qpic.cn")>-1||a.indexOf("ugc.qpic.cn/qqac/")>-1?a+="160":a.indexOf("ugc.qpic.cn/gbar_pic")>-1&&(a=a.replace(/\/(\d+)$/,"/"),a+=b||"200"),a):(a.indexOf("ugc.qpic.cn/qqac/")>-1&&(d[d.length-1]="160",a=d.join("/")),a)};return k=document.documentElement.clientHeight,$(document).on("touchmove",function(){l=document.body.scrollTop;for(var a,b,c=0;c<i.length&&(a=i[c],b=a.getBoundingClientRect().top,1.5*k>b-l);c++)j(a),i.splice(c,1)}),i=[],j=function(a,c){c=c||"lazy-src";var e=a.getAttribute(c);if(e){a.setAttribute("page-lazyload-time",Date.now());var f=[951766002,1310720359,1591771530,1873705937,2024781614,2062695960,2359834172,2410808470,2716387061,2794353141,2795169601,2795341204,2842800574,2892764449,2894406678,2915266032,2923136367,2978718130,2982660671,2995344389];a.onerror=function(b){var c=a.getAttribute("data-festival-uin"),g=c%20;if(c){var h=$(a).addClass("offline-pic avatar-"+f[g]);h.removeAttr("src")}else d(b,a,e)},a.onload=function(d){b(d,a,c)},a.src=e}},h=function(a){if(a){var b;if(l=document.body.scrollTop,"IMG"===a.tagName)return b=a.getBoundingClientRect().top,void(l+k>b?j(a):i.push(a));for(var c=a.getElementsByTagName("img"),d=0,e=c.length;e>d;d++)a=c[d],b=a.getBoundingClientRect().top,l+k>b?j(a):i.push(a)}},a.setErrImg=function(a){c=a},a.lazy=h,a.format=e,a.formatThumb=f,a.getThumbUrl=m,a.dealWithFeedImage=g,a}),function(a,b){a.PersonalHome=b(a.$,a.DB)}(this,function(){function a(a){for(var b,c=0,d=a.length,e=0;d>c;++c){var f=a[c].feed_value.post.pic_list;if(console.log(f),f)for(e=0;e<f.length;++e)f[e].url||(b=f[e],f[e]={url:f[e],w:0,h:0}),f[e].url=imgHandle.getThumbUrl(f[e].url,"120")}}function b(a){setTimeout(function(){ActionSheet.show({useH5:!0,title:"取消关注后与他相关的内容将不会在动态中展示",items:["<span style='color:red;'>取消关注</span>"],onItemClick:function(){a&&a()},onCancel:function(){}})},50)}function c(a,b){var d,e;for(d in a)"object"==typeof a[d]?a[d]=c(a[d],b):(e=b(d,a[d]),e&&(a[d]=e));return a}function d(){ViewPreloader.useViewPreload()?(ViewPreloader.receive(["personal_top_data"],function(a){var b=(a.dataName,a.preloadData),c=a.status;(0==c||1==c)&&(s.fromPreview=s.usePreLoad=!0),0==c?(s.setPreLoadData(b),s.rock()):1==c?s.rock():(s.previewDataError=!0,s.fromPreview=s.usePreLoad=!1,s.rock(),Q.monitor(601697),4==c&&Q.monitor(516236))}),Q.monitor(492168)):s.rock(),D.bind(),i&&i.timing&&Q.huatuo(1486,1,5,i.timing.responseStart-i.timing.navigationStart,1)}var e=window.ABTest.isInTest(),f=function(a,b){var c,d={opername:"Grp_tribe",module:"person_data",action:a,ver1:Util.queryString("bid")||Util.getHash("bid"),ver3:Number(Util.getHash("uin")||Util.queryString("uin"))===Login.getUin()?"0":"1"};for(c in b)b.hasOwnProperty(c)&&(d[c]=b[c]);Q.tdw(d)},g={hof:1,detail:2,fans:3,hoflist:4,around:5,personalcard:6,barrank:4,dongtai:8,follow_list:9,qunmingpian:7},h=/\bMicroMessenger\/[\d\.]+/.test(navigator.userAgent),i=window.performance,j=!1,k=Login.getUin()+"",l=(Util.queryString("preload"),!1),m=Util.getHash("uin")||Util.queryString("uin")||"";0===Number(m)&&(m=Login.getUin()),""===m&&(m=k),m+="";Util.numHelper=numHelper,Util.formatDuration=function(a){a=Number(a);var b=a%60,c=~~(a/60);return(c>=10?c:"0"+c)+":"+(b>=10?b:"0"+b)},Util.resizeImg=function(a){var b=a,c=196,d=b.w/b.h,e=b.w,f=b.h;return b.w>b.h?b.w>c&&(e=c,f=c/d):b.h>c&&(f=c,e=f*d),b._width=e,b._height=f,b};var n,o={_send:function(a,b,c){DB.cgiHttp({url:a,type:"POST",param:b,succ:function(a){c&&c(a)},err:function(){}})},person:function(a,b,c){var d={targetuin:a,operation:c||1};this._send("/cgi-bin/bar/card/follow",d,b)},bar:function(a,b){var c={bid:a,op:1};this._send("/cgi-bin/bar/user/fbar",c,b)},setFollowedPerson:function(a,b){this.isFollowed=a?!0:!1,this.onFollowed(this.isFollowed,b)},onFollowed:function(){}},p="";n=function(a){mqq.dispatchEvent("follow-person-evt",{uin:m,type:a},{echo:!1,broadcast:!0})},o.onFollowed=function(a,b){$f_Btn=$("#follow_btn"),$fans_counter=$("#fans_counter");var c=parseInt($fans_counter.html(),10);a?(p="取消关注",b||(Tip.show("关注成功"),$f_Btn.html("已关注"),$f_Btn[0].setAttribute("data-action","disfollow"),$f_Btn.addClass("followed"),$fans_counter.html(++c),n(1))):(p="关注",b||(Tip.show("取消关注成功"),$f_Btn.html("关注"),$f_Btn[0].setAttribute("data-action","pfollow"),$f_Btn.removeClass("followed"),$fans_counter.html(--c),n(2)))},m!==k?(f("Clk_guest"),h||ActionButton.build({hidden:!1,iconID:3},function(){ActionSheet.hide();var a=["投诉"];j&&a.unshift("拉黑用户"),a.unshift(p),f("Clk_more"),ActionSheet.show({items:a,onItemClick:function(a){if(0===a)if(o.isFollowed)f("Clk_more_unfol"),b(function(){o.setFollowedPerson(!1),o.person(m,function(a){0===a.retcode&&a.result&&0===a.result.errCode},2)});else{var c=Util.getHash("scene");""==c&&(c=Util.getHash("from")),f("Clk_more_fol",{ver4:g[c]}),o.setFollowedPerson(!0),o.person(m,function(a){0===a.retcode&&a.result&&0===a.result.errCode})}else j&&1===a?DB.cgiHttp({url:"/cgi-bin/bar/admin/fake",param:{targetuin:m},succ:function(){Tip.show("操作成功")},err:function(){Tip.show("操作失败",{type:"warning"})}}):(Tip.show("投诉成功"),f("Clk_more_report"))},onCancel:function(){}})})):f("Clk_host");var q=!1,r=0;$.os.ios?r=3:$.os.android&&(r=2);var s=new renderModel({comment:"headerModel",renderTmpl:TmplInline_person.header,cgiName:"/cgi-bin/bar/card/merge_top",param:{targetuin:m,plat:r},renderContainer:"#header",processData:function(a,b){var c={},d=0;d=m===Login.getUin(),a.result.hostDataAction=d?"toXY_host":"toXY_guest",a.result.vip_flag?(a.result.showXingYing=1,d?window.setTimeout(function(){f("entry_host",{module:"member_center"})},300):window.setTimeout(function(){f("entry_guest",{module:"member_center"})},300)):d?(a.result.showXingYing=1,window.setTimeout(function(){f("entry_host",{module:"member_center"})},300)):a.result.showXingYing=0,d&&a.result.vip_flag&&(c=a.result.get_love_info,c&&0===c.err&&0===c.today_get_loved&&(a.result.xyRedPoint=1)),parseInt(m,10)===parseInt(k,10)&&(a.result._isAdmin=!0),a.result.uin=m,a.result.isWeChat=h,$("#loading").remove();var e={"酋长":"vice-admin","铁杆粉":"best-fan","达人":"activity-user"};a.result.ryStyle=e[a.result.ryname],a.result.followbars&&a.result.followbars.length>0&&(a.result._title="关注的部落",a.result._type=!0),0==b?s.fromPreview?Q.huatuo(1486,1,5,Date.now()-window.pageStartTime,6):s.previewDataError||Q.huatuo(1486,1,5,Date.now()-window.pageStartTime,4):1==b&&(s.fromPreview?Q.huatuo(1486,1,5,Date.now()-window.pageStartTime,5):s.previewDataError||Q.huatuo(1486,1,5,Date.now()-window.pageStartTime,3))},complete:function(a,b){var c=document.getElementById("h_bg"),d=c.getContext("2d"),e=new Image,f="";a.result.faceurl?(f=a.result.faceurl.replace(/&amp;/g,"&"),e.src=f):e.src="http://pub.idqqimg.com/pc/qqfind/face/1_100.gif",h&&(B=f),b>0&&(e.onload=function(){var a=e.width,b=e.height,f=c.offsetWidth,g=c.offsetHeight,h=a/b;f>a&&(a=3*f,b=a/h),g>b&&(b=3*f,a=b*h),d.drawImage(e,-a/3,-b/3,a,b)}),1&a.result.admin_ext&&(j=!0),o.setFollowedPerson(a.result.isFollow,!0),a.result.followbars&&a.result.followbars.length>0?(a.result._title="关注的部落",a.result._type=!0):(q=!0,1===b&&u.rock()),m==k&&$(".msg-wrapper").show()},error:function(a){this.getCache(0)||Tip.show("获取用户信息失败["+a.retcode+"]",{type:"warning"})}}),t=new renderModel({comment:"focusModel",renderTmpl:TmplInline_person.followed_bar,renderContainer:"#follow_bar"}),u=t.extend({comment:"visitedModel",cgiName:"/cgi-bin/bar/card/visited",param:{num:3,start:0,targetuin:m},processData:function(a){a.result._title="访问过的部落",a.result._type=!1,l=!0},complete:function(){}}),v=new pageModel;v.add(s),q||(v.add(t),s.feed(t));var w=new renderModel({comment:"pulishModel",cgiName:"/cgi-bin/bar/card/topic_fix",renderTmpl:TmplInline_person.topic,param:{fixtotal:1,neednum:3,startnum:0,type:1,targetuin:m},renderContainer:"#pulish",processData:function(b){b.result._title="发表的话题",b.result._type="pulished";for(var c=0;c<b.result.rs.length;++c)b.result.rs[c].feed_value.post&&(b.result.rs[c].feed_value.post.user=b.result.rs[c].feed_value.user);a(b.result.rs)},error:function(a){this.getCache(0)||Tip.show("获取帖子失败["+a.retcode+"]",{type:"warning"})}}),x=w.extend({comment:"replyModel",renderTmpl:TmplInline_person.reply,param:{fixtotal:1,neednum:3,startnum:0,type:100,targetuin:m},renderContainer:"#reply",processData:function(a){a.result._title="评论的话题",c(a.result.rs,function(a,b){return"url"===a?imgHandle.getThumbUrl(b,"120"):"total"===a?Number(b)+1:void 0})}}),y=w.extend({comment:"likedModel",renderTmpl:TmplInline_person.topic,param:{fixtotal:1,neednum:3,startnum:0,type:3,targetuin:m},renderContainer:"#liked",processData:function(b){b.result._title="赞过的话题",b.result._type="liked";for(var c,d=0;d<b.result.rs.length;++d)c=b.result.rs[d].feed_value.post.user,b.result.rs[d].feed_value.pid=b.result.rs[d].feed_value.post.pid,b.result.rs[d].feed_value.bid=b.result.rs[d].feed_value.post.bid,b.result.rs[d].feed_value.title=b.result.rs[d].feed_value.post.title,b.result.rs[d].feed_value.type=b.result.rs[d].feed_value.post.type,b.result.rs[d].feed_value.post=b.result.rs[d].feed_value.post.post,b.result.rs[d].feed_value.post.user=c;a(b.result.rs)}}),z=w.extend({cgiName:"/cgi-bin/bar/card/forward",comment:"forward",renderTmpl:TmplInline_person.reply,param:{fixtotal:1,neednum:3,startnum:0,type:100,targetuin:m},renderContainer:"#forward",processData:function(a){a.result._title="转发的话题",a.result._type="forward",c(a.result.rs,function(a,b){return"url"===a?imgHandle.getThumbUrl(b,"120"):"total"===a?Number(b)+1:void 0})}}),A=new pageModel;A.add(w),e?(A.add(z),m===k&&(A.add(x),A.add(y))):(A.add(x),A.add(y)),A.rock();var B="",C=function(a){DB.cgiHttp({url:"/cgi-bin/bar/user/oface",type:"GET",param:{img_type:5,ul:"["+m+"]"},succ:function(a){0===a.retcode&&(B=a.result.face_list[0].url)},err:function(){a&&a()}})};h||C();var D={isBind:!1,bind:function(){this.isBind||(this.isBind=!0,$("body").on("tap",function(a){{var c=a.srcElement||a.target,d=c.getAttribute("data-action");c.getAttribute("data-id")}switch(d){case"bh":break;case"scale":window.ImageView&&ImageView.init([{name:"",mbimg:B}],0,{useNavigate:!0,maxZoom:3,hideInfo:!0});break;case"pfollow":var e=Util.getHash("scene");""==e&&(e=Util.getHash("from")),f("Clk_fol_button",{ver4:g[e]}),o.person(m,function(){}),o.setFollowedPerson(!0);break;case"disfollow":f("Clk_unfol_button"),b(function(){o.person(m,function(){},2),o.setFollowedPerson(!1)});break;case"expand":f("Clk_more"),$("#down_arrow").hide(),$("#p_fold").removeClass("p-fold")}}),$("body").on("tap",".unit_link",function(a){var b=a.srcElement||a.target,c=this,d=c.getAttribute("data-action"),e=b.getAttribute("data-action");if("bfollow"==e){f(l?"Clk_focus_visied":"Clk_focus_fol");var g=b.getAttribute("data-id");return Tip.show("关注成功"),o.bar(g,function(){}),b.removeAttribute("data-action"),b.innerHTML="已关注",void(b.className=b.className.replace("follow","followed"))}switch(c.classList.add("active"),setTimeout(function(){c.classList.remove("active")},100),d){case"toBar":f(l?"Clk_thumb_visited":"Clk_thumb_fol"),setTimeout(function(){Util.openUrl("http://xiaoqu.qq.com/mobile/barindex.html#bid="+c.getAttribute("data-bid")+"&scene=personal",!0),c.classList.remove("active")},100);break;case"toTopic":var h=Number(c.getAttribute("data-type")),i=c.getAttribute("openactid"),j=c.getAttribute("data-floor");if(f("Clk_thumb_"+c.getAttribute("data-cate")),i)Util.openQunAct(i);else{var k=c.getAttribute("data-cate"),n={"#bid":c.getAttribute("data-bid"),"#pid":c.getAttribute("data-pid"),"#lnum":j,"#source":"personal"};"forward"===k&&(n["#nojump"]="true"),setTimeout(function(){Util.openDetail(n,!1,h)},100)}break;case"toFollowBar":f(l?"Clk_thumb_visited":"Clk_entry_fol");var p="http://xiaoqu.qq.com/mobile/my_follow_bar.html";E.init(),E.usePreload&&(p+="?preload=followBar"),setTimeout(function(){Util.openUrl(p+"#uin="+m,!0)},100);break;case"toHonor":f("Clk_honor"),setTimeout(function(){Util.openUrl("http://xiaoqu.qq.com/mobile/my_honor.html#uin="+m,!0),c.classList.remove("active")},100);break;case"toXY_host":setTimeout(function(){Util.openUrl("http://imgcache.qq.com/club/themes/mobile/xylm/business/personal_center/center.html?isHost=1",!0),c.classList.remove("active")},100);break;case"toXY_guest":setTimeout(function(){Util.openUrl("http://imgcache.qq.com/club/themes/mobile/xylm/business/personal_center/center.html?isHost=0",!0),c.classList.remove("active")},100);break;case"toMsg":f("Clk_msg"),setTimeout(function(){Util.openUrl("http://xiaoqu.qq.com/mobile/my_related.html",!0),c.classList.remove("active")},100);break;case"toReply":setTimeout(function(){Util.openUrl("http://xiaoqu.qq.com/mobile/reply_detail.html#bid="+c.getAttribute("data-bid")+"&pid="+c.getAttribute("data-pid")+"&cid="+c.getAttribute("data-cid")+"&ver4=0",!0),c.classList.remove("active")},100);break;case"toTopicList":var h=c.getAttribute("data-type");f("liked"===h?"Clk_entry_like":"Clk_entry_pub"),setTimeout(function(){Util.openUrl("http://xiaoqu.qq.com/mobile/person_topic.html#uin="+m+"&type="+h,!0)},100);break;case"toFollows":f("Clk_fol"),setTimeout(function(){Util.openUrl("http://xiaoqu.qq.com/mobile/person_society.html#uin="+m+"&type=follow_list",!0)},100);break;case"toFans":f("Clk_fan"),setTimeout(function(){Util.openUrl("http://xiaoqu.qq.com/mobile/person_society.html#uin="+m+"&type=fans",!0)},100);break;case"toComment":var q=c.getAttribute("data-forward"),r="http://xiaoqu.qq.com/mobile/person_comment.html#uin="+m;q&&(r+="&show=forward"),f("Clk_entry_reply"),setTimeout(function(){Util.openUrl(r,!0)},100)}}),Q.huatuo(1486,1,5,Date.now()-window.pageStartTime,2))},unbind:function(){this.isBind=!1}},E={usePreload:function(){return!$.os.ios&&mqq.compare("5.0")>=0}(),pushBarData:!1,followBarData:{},init:function(){if(this.usePreload){var a=this;a.getFollowBarData(),mqq.addEventListener("requestFollowBarData",function(){console.debug("requestFollowBarData事件触发..."),a.followBarData?(console.debug(a.followBarData),mqq.dispatchEvent("preloadFollowBarData",a.followBarData)):a.pushBarData=!0})}},getFollowBarData:function(){if(this.usePreload){var a={uin:m||Util.getHash("uin")||Util.queryString("uin"),neednum:10,startnum:0},b=+new Date,c=this;console.debug("开始预拉取CGI数据"),DB.cgiHttp({url:"/cgi-bin/bar/card/bar_list_by_page",type:"get",param:a,succ:function(a){c.followBarData={data:a||{}},Q.isd(7832,47,18,Date.now()-b,13,null,"network",!0),c.pushBarData&&(console.debug("CGI返回后主动推送数据"),mqq.dispatchEvent("preloadFollowBarData",c.followBarData))},err:function(){c.followBarData={type:"error"},console.warn("CGI数据获取失败"),mqq.dispatchEvent("preloadFollowBarData",c.followBarData)
}})}}};return mqq.addEventListener("event_focus_tribe",function(){window.location.reload()}),{load:function(){mqq.ui.setLoading({visible:!1}),d(),Q.monitor(487462)},error:function(){}}});
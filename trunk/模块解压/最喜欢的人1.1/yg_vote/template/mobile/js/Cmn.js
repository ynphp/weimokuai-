Cmn_PostLogErrorCount = 0; var Cmn = { Cfg: { FillDataClassPrefix: "dat-", Paging: { First: ".pagFirst", Pre: ".pagPre", Next: ".pagNext", Last: ".pagLast", Num: ".pagNum", More: ".pagMore" }, LineSplitFotTemplate: "#s#", LogWriteUrl: "/CmnAjax/CmnAjax.aspx/WriteLog", IsWebMethod: "Auto" }, FillHtmlCache: {}, GetFillHtml: function (a) { var b = ""; return b = Cmn.FillHtmlCache[a], (null == b || void 0 == b) && (b = "", $(a).each(function () { var a = Cmn.Func.GetOuterHtml($(this)); "" != a && ("" != b && (b += Cmn.Cfg.LineSplitFotTemplate), b += a), $(this).hide() }), Cmn.FillHtmlCache[a] = b), b }, RemoveFillHtml: function (a) { Cmn.FillHtmlCache[a] = null }, alert: function (a) { alert(a) }, Log: function (msg, isShowInPage) { try { console.log(msg) } catch (e) { } 3 >= Cmn_PostLogErrorCount && $.ajax({ type: "Post", url: this.Cfg.LogWriteUrl, data: '{msg:"' + msg.replace(new RegExp('"', "g"), '\\"') + '"}', contentType: Cmn.Func.IsWebMethod(this.Cfg.LogWriteUrl) ? "application/json;charset=uft-8" : "application/x-www-form-urlencoded", dataType: "text", success: function (retData) { var _tmpVal = ""; try { _tmpVal = eval("(" + retData + ")").d, _tmpVal || (_tmpVal = retData) } catch (err) { _tmpVal = retData } return "success" == _tmpVal && (Cmn_PostLogErrorCount = 0), !0 }, error: function () { return Cmn_PostLogErrorCount += 1, !1 } }) }, IsDebuging: null, DebugLogCache: "", DebugLog: function (a) { var b, d, e, f, g; if (Cmn.IsDebuging !== !1 && (null === Cmn.IsDebuging && (Cmn.IsDebuging = "1" == Cmn.Func.GetParamFromUrl("ShowDebugLog") ? !0 : !1), 1 == Cmn.IsDebuging)) { b = new Date, a = "[" + b.getHours() + ":" + b.getMinutes() + ":" + b.getSeconds() + "] " + a; try { console.log(a) } catch (c) { } for ($("body .DebugLog").length <= 0 && ($("body").append("<div class='DebugLog' style='position:fixed;right:4px;bottom:4px;font-size:12px;z-index:10001;color:#ffffff;padding:2px;padding-left:6px;padding-right:6px; background:rgba(33, 33, 33, 0.4) none repeat scroll 0 0 !important;filter:Alpha(opacity=40);background:#333333;'> <span style='position:relative;font-size:16px;' class='LogText'> Debuging... </span></div>"), $("body .DebugLog").off("click").on("click", function () { var a = $(this); a.hasClass("hide") ? a.width(640).removeClass("hide") : a.width(50).addClass("hide") })), d = Cmn.DebugLogCache.split("<br/>"), e = a, f = 0; f < d.length && 9 > f; f++) e += "<br/>" + d[f]; Cmn.DebugLogCache = e, $("body .DebugLog .LogText").html(e), g = $("body").width(), $("body .DebugLog .LogText").css("font-size", 14 + (g - 600) / 10 / 5 + "px") } }, FillDataByClass: function (a, b) { var c, d; if (Cmn.Func.IsArray(b) || (c = b, b = new Array, b[0] = c), b.length > 0) for (d in b[0]) $(a + " ." + Cmn.Cfg.FillDataClassPrefix + d).html(b[0][d]); return 1 }, FillData: function (a, b, c, d) { var e, f, g, h, i, j, k, l, m, n, o, q, r, s, t; if ("undefined" == typeof c && (c = !1), Cmn.Func.IsArray(b) || (e = b, b = new Array, b[0] = e), Cmn.Func.IsArray(a)) { for (f = new Array(a.length), g = 0; g < f.length; g++) f[g] = Cmn.GetFillHtml(a[g]).split(Cmn.Cfg.LineSplitFotTemplate); for (h = new Array(a.length), i = "", j = 0, k = -1, "undefined" == typeof d ? d = !1 : d && c && (k = 1e5), g = 0; g < h.length; g++) h[g] = ""; for (g = 0; g < b.length; g++) { if (k += 1, k >= f[j].length) if (k = 0, d && c) for (l = $(a[0]).parent().height(), m = 0, j = 0, n = 1; n < a.length; n++) m = $(a[n]).parent().height(), l > m && (l = m, j = n); else j += 1, j >= f.length && (j = 0); i = f[j][k]; for (o in b[g]) { null == b[g][o] && (b[g][o] = ""), i = Cmn.Func.SetDataToHtmlStr(i, "dat-" + o, b[g][o]); try { i = i.replace(new RegExp("{" + o + "}", "g"), b[g][o]) } catch (p) { } } h[j] += i, c && d && ($(a[j]).first().parent().append(h[j]), h[j] = "") } if (c) { if (!d) for (g = 0; g < a.length; g++) $(a[g]).first().parent().append(h[g]) } else for (g = 0; g < h.length; g++) "" == h[g] ? $(a[g]).hide() : (q = !1, $(a[g]).each(function () { q ? $(this).remove() : ($(this).replaceWith(h[g]), q = !0) })) } else { if (r = Cmn.GetFillHtml(a), null == r || void 0 == r) return $(a).hide(), -1; for (h = "", i = "", s = r.split(Cmn.Cfg.LineSplitFotTemplate), t = 0, g = 0; g < b.length; g++) { i = s[t], t += 1, t >= s.length && (t = 0); for (o in b[g]) { null == b[g][o] && (b[g][o] = ""), i = Cmn.Func.SetDataToHtmlStr(i, "dat-" + o, b[g][o]); try { i = i.replace(new RegExp("{" + o + "}", "g"), b[g][o]) } catch (p) { } } h += i } if (c) $(a).first().parent().append(h); else { if (b.length < 1) return $(a).hide(), -1; q = !1, $(a).each(function () { q ? $(this).remove() : ($(this).replaceWith(h), q = !0) }) } } return 1 }, CmnPagingList: new Array, Paging: function (containerSelector, recCount, pageSize, pagingFunction) { this.containerSelector = containerSelector, this.RecCount = parseInt(recCount), this.PageSize = parseInt(pageSize), this.PagingFunction = pagingFunction, this.ShowNumCount = 5, this.MoreHtml = "", this.SmartHideButton = !0, this.CycleNextPre = !1, this.ActiveClass = "", this.CurrPage = 1, Cmn.CmnPagingList[Cmn.CmnPagingList.length] = this; var pagingVarName = "Cmn.CmnPagingList[" + (Cmn.CmnPagingList.length - 1) + "]"; this.SetCycleNextPre = function (a) { this.CycleNextPre = a, a === !0 && (this.SmartHideButton = !1), this.ToPage(1, !1) }, this.SetSmartHideButton = function (a) { this.SmartHideButton = a, this.ToPage(1, !1) }, this.GetPageCount = function () { return parseInt((this.RecCount + this.PageSize - 1) / this.PageSize) }, this.ToPage = function (pageNo, isExecPagingFunction) { function SetPageNo(a, b) { return a = a.indexOf('onclick="onclick"') >= 0 ? a.replace('onclick="onclick"', 'onclick="' + pagingVarName + ".ToPage(" + b + ')"') : a.replace("onclick=onclick", 'onclick="' + pagingVarName + ".ToPage(" + b + ')"'), a = a.replace("{num}", b) } var _numHtml, _numHtmlActive, _numLst, _pageNo, _i, _container = $(containerSelector), _PageCount = parseInt((this.RecCount + this.PageSize - 1) / this.PageSize); for (0 == _PageCount && (_PageCount = 1), _container.find(Cmn.Cfg.Paging.First).unbind("click").bind("click", function () { eval(pagingVarName + ".ToPage(1)") }), _container.find(Cmn.Cfg.Paging.Pre).unbind("click").bind("click", function () { eval(pagingVarName + ".ToPage(" + (1 > pageNo - 1 ? pagingVarName + ".CycleNextPre ?" + _PageCount + " : 1" : pageNo - 1) + ")") }), _container.find(Cmn.Cfg.Paging.Next).unbind("click").bind("click", function () { eval(pagingVarName + ".ToPage(" + (pageNo + 1 > _PageCount ? pagingVarName + ".CycleNextPre ?1:" + _PageCount : pageNo + 1) + ")") }), _container.find(Cmn.Cfg.Paging.Last).unbind("click").bind("click", function () { eval(pagingVarName + ".ToPage(" + _PageCount + ")") }), _container.find(Cmn.Cfg.Paging.First).show(), _container.find(Cmn.Cfg.Paging.Pre).show(), _container.find(Cmn.Cfg.Paging.Next).show(), _container.find(Cmn.Cfg.Paging.Last).show(), this.SmartHideButton && (1 == pageNo && (_container.find(Cmn.Cfg.Paging.First).hide(), _container.find(Cmn.Cfg.Paging.Pre).hide()), pageNo == _PageCount && (_container.find(Cmn.Cfg.Paging.Next).hide(), _container.find(Cmn.Cfg.Paging.Last).hide())), _container.find(Cmn.Cfg.Paging.Num).first().attr("onclick", "onclick"), _container.find(Cmn.Cfg.Paging.Num).first().text(_container.find(Cmn.Cfg.Paging.Num).first().text().replace(/\d+/, "{num}")), "" != this.ActiveClass && _container.find(Cmn.Cfg.Paging.Num).first().removeClass(this.ActiveClass), _numHtml = Cmn.Func.GetOuterHtml(_container.find(Cmn.Cfg.Paging.Num).first()), _numHtmlActive = _numHtml, "" != this.ActiveClass && (_container.find(Cmn.Cfg.Paging.Num).first().addClass(this.ActiveClass), _numHtmlActive = Cmn.Func.GetOuterHtml(_container.find(Cmn.Cfg.Paging.Num).first())), _container.find(Cmn.Cfg.Paging.Num).first().attr("id", "pagNum_Temp"), _container.find(Cmn.Cfg.Paging.Num + "[id!=pagNum_Temp]").remove(), "" == this.MoreHtml && (_container.find(Cmn.Cfg.Paging.More).first().attr("onclick", "onclick"), this.MoreHtml = Cmn.Func.GetOuterHtml(_container.find(Cmn.Cfg.Paging.More).first())), _container.find(Cmn.Cfg.Paging.More).remove(), _numLst = "", _pageNo = pageNo - parseInt((this.ShowNumCount - 1) / 2) - (_PageCount - pageNo >= parseInt((this.ShowNumCount - 1) / 2) ? 0 : parseInt((this.ShowNumCount - 1) / 2) - (_PageCount - pageNo)), 1 > _pageNo && (_pageNo = 1), _pageNo > 1 && (_numLst += SetPageNo(this.MoreHtml, _pageNo - 1)), _i = _pageNo; _i < _pageNo + this.ShowNumCount && _PageCount >= _i; _i++) _numLst += _i == pageNo ? SetPageNo(_numHtmlActive, _i) : SetPageNo(_numHtml, _i); _PageCount > _i - 1 && (_numLst += SetPageNo(this.MoreHtml, _i)), _container.find("#pagNum_Temp").replaceWith(_numLst), 0 != isExecPagingFunction && pagingFunction && pagingFunction(pageNo), this.CurrPage = pageNo, this.SmartHideButton && 1 == _PageCount ? _container.find(Cmn.Cfg.Paging.Num).hide() : _container.find(Cmn.Cfg.Paging.Num).show() }, this.ToPage(1, !1) }, Func: { GetOuterHtml: function (a) { return $("<div></div>").append(a.clone()).html() }, AddParamToAjaxData: function (a, b, c) { return (null == a || void 0 == a || "" == a) && (a = "{}"), a.replace(" ", "").length > 2 ? a.replace("}", ",'" + b + "':'" + c + "'}") : a.replace("}", "'" + b + "':'" + c + "'}") }, AddParamToUrl: function (a, b) { return a = Cmn.Func.DelParamFromUrl(a, b.split("=")[0]), a += a.indexOf("?") >= 0 ? "&" + b : "?" + b }, DelParamFromUrl: function (a, b) { var d, e, c = ""; return b ? (e = a.indexOf(b + "="), 0 > e && (e = a.indexOf(b + " "), 0 > e) ? a : (c = a.substring(0, e).replace(/(^\s*)|(\s*$)/g, ""), d = a.substring(e), d.indexOf("&") >= 0 ? c += d.substring(d.indexOf("&") + 1) : c.length > 0 && ("?" == c.charAt(c.length - 1) || "&" == c.charAt(c.length - 1)) && (c = c.substring(0, c.length - 1)), c)) : (e = a.indexOf("?"), e >= 0 ? a.substring(0, e) : a) }, GetParamFromUrl: function (a, b) { var c, d, e; return (null == b || "" == b || "undefind" == typeof b) && (b = window.location.href), c = "", d = new RegExp("[\\?\\s&]" + a + "\\s*=([^&#]*)"), e = b.match(d), null != e && (c = e[1]), Cmn.Func.Trim(c) }, Trim: function (a) { return a.replace(/(^\s*)|(\s*$)/g, "") }, FormatJsonData: function (a) { var b, c, d; if (null == a) return ""; for (b = "", c = 0; c < a.length; c++) switch (d = a.charAt(c)) { case '"': b += '\\"'; break; case "'": b += "\\'"; break; case "\\": b += "\\\\"; break; case "/": b += "\\/"; break; case "\b": b += "\\b"; break; case "\f": b += "\\f"; break; case "\n": b += "\\n"; break; case "\r": b += "\\r"; break; case "	": b += "\\t"; break; default: b += d } return b }, JsonToStr: function (a) { return Cmn.Func.IsString(a) ? a : ("undefined" == typeof JSON && CmnAjax.Func.LoadJs(Cmn.Func.GetRoot() + "Js/Json2.js"), JSON.stringify(a)) }, IsWebMethod: function (a) { var b, c; return "Auto" == Cmn.Cfg.IsWebMethod ? (b = Cmn.Func.DelParamFromUrl(a), c = b.lastIndexOf("/"), c >= 0 && (b = b.substring(c + 1)), b.indexOf(".") >= 0 ? !1 : !0) : Cmn.Cfg.IsWebMethod }, IsIphone4: function () { var a, b, c; return Cmn.Func.IsIOS() && (a = window.screen.width, b = window.screen.height, c = a / b, c > .6 && .7 > c) ? !0 : !1 }, IsArray: function (a) { return "[object Array]" === Object.prototype.toString.apply(a) }, ShowPoupWin: function (a) { var b = $(a), c = 50, d = 50, e = function () { c = ($(window).width() - b.width()) / 2, d = ($(window).height() - b.height()) / 2, c - 20 > 0 && (c -= 20), d - 20 > 0 && (d -= 20), b.css("top", d + $(window).scrollTop() + "px"), b.css("left", c + $(window).scrollLeft() + "px") }; e(), b.show(), $(window).scroll(function () { b.is(":visible") && (d && b.css("top", d + $(window).scrollTop() + "px"), c && b.css("left", c + $(window).scrollLeft() + "px")) }), $(window).resize(function () { b.is(":visible") && e() }) }, IsAndroid: function () { return navigator.userAgent.match(/Android/i) ? !0 : !1 }, IsIOS: function () { return navigator.userAgent.match(/iPhone|iPad|iPod/i) ? !0 : !1 }, IsIPad: function () { return navigator.userAgent.match(/iPad/i) ? !0 : !1 }, IsIEMobile: function () { return navigator.userAgent.match(/IEMobile/i) ? !0 : !1 }, IsIE: function () { return navigator.userAgent.match("MSIE") ? !0 : !1 }, BrowserVersion: function () { var b, a = navigator.userAgent.toLowerCase(); return (b = a.match(/msie ([\d.]+)/)) ? b = b[1] : (b = a.match(/firefox\/([\d.]+)/)) ? b = b[1] : (b = a.match(/chrome\/([\d.]+)/)) ? b = b[1] : (b = a.match(/opera.([\d.]+)/)) ? b = b[1] : (b = a.match(/version\/([\d.]+).*safari/)) ? b = b[1] : 0, b }, IsBlackBerry: function () { return navigator.userAgent.match(/BlackBerry/i) ? !0 : !1 }, IsMobile: function () { return Cmn.Func.IsAndroid() || Cmn.Func.IsIOS() || Cmn.Func.IsIEMobile() || Cmn.Func.IsBlackBerry() }, IsWeiXin: function () { return navigator.userAgent.match(/MicroMessenger/i) ? !0 : !1 }, SetDataToHtmlStr: function (a, b, c) { var e, f, g, h, i, j, k, l, m, d = ""; for (e = 0; f = a.indexOf(b, e), !(0 > f) ;) "-" == a.charAt(f + b.length) ? (d = a.substring(f + b.length + 1), a = a.substring(0, f + b.length + 1), g = "^\\S*?(?=[\\x22\\x27\\s]+?)", h = d.match(g)[0], i = a.lastIndexOf("<"), j = a.substring(i), a = a.substring(0, i), i = d.indexOf(">"), j += d.substring(0, i), d = d.substring(i), i = h.indexOf("["), k = "", i >= 0 && (k = h.substring(i + 1), k = k.substring(0, k.indexOf("]")), h = h.substring(0, i)), l = j.match(new RegExp(h + "\\s*=\\s*\\x22[\\s\\S]*?\\x22")), m = "", null == l ? (l = j.match(new RegExp(h + "\\s*=\\s*\\x27[\\s\\S]*?\\x27")), null == l ? (l = j.match(new RegExp(h + "\\s*=\\S*?\\s")), null != l && (m = l[0].replace(/\s*=/, "").replace(/\s/g, ""))) : (m = l[0].match(new RegExp("\\x27[\\s\\S]*?\\x27")), m = null != m ? m[0].replace(/'/g, "") : "")) : (m = l[0].match(new RegExp("\\x22[\\s\\S]*?\\x22")), m = null != m ? m[0].replace(/"/g, "") : ""), null != l && (j = j.replace(l[0], "")), j += "style" == h.toLowerCase() || "class" == h.toLowerCase() ? "style" == h.toLowerCase() && "" != k ? " " + h + "='" + m + k + ":" + c + "'" : " " + h + "='" + m + " " + c + "'" : " " + h + "='" + c + "'", e = a.length + j.indexOf(b + "-" + h) + (b + "-" + h).length, a = a + j + d) : " " == a.charAt(f + b.length) || a.charAt(f + b.length) == String.fromCharCode(34) || a.charAt(f + b.length) == String.fromCharCode(39) || ">" == a.charAt(f + b.length) ? (d = a.substring(f + b.length), a = a.substring(0, f + b.length), e = f + b.length + d.indexOf("<") + c.length, d = d.replace(/>[\s\S]*?</, ">" + c + "<"), a += d) : e = f + b.length; return a }, IsString: function (a) { return "undefined" == typeof a ? !1 : "string" == typeof a || a.constructor == String ? !0 : !1 }, SiteRoot: "/", GetRoot: function () { return Cmn.Func.SiteRoot }, SetRoot: function (a) { Cmn.Func.SiteRoot = a }, GetAbsoluteUrl: function (a) { if (a.indexOf("http:") >= 0) return a; var b = document.createElement("A"); return b.href = a, a = b.href }, GetMainDomain: function (a) { (void 0 == a || a.indexOf("http:") < 0) && (a = window.location.href), a = a.replace("http://", ""); var b = a.indexOf("/"); return b >= 0 && (a = a.substring(0, b)), Cmn.Func.Trim(a) }, GetJsPath: function (a) { var d, e, b = document.getElementsByTagName("script"), c = null; for (d = 0; d < b.length; d++) if (-1 != b[d].src.indexOf(a)) { c = b[d]; break } return null != c ? (e = c.src, e.replace(a, "")) : "" }, IsSameMainDomain: function (a, b) { return (void 0 == b || null == b || "" == b) && (b = window.location.href), a = Cmn.Func.GetMainDomain(a), b = Cmn.Func.GetMainDomain(b), a.toLowerCase() == b.toLowerCase() ? !0 : !1 }, HtmlEncode: function (a) { return document.createElement("a").appendChild(document.createTextNode(a)).parentNode.innerHTML }, HtmlDecode: function (a) { var b = document.createElement("a"); return b.innerHTML = a, b.textContent } }, NewCheckInfo: function (a, b, c) { return { Regular: a, ErrMsg: b, RequiredErrMsg: c } }, CheckValid: function (a, b) { if (a.RequiredErrMsg && "" != a.RequiredErrMsg && "" == Cmn.Func.Trim(b)) return a.RequiredErrMsg; var c = new RegExp(a.Regular.Regular); return c.test(b) ? !0 : a.ErrMsg && "" != a.ErrMsg ? a.ErrMsg : a.Regular.ErrMsg }, Regular: { Email: { Regular: "^w+((-w+)|(.w+))*@w+((.|-)w+)*.w+$", ErrMsg: "请输入正确的Email地址！" }, MobilePhone: { Regular: "^1[0-9]{10}$", ErrMsg: "请输入正确的手机号码！" } } }; Cmn.Object = { Inherit: function (a, b, c) { var d = null, e = a.constructor.prototype, f = {}; "Object" == a.constructor.name && Cmn.Log("如果使用继承的话 最好使用 'XX.prototype.xxx=function(){}' 方式定义函数. 不要用这种'XX.prototype={xxx:function(){}}'. 后者将有可能导致prototype上面一些定义的函数丢失."); for (d in e) f[d] = 1; for (d in b.prototype) f[d] || (e[d] = b.prototype[d]); b.apply(a, c) } };
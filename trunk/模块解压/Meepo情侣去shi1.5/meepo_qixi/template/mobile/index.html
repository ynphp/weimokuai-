<!DOCTYPE html>
<html>
<head>
<title>{$title}</title>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport">
	<link rel="prerender" href="{MODULE_URL}images/start_page.jpg">
	<link rel="prerender" href="{MODULE_URL}images/game_bg.jpg">
	<link rel="prerender" href="{MODULE_URL}images/score_bg.jpg?2">
	<link rel="prerender" href="{MODULE_URL}images/lovers_0.png">
	<link rel="prerender" href="{MODULE_URL}images/lovers_1.png">
	<link rel="prerender" href="{MODULE_URL}images/lovers_2.png">
	<link rel="prerender" href="{MODULE_URL}images/lovers_3.png">
	<link rel="prerender" href="{MODULE_URL}images/blood.png">
	<link rel="prerender" href="{MODULE_URL}images/single_0.png">
	<link rel="prerender" href="{MODULE_URL}images/single_1.png">
	<link rel="prerender" href="{MODULE_URL}images/single_2.png">
	<link rel="prerender" href="{MODULE_URL}images/single_3.png">
	<link rel="prerender" href="{MODULE_URL}images/time_over.png">
	<link rel="prerender" href="{MODULE_URL}images/share.jpg?1">
	<link rel="prerender" href="{MODULE_URL}images/music.mp3">
	{php echo register_jssdk(false);}
    <script type="text/javascript" src="{MODULE_URL}images/jquery.min.js"></script>
    <script type="text/javascript" src="{MODULE_URL}images/createjs.js"></script>
	<script type="text/javascript" src="{MODULE_URL}template/mobile/style/js/sweetalert.min.js"></script>
	<link rel="stylesheet" href="{MODULE_URL}template/mobile/style/js/sweetalert.css" />
    <script type="text/javascript">
		
		var isDesktop = navigator['userAgent'].match(/(ipad|iphone|ipod|android|windows phone)/i) ? false : true;
    	var fontunit        = isDesktop ? 20 : ((window.innerWidth>window.innerHeight?window.innerHeight:window.innerWidth)/320)*10;
    	document.write('<style type="text/css">'+
    		'html,body {font-size:'+(fontunit<30?fontunit:'30')+'px;}'+
    		(isDesktop?'#welcome,#GameLayerBG,#GameScoreLayer.SHADE{position: absolute;}':
    		'#welcome,#GameTimeLayer,#GameLayerBG,#GameScoreLayer.SHADE{position:fixed;}')+
    		'</style>');
    </script>
    <style type="text/css">
    body {font-family: "微软雅黑"; margin: 0; padding: 0;max-width:640px;margin:0 auto;position: relative;}
    @media screen and (min-width:640px)
	{
		body{font-size: 36px;}
	}
	@media screen and (min-width:540px) and (max-width:639px)
	{
		body{font-size: 32px;}
	}
	@media screen and (min-width:480px) and (max-width:539px)
	{
		body{font-size: 28px;}
	}
	@media screen and (min-width:320px) and (max-width:479px)
	{
		body{font-size: 20px;}
	}

	#ready-btn,.loading{height:12.5%;bottom:0;width:58%;left:22%;position: absolute;z-index: 5;color:#b67f76;display: box;display: -webkit-box;display: -moz-box;display: -ms-flexbox;box-align: center;box-pack: center;-webkit-box-align: center;-webkit-box-pack: center;-ms-flex-align: center;-ms-flex-pack: center;letter-spacing:6px;}
	
    .SHADE {top: 0; left:0; width:100%; height: 100%; bottom:0; z-index: 11;}

    #welcome {background:url({if !empty($meepo_qixi['start_page'])}{$_W['attachurl']}{$meepo_qixi['start_page']}{else}{MODULE_URL}images/start_page.jpg{/if}) no-repeat;overflow: hidden;background-size: 100% 100%;}
    .welcome-bg {position:absolute;top:0;left:0;right:0;bottom:0;}
	#GameLayerBG {top:0;left:0;right:0;bottom:0;overflow:hidden;background:url({MODULE_URL}images/game_bg.jpg) no-repeat;background-size:100% 100%;}
    .GameLayer {position:absolute;bottom:0;left:5%;height:100%;width:91%;}
    .block{position:absolute; background-repeat: no-repeat; background-position: center bottom;background-size: auto 90%;background-image: none;}
    .t0{background-image:url({if !empty($meepo_qixi['lovers_0'])}{$_W['attachurl']}{$meepo_qixi['lovers_0']}{else}{MODULE_URL}images/lovers_0.png{/if});}
    .t1{background-image:url({if !empty($meepo_qixi['lovers_1'])}{$_W['attachurl']}{$meepo_qixi['lovers_1']}{else}{MODULE_URL}images/lovers_1.png{/if});}
    .t2{background-image:url({if !empty($meepo_qixi['lovers_2'])}{$_W['attachurl']}{$meepo_qixi['lovers_2']}{else}{MODULE_URL}images/lovers_2.png{/if});}
    .t3{background-image:url({if !empty($meepo_qixi['lovers_3'])}{$_W['attachurl']}{$meepo_qixi['lovers_3']}{else}{MODULE_URL}images/lovers_3.png{/if});}
    .tt0{ background-image:url({if !empty($meepo_qixi['blood'])}{$_W['attachurl']}{$meepo_qixi['blood']}{else}{MODULE_URL}images/blood.png{/if});background-size:100% auto;}
    .s0{background-image:url({if !empty($meepo_qixi['single_0'])}{$_W['attachurl']}{$meepo_qixi['single_0']}{else}{MODULE_URL}images/single_0.png{/if});}
    .s1{background-image:url({if !empty($meepo_qixi['single_1'])}{$_W['attachurl']}{$meepo_qixi['single_1']}{else}{MODULE_URL}images/single_1.png{/if});}
    .s2{background-image:url({if !empty($meepo_qixi['single_2'])}{$_W['attachurl']}{$meepo_qixi['single_2']}{else}{MODULE_URL}images/single_2.png{/if});}
    .s3{background-image:url({if !empty($meepo_qixi['single_3'])}{$_W['attachurl']}{$meepo_qixi['single_3']}{else}{MODULE_URL}images/single_3.png{/if});}
    @-ms-keyframes flash {
    	0% { opacity: 1; }
    	50% { opacity: 0; }
    	100% { opacity: 1; }
    }
    @-webkit-keyframes flash {
    	0% { opacity: 1; } 
    	50% { opacity: 0; }
    	100% { opacity: 1; }
    }
  	.flash {-webkit-animation: flash .2s 3;animation: flash .2s 3;}
    .bad {-webkit-animation: flash .2s 3;animation: flash .2s 3;background-image:url({if !empty($meepo_qixi['blood'])}{$_W['attachurl']}{$meepo_qixi['blood']}{else}{MODULE_URL}images/blood.png{/if});background-size:100% auto;}
    *    {-webkit-tap-highlight-color: rgba(0,0,0,0);-ms-tap-highlight-color: rgba(0,0,0,0); tap-highlight-color: rgba(0,0,0,0); -ms-user-select: none;}
    #GameScoreLayer {background-position:center .5em; background-size: auto 4em; font-weight: bold; color:#fff; text-align: center;overflow: hidden;background:url({if !empty($meepo_qixi['score_bg'])}{$_W['attachurl']}{$meepo_qixi['score_bg']}{else}{MODULE_URL}images/score_bg.jpg{/if}) no-repeat #191a1e;background-size:100% 100%;}

	#GameScoreLayer-btn{position: absolute;bottom:3%;height:20.5%;width:85%;left:7.5%;color:#b67f76;overflow: hidden;}
    .btn{display: box; display: -webkit-box; display: -moz-box; display: -ms-flexbox;box-align: center;box-pack: center; -webkit-box-align: center; -webkit-box-pack: center; -ms-flex-align:center; -ms-flex-pack:center;width:46%;height:100%;float:left;font-weight: normal;cursor: pointer;}
	.btn:nth-child(2){float:right;}
    #landscape {display: none;}

	#gameBody {position: relative; width:100%; margin: 0 auto; height: 100%;}
	#share-wx {background:#191a1e;position: absolute;top: 0px;left: 0px;width: 100%;height: 100%;z-index: 10000;display: none;}
	#share-wx-img{width:100%;}
	#scoreTotal{max-width:640px;padding-left:4%;position:fixed;top:0;height:50px;width:100%;overflow: hidden;background:#000;-webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;display:none;}
	#titleBg{float:left;margin-right:20px;height:40px;z-index: 3;margin-top:5px;}
	#number,#GameTimeLayer{line-height:50px;font-size: 24px;color:#850101;height:100%;}
	#number{float:left;}
	#GameTimeLayer {text-shadow:0 0 3px #fff,0 0 3px #fff,0 0 3px #fff;position: absolute;right:85px;}
	#photo{height:100%;float:right;border: none;display:block;}
	#GameScoreLayer-text{color:#191a1e;text-align: center;font-size: 16px;font-weight: bold;padding:20px 5%;display:none;}
	#scoreLoading{height:232px;line-height: 232px;text-align: center;font-size: 28px;letter-spacing:6px;color:#b67f76;}
	#GameScoreLayer-text p{padding:0;margin:0;}
	#GameScoreLayer-text .text0{text-align: left;}
	#GameScoreLayer-text .text1{position: relative;width:100%;}
	#GameScoreLayer-text .text2{font-size: 30px;}
	#scoreAll{color:#b12813;font-size: 74px;}
	.positonP{position: absolute;right:0;bottom:16px;}
	#timeOver{width:60%;position: absolute;height:17.5%;left:20%;top:16%;display:none;background:url(http://lsgames.qiniudn.com/time_over.png) no-repeat;background-size: 100% 100%}
	
.area_box{
	position: absolute;
	z-index: 1111;
}
.area_box .current_areat_button,.area_box .current_areat_button2{
	margin:3px 0 0 1px;
	background: rgba(185,52,20,0.9);
	overflow: hidden;
	padding: 5px 5px;
	display: inline-block;
	border-radius: 0.3em;
	-moz-border-radius: 0.3em;
	-webkit-border-radius: 0.3em;
}
.area_box .current_areat_button .name,.area_box .current_areat_button2{
	color: #fff;
	float: right;
	font-size: 1em;
	
}
.area_box .current_areat_button .arrow_right，.area_box .current_areat_button2{
	float: right;
	width:0.4375em;
	height:0.4375em;
	background: url("../images/city.png")  0 0 no-repeat;
	background-size:100% auto;
	-moz-background-size:100% auto;
	-webkit-background-size:100% auto;
	margin-top:0.38em;
}
.area_box .area_select_box{
	position: fixed;
	top:0;
	left: 110%;
	height: 100%;
	width: 100%;
	background: #f8f8f8;
	padding-bottom:0.3em;	
	-webkit-transition: left 0.5s;
	-moz-transition: left 0.5s;
	transition: left 0.5s;
	z-index: 999;
	overflow: auto;
}
.area_box_active .area_select_box{
	left: 0;
}
.area_box .area_select_box .title{
	position: relative;
}
.area_box .area_select_box .title h1{
	text-align: left;
	color: #333;
	font-size: 1em;
	font-weight: normal;
	padding:0.9em 0 0.6em 0.5em;
	border-bottom: 1px solid #e9e9e9;
}
.area_box .area_select_box h2{
	background: #f1f1f1;
	color: #121212;
	font-size: 0.9em;
	padding:0.5em 0.7em;
	font-weight: normal;
	border-top:1px solid #e9e9e9;
	border-bottom:1px solid #e9e9e9;
	margin-top:-1px;
	font-family:Arial,"STHeiti","黑体-简","黑体","Microsoft Yahei"!important;
}
.area_box .area_select_box .title p{
	text-align: left;
	color: #121212;
	font-size: 0.75em;
	padding:0.7em 0.7em;
}
.area_box .area_select_box ul{
	margin:0;
	overflow: hidden;
}
.area_box .area_select_box ul li{
	float: left;
	width:33%;
	border-bottom: 1px solid #e9e9e9;
}
.area_box .area_select_box ul li:nth-child(3n){
	border-right: none;
	width:34%;
}
.area_box .area_select_box ul li a{
	border-right: 1px solid #e9e9e9;
	display: block;
	padding:0.62em 0.3em;
	text-align: center;
	color:#121212;
	border-left:1px solid #f8f8f8;
	border-top:1px solid #f8f8f8;
	border-bottom:1px solid #f8f8f8;
}
.area_box .area_select_box ul li:nth-child(3n) a{
	border-right: none;
}
.area_box .area_select_box ul li a span{
	font-size:0.87em;
	display: block;
	overflow: hidden;
	white-space: nowrap;
	text-overflow:ellipsis;
}
.area_box .area_select_box ul li a.active{
	background: rgb(255, 226, 223);
	border: 1px solid rgb(255, 146, 146)
}
.area_box .area_select_box .btn_close{
	background: url(../images/close2.png") right center no-repeat;
	height: 1.2em;
	width:2em;
	background-size:auto 100%;
	-moz-background-size:auto 100%;
	-webkit-background-size:auto 100%;
	display: block;
	position: absolute;
	right:0.7em;
	top:0.6em;
}
#poptip { display:block;position: fixed; top:30%;left:50%;width:160px;margin-left:-80px;height: 80px;background:#000; opacity: 0.7;filter:alpha(opacity=0.7); color:#fff;z-index: 999;  border-radius:5px;-webkit-border-radius:5px;-moz-border-radius:5px;}
#poptip_content { display:block;position: fixed; top:30%;left:50%;width:160px;margin-left:-80px; height: 27px; color:#fff;text-align:center;font-size:14px;z-index: 9909;text-align:center;line-height:80px}
#tijiao{
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  color:#fff;
  font-size:18px;
  z-index: 10001;
  background-color: rgba(0, 0, 0, 0.75);
}
.mask{
 
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  color:#fff;
  font-size:18px;
  z-index: 10001;
  background-color: rgba(0, 0, 0, 0.75);

}
    </style>
   
</head>
<body onload="init()">
	<div class="mask">
       <img src='{MODULE_URL}images/loading.gif' style="display:block;margin:0 auto;margin-top:50px;width:50px;height:50px"/>
	   <div style="font-size:8px;margin-top:10px;text-align:center;color:#fff">加载中....</div>
    </div>
	<script type="text/javascript">
	
	if (isDesktop)
		document.write('<div id="gameBody">');
	var body, blockSize, GameLayer = [], GameLayerBG, touchArea = [], GameTimeLayer;
	var transform, transitionDuration;

	function init (argument) {
		showWelcomeLayer();
		body = document.getElementById('gameBody') || document.body;
		body.style.height = window.innerHeight+'px';
		transform = typeof(body.style.webkitTransform) != 'undefined' ? 'webkitTransform' : (typeof(body.style.msTransform) != 'undefined'?'msTransform':'transform');
		transitionDuration = transform.replace(/ransform/g, 'ransitionDuration');

		GameTimeLayer = document.getElementById('GameTimeLayer');
		GameLayer.push( document.getElementById('GameLayer1') );
		GameLayer[0].children = GameLayer[0].querySelectorAll('div');
		GameLayer.push( document.getElementById( 'GameLayer2' ) );
		GameLayer[1].children = GameLayer[1].querySelectorAll('div');
		GameLayerBG = document.getElementById( 'GameLayerBG' );
		if( GameLayerBG.ontouchstart === null ){
			GameLayerBG.ontouchstart = gameTapEvent;
		}else{
			GameLayerBG.onmousedown = gameTapEvent;
		}
		gameInit();
		
		window.addEventListener('resize', refreshSize, false);
         
		var rtnMsg = "true";	
			
		setTimeout(function(){
			if(rtnMsg){
				var btn = document.getElementById('ready-btn');
				btn.className = 'btn';
				btn.innerHTML = '点击开始游戏'
				btn.onclick = function(){
					close2();
					$("#area_box").hide();
					$("#paihang").hide();
					$("#award").hide();
					closeWelcomeLayer();
					{if empty($user['mobile']) || empty($user['realname'])}
					   $("#tijiao").show();
					{/if}
				} 
			}					
		}, 500);
		$(".mask").hide();
	}
	function share_api(){
<?php 
$surl =$_W['siteroot']."app/".$this->createMobileurl('index',array('id'=>$id));
$surl = str_replace('./','',$surl);
$meepo_qixi['share_link'] = $surl;
?>
 wx.ready(function () {
    var shareData = {
    //title: "{$meepo_qixi['share_title']}",
    title: document.title,
    desc: "{$meepo_qixi['share_content']}",
    link: "{$meepo_qixi['share_link']}",
    imgUrl: "{$_W['attachurl']}{$meepo_qixi['share_img']}",
  };
  
  //分享朋友
  wx.onMenuShareAppMessage({
       title: shareData.title,
      desc: shareData.desc,
      link: shareData.link,
      imgUrl:shareData.imgUrl,
      trigger: function (res) {
      },
      success: function (res) {
        
      },
      cancel: function (res) {
      },
      fail: function (res) {
        alert(JSON.stringify(res));
      }
    });
 //朋友圈
  wx.onMenuShareTimeline({
      title: shareData.title+"~~~~~~"+shareData.desc,
      link: shareData.link,
      imgUrl:shareData.imgUrl,
      trigger: function (res) {
      },
      success: function (res) {
          
      },
      cancel: function (res) {
      },
      fail: function (res) {
        alert("分享失败网络超时！！！！");
      }
    });   
    
  });
}
	var refreshSizeTime;
	function refreshSize(){
		clearTimeout(refreshSizeTime);
		refreshSizeTime = setTimeout(_refreshSize, 200);
	}
	function onBridgeReady(){
	   WeixinJSBridge.call('hideToolbar');
	}
	function _refreshSize(){
		countBlockSize();
		for( var i=0; i<GameLayer.length; i++ ){
			var box = GameLayer[i];
			for( var j=0; j<box.children.length; j++){
				var r = box.children[j],
					rstyle = r.style;
				rstyle.left = (j%4)*blockSize+'px';
				rstyle.bottom = Math.floor(j/4)*blockSize+'px';
				rstyle.width = blockSize+'px';
				rstyle.height = blockSize+'px';
			}
		}
		var f, a;
		if( GameLayer[0].y > GameLayer[1].y ){
			f = GameLayer[0];
			a = GameLayer[1];
		}else{
			f = GameLayer[1];
			a = GameLayer[0];
		}
		var y = (_gameBBListIndex%10)*blockSize;
		f.y = y;
		f.style[transform] = 'translate3D(0,'+f.y+'px,0)';

		a.y = -blockSize*Math.floor(f.children.length/4)+y;
		a.style[transform] = 'translate3D(0,'+a.y+'px,0)';

	}
	function countBlockSize(){
		blockSize = body.offsetWidth*0.91/4;
		body.style.height = window.innerHeight+'px';
		GameLayerBG.style.height = window.innerHeight+'px';
		touchArea[0] = window.innerHeight-blockSize*1;
		touchArea[1] = window.innerHeight-blockSize*2;
	}
	var _gameBBList = [], _gameBBListIndex = 0, _gameOver = false, _gameStart = false, _gameTime, _gameTimeNum, _gameScore;
	function gameInit(){
        createjs.Sound.registerSound( {src:"{if !empty($meepo_qixi['musicurl'])}{$_W['attachurl']}{$meepo_qixi['musicurl']}{else}{MODULE_URL}images/music.mp3{/if}", id:"tap"} );
		gameRestart();
	}
	function gameRestart(){
		_gameBBList = [];
		_gameBBListIndex = 0;
		_gameScore = 0;
		_gameOver = false;
		_gameStart = false;
		_gameTimeNum = {php echo intval($meepo_qixi['maxtime'])*100};
		GameTimeLayer.innerHTML = creatTimeText(_gameTimeNum);
		countBlockSize();
		refreshGameLayer(GameLayer[0]);
		refreshGameLayer(GameLayer[1], 1);
	}
	function gameStart(){
		_gameStart = true;
		_gameTime = setInterval(gameTime, 10);
	}
	function gameOver(){
		_gameOver = true;
		clearInterval(_gameTime);
		setTimeout(function(){
			GameLayerBG.className = '';
			showGameScoreLayer();
		}, 1000);
	}
	function gameTime(){
		_gameTimeNum --;
		if( _gameTimeNum <= 0){
			GameTimeLayer.innerHTML = "0'00''";
			$('#timeOver').show();
			gameOver();
			GameLayerBG.className += ' flash';
			createjs.Sound.play("tap");
		}else{
			GameTimeLayer.innerHTML = creatTimeText(_gameTimeNum);
		}
	}
	function creatTimeText( n ){
		var text = (100000+n+'').substr(-4,4);
		//alert(text);
		text = '&nbsp;&nbsp;'+text.substr(0,2)+"'"+text.substr(2)+"''"
		return text;
	}
	var _ttreg = / t{1,2}(\d+)/, _clearttClsReg = / t{1,2}\d+| bad/,_clears1ClsReg = / s\d/;
	function refreshGameLayer( box, loop, offset ){
		var i = Math.floor(Math.random()*1234)%4+(loop?0:4);
		for( var j=0; j<box.children.length; j++){
			var r = box.children[j],
				rstyle = r.style;
			rstyle.left = (j%4)*blockSize+'px';
			rstyle.bottom = Math.floor(j/4)*blockSize+'px';
			rstyle.width = blockSize+'px';
			rstyle.height = blockSize+'px';
			r.className = r.className.replace(_clearttClsReg, '');
			r.className = r.className.replace(_clears1ClsReg, '');
			if( i == j ){
				_gameBBList.push( {cell:i%4, id:r.id} );
				var random=Math.floor((Math.random()*1234)%4);
				r.className += ' t'+random;

				var random1=Math.floor((Math.random()*1234)%4);

				if( loop ){
					var x=j%4;
					if(random1!=x)
					{
						var endNum=Math.floor(j/4)*4+random1;
						box.children[endNum].className = box.children[endNum].className+' s'+Math.floor((Math.random()*1234)%4);
					}
				}else{
					if(j>7){
						var x=j%4;
						if(random1!=x)
						{
							var endNum=Math.floor(j/4)*4+random1;
							box.children[endNum].className = box.children[endNum].className+' s'+Math.floor((Math.random()*1234)%4);
						}
					}
				}
				r.notEmpty = true;
				i = ( Math.floor(j/4)+1)*4+Math.floor((Math.random()*1234)%4);

			}else{
				r.notEmpty = false;
			}
		}
		if( loop ){
			box.style.webkitTransitionDuration = '0ms';
			box.style.display          = 'none';
			box.y                      = -blockSize*(Math.floor(box.children.length/4)+(offset||0))*loop;
			setTimeout(function(){
				box.style[transform] = 'translate3D(0,'+box.y+'px,0)';
				setTimeout( function(){
					box.style.display     = 'block';
				}, 100 );
			}, 200 );
		} else {
			box.y = 0;
			box.style[transform] = 'translate3D(0,'+box.y+'px,0)';
		}
		box.style[transitionDuration] = '150ms';
	}
	function gameLayerMoveNextRow(){
		for(var i=0; i<GameLayer.length; i++){
			var g = GameLayer[i];
			g.y += blockSize;
			if( g.y > blockSize*(Math.floor(g.children.length/4)) ){
				refreshGameLayer(g, 1, -1);
			}else{
				g.style[transform] = 'translate3D(0,'+parseInt(g.y)+'px,0)';
			}
		}
	}
	function gameTapEvent(e){
		if (_gameOver) {
			return false;
		}
		var tar = e.target;
		var y = e.clientY || e.targetTouches[0].clientY,
			x = (e.clientX || e.targetTouches[0].clientX)-body.offsetLeft,
			cha=body.offsetWidth*0.95;
			x=x+cha;
			p = _gameBBList[_gameBBListIndex];
		if ( y > touchArea[0] || y < touchArea[1]) {
			return false;
		}
		if( (p.id==tar.id&&tar.notEmpty) || (p.cell==0&&x<blockSize+cha) || (p.cell==1&&x>blockSize+cha&&x<2*blockSize+cha) || (p.cell==2&&x>2*blockSize+cha&&x<3*blockSize+cha) || (p.cell==3&&x>3*blockSize+cha) ){
			if( !_gameStart ){
				gameStart();
			}
        	createjs.Sound.play("tap");
			tar = document.getElementById(p.id);
			tar.className = tar.className.replace(_ttreg, ' tt0');
			_gameBBListIndex++;
			_gameScore ++; 
			$('#number span').html(_gameScore);
			gameLayerMoveNextRow();
		}else if( _gameStart && !tar.notEmpty && / s\d/.test(tar.className)){
			createjs.Sound.play("tap");
			tar.className += ' bad';
			gameOver();
		}
		return false;
	}
	function createGameLayer(){
		var html = '<div id="GameLayerBG">';
		for(var i=1; i<=2; i++){
			var id = 'GameLayer'+i;
			html += '<div id="'+id+'" class="GameLayer">';
			for(var j=0; j<10; j++ ){
				for(var k=0; k<4; k++){ 
					html += '<div id="'+id+'-'+(k+j*4)+'" num="'+(k+j*4)+'" class="block"></div>';
				}
			}
			html += '</div>';
		}
		html += '</div>';

		return html;
	}
	function closeWelcomeLayer(){
		var l = document.getElementById('welcome');
		l.style.display = 'none';
		$('#scoreTotal').show();
	}
	function showWelcomeLayer(){
		var l = document.getElementById('welcome');
		l.style.display = 'block';
	}
	function showGameScoreLayer(){
	    tip('加载中.....');
		$.ajax({
            type : "POST",
            url: '{php echo $this->createMobileUrl('ajax',array('rid'=>$id))}',
            data:{'score':_gameScore},
            dataType:'JSON',
            success: function (data) {
				tip_close();
                if (data.error == 0) {
					$('#area_box').show();
					$('#paihang').show();
					$("#award").show();
                	$('#scoreLoading').hide();
					var html = shareText(_gameScore);
					document.title = '我摁死了'+_gameScore+'对情侣，获得了大奖，太爽了，单身同胞们快上啊!'; ;
                    $('#GameScoreLayer-text').html(html);
					$('#GameScoreLayer-text').show();
					var l = document.getElementById('GameScoreLayer');
		            l.style.display = 'block';
				     swal({
						title: "中奖结果",
						text: data.message,
						timer: 10000,
						showCancelButton: true,
						confirmButtonColor: "#DD6B55",   
						confirmButtonText: "查看结果", 
						cancelButtonText: "继续玩", 
						closeOnConfirm: false,  
						closeOnCancel: false },
						function(isConfirm){ 
							if (isConfirm) { 
								window.location.href="{php echo $this->createMobileUrl('paihangbang',array('id'=>$id))}"; 
							} else {
								swal.close();
							} 
					});
                    share_api();
                } else {
					alert(data.message);
                    
                }
            }   
        });
		
		
		
	}
	function luru(){
	    var realname = $('#username').val();
		var mobile = $('#password').val();
		if(realname == ''){
		  alert('请输入你的真实姓名！');
		   return false;
		}
		if(mobile == ''){
			alert('请输入你的真实联系方式！');
		   return false;
		}
			$('#luru').html('提交中....');
			$.ajax({
				type : "POST",
				url: '{php echo $this->createMobileUrl('luru',array('rid'=>$id))}',
				data:{'realname':realname,'mobile':mobile},
				dataType:'JSON',
				success: function (data) {
					tip_close();
					if (data.error == 0) {
						   
						   location.reload();
						
					} else {
						alert(data.message);
					}
				}   
			});
	}
	function hideGameScoreLayer(){
		var l = document.getElementById('GameScoreLayer');
		l.style.display = 'none';
		$('#timeOver').hide();
		$('#score').html('0');
		$('#scoreLoading').show();
        $('#GameScoreLayer-text').html('').hide();
	}
	function replayBtn(){
		close2();
		$('#area_box').hide();
		$('#paihang').hide();
		$("#award").hide();
		gameRestart();
		hideGameScoreLayer();
	}
	function backBtn(){
		gameRestart();
		hideGameScoreLayer();
		showWelcomeLayer();
	}
	function shareText(score){
		{if is_array($max_range) && !empty($max_range)}
		  {if count($max_range) == 4}
		    if( score < {$max_range[0]['maxscore']} ){
			return "<p class='text0'>太少了太少了！隔壁老奶奶手一抖都比你多！你只摁死了</p><p class='text1'><span id='scoreAll'>"+score+"</span><span class='positonP'>对情侣</span></p>";
		    }else if( score < {$max_range[1]['maxscore']}  ){
		    return "<p class='text0'>手指蛮厉害啊，不过这就是你所有的撸劲了吗？！你摁死了</p><p class='text1'><span id='scoreAll'>"+score+"</span><span class='positonP'>对情侣</span></p>";
			
		    }else if( score <= {$max_range[2]['maxscore']} ){
		        return "<p class='text0'>单身贱圣的狂欢，让我们在七夕夜把所有情侣的温床都摁塌吧！你居然摁死了</p><p class='text1'><span id='scoreAll'>"+score+"</span><span class='positonP'>对情侣</span></p>";
			
		    }else{
			      return "<p class='text0'>传奇！什么最牛逼？单身最牛逼！你TMD摁死了</p><p class='text1'><span id='scoreAll'>"+score+"</span><span class='positonP'>对情侣</span></p>";
		    }
		  {else if count($max_range) == 3}
		     if( score < {$max_range[0]['maxscore']} ){
			     return "<p class='text0'>太少了太少了！隔壁老奶奶手一抖都比你多！你只摁死了</p><p class='text1'><span id='scoreAll'>"+score+"</span><span class='positonP'>对情侣</span></p>";
		    }else if( score <= {$max_range[2]['maxscore']} ){
		         return "<p class='text0'>单身贱圣的狂欢，让我们在七夕夜把所有情侣的温床都摁塌吧！你居然摁死了</p><p class='text1'><span id='scoreAll'>"+score+"</span><span class='positonP'>对情侣</span></p>";
			
		    }else{
			      return "<p class='text0'>传奇！什么最牛逼？单身最牛逼！你TMD摁死了</p><p class='text1'><span id='scoreAll'>"+score+"</span><span class='positonP'>对情侣</span></p>";
		    }
		  {else if count($max_range) == 2}
		    if( score < {$max_range[0]['maxscore']} ){
			     return "<p class='text0'>太少了太少了！隔壁老奶奶手一抖都比你多！你只摁死了</p><p class='text1'><span id='scoreAll'>"+score+"</span><span class='positonP'>对情侣</span></p>";
		    }else{
			      return "<p class='text0'>传奇！什么最牛逼？单身最牛逼！你TMD摁死了</p><p class='text1'><span id='scoreAll'>"+score+"</span><span class='positonP'>对情侣</span></p>";
		    }
		  {else}
		    
			      return "<p class='text0'>传奇！什么最牛逼？单身最牛逼！你TMD摁死了</p><p class='text1'><span id='scoreAll'>"+score+"</span><span class='positonP'>对情侣</span></p>";
		   
		  {/if}
		    
		{else}
		  return '管理员未添加奖品！！！';
		{/if}	
		
			
	}
	
	function toStr(obj) {
		if ( typeof obj == 'object' ) {
			return JSON.stringify(obj);
		} else {
			return obj;
		}
		return '';
	}
	function cookie(name, value, time) {
		if (name) {
			if (value) {
				if (time) {
					var date = new Date();
					date.setTime(date.getTime() + 864e5 * time), time = date.toGMTString();
				}
				return document.cookie = name + "=" + escape(toStr(value)) + (time ? "; expires=" + time + (arguments[3] ? "; domain=" + arguments[3] + (arguments[4] ? "; path=" + arguments[4] + (arguments[5] ? "; secure" : "") : "") : "") : ""), !0;
			}
			return value = document.cookie.match("(?:^|;)\\s*" + name.replace(/([-.*+?^${}()|[\]\/\\])/g, "\\$1") + "=([^;]*)"), value = value && "string" == typeof value[1] ? unescape(value[1]) : !1, (/^(\{|\[).+\}|\]$/.test(value) || /^[0-9]+$/g.test(value)) && eval("value=" + value), value;
		}
		var data = {};
		value = document.cookie.replace(/\s/g, "").split(";");
		for (var i = 0; value.length > i; i++) name = value[i].split("="), name[1] && (data[name[0]] = unescape(name[1]));
		return data;
	}
	function show2(){
		$('#active_rule_box').show();
	     
	}
	function close2(){
	    $('#active_rule_box').hide();
	}
	function tip(msg,autoClose){
	var div = $("#poptip");
	var content =$("#poptip_content");
	if(div.length<=0){
		div = $("<span id='poptip'></span>").appendTo(document.body);
		content =$("<span id='poptip_content'>" + msg + "</span>").appendTo(document.body);
	}else{
		content.html(msg);
		content.show(); 
		div.show();
	}
	if(autoClose) {
		setTimeout(function(){
			content.hide();
			div.hide();
		},2000);
	}
   }
	function tip_close(){
		$("#poptip").hide();
		$("#poptip_content").hide();
	}
	document.write(createGameLayer());
	
	function share(){
		document.getElementById('share-wx').style.display = 'block';
		document.getElementById('share-wx').onclick = function(){
			this.style.display = 'none';
		};
	}
</script>
    <div class="area_box" id="area_box" style="bottom:15em;right:.5em;" onclick="show2()"><a  class="current_areat_button"><span class="name" id="btn_active_rule">活动规则</span><span class="arrow_right"></span></a></div>
	<div id="award" style="position: absolute;z-index: 1111;bottom:12em;right:.5em;"><a href="{php echo $this->createMobileUrl('awardlist',array('id'=>$id))}" style="margin:3px 0 0 1px;background: rgba(185,52,20,0.9);overflow: hidden;padding:5px 5px;display: block;border-radius: 0.3em;-moz-border-radius: 0.3em;-webkit-border-radius: 0.3em;color:#fff"><span class="name" id="btn_active_rule">奖品列表</span></a></div>
	<div style="position: absolute;z-index: 1111;bottom:9em;right:.5em;" id="paihang"><a href="{php echo $this->createMobileUrl('paihangbang',array('id'=>$id))}" style="margin:5px 0 0 1px;background: rgba(185,52,20,0.9);overflow: hidden;padding:5px 5px;display: block;border-radius: 0.3em;-moz-border-radius: 0.3em;-webkit-border-radius: 0.3em;color:#fff"><span class="name" id="btn_active_rule">最新记录</span></a></div>
	<div id="GameScoreLayer" class="BBOX SHADE" style="display:none;">
		<div id="GameScoreLayer-text"></div>
		<div id='scoreLoading'>加载中...</div>
		<div id="GameScoreLayer-btn">
			<div class="btn" onclick="replayBtn()">换个姿势<br/>再来一次</div>
			<div class="btn" onclick="share()">单身万岁<br/>分享好友</div>
		</div>	
	</div>
	<div id='scoreTotal'>
	<img src="{if !empty($meepo_qixi['titlebg'])}{$_W['attachurl']}{$meepo_qixi['titlebg']}{else}{MODULE_URL}images/title_bg.png{/if}" id='titleBg'><span id='number'>=&nbsp;<span id='score'>0</span></span>
	<img src="{if !empty($meepo_qixi['photobg'])}{$_W['attachurl']}{$meepo_qixi['photobg']}{else}{MODULE_URL}images/photo_bg.png{/if}" id='photo'><div id="GameTimeLayer"></div></div>
	<div id="welcome" class="SHADE BOX-M">
		<div class="welcome-bg FILL"></div>
		<div id="ready-btn" class="btn loading">加载中...</div>	
	</div>
	<div id='timeOver'></div>
	<div id="share-wx"><img src="{if !empty($meepo_qixi['share'])}{$_W['attachurl']}{$meepo_qixi['share']}{else}{MODULE_URL}images/share.jpg{/if}" id="share-wx-img"></div>

	
	   <style type="text/css">
  #active_rule_box{
	position: fixed;
	top:20%;
	border-radius: 6px;
	-moz-border-radius: 6px;
	-webkit-border-radius:6px;
	overflow: hidden;
	z-index: 999999;
  }
 .descinfo-box{color: #3d3d3d; line-height: 1.6rem; font-size: 1.2rem; padding: 5%; margin: 0 5%; background: rgba(255,255,255,0.85); border-radius: 3px; position: absolute; bottom: 5%; display: none; opacity: 0;}
 .descinfo-box span{color: #00c177;}
 .descinfo-box .link{color: #00c177; text-decoration: underline;}
 .descinfo-box:after{content: "\200B"; height: 0; position: absolute; bottom: -10px; right: 7%; border-width:5px; border-style: solid; border-color: rgba(255,255,255,0.85) transparent transparent transparent;}
 .descinfo-box-in{ bottom: 11%; opacity: 1; -webkit-transition: all 0.5s ease-in-out; z-index:10;}
 .descinfo-box-out{ bottom: 5%; opacity: 0; -webkit-transition: all 0.5s ease-in-out; z-index:0;}
 .descinfo-close{position: absolute; right: 0; top: 0; width: 3rem; height: 3rem; text-align: center; line-height: 3rem; font-size: 2rem; color:#666;}


	   </style>
         <section class="descinfo-box descinfo-box-in" style="display:none;" id="active_rule_box">
            <div>1、活动时间: {php echo date('Y-m-d H:m:s',$meepo_qixi['starttime'])}~{php echo date('Y-m-d H:m:s',$meepo_qixi['endtime'])}<br>
                2、{if empty($meepo_qixi['awardwords'])}排行榜前10名，可获取本平台发放的奖品。{else}{$meepo_qixi['awardwords']}{/if}<br>
                3、{if empty($meepo_qixi['namemobile'])}为了方便后期发放奖品，请务必填写您的姓名和联系方式！{else}{$meepo_qixi['namemobile']}{/if}<br>
                4、{if empty($meepo_qixi['explanation'])}此活动最终解释权由{$_W['acccount']['name']}所有。{else}{$meepo_qixi['explanation']}{/if}<br>
                5、每人限领取一个奖品<br>
                6、如发现用户有恶意刷奖行为的，我们将取消获奖资格。<br>
				<div style="text-align:center"><a class="link" href="{$meepo_qixi['detailurl']}">详情</a></div></div>
            <a href="javascript:void(0);" class="descinfo-close" id="J_descinfo-close" onclick="close2();">×</a>
        </section>
    </div>
<div id="tijiao" style="display:none">
	   
	   <div class="get-bonus" style="margin-top:100px;">
        <div class="mobile enter-phone-mobile">
            <div class="enter-phone-tip" style="text-align:center;background: rgba(185,52,20,0.9);">录入真实姓名以及电话号码兑奖</div>
            <div class="box">
                <div class="item phone">
                    <input class="enter" type="text" id="username" placeholder="请输入您的真实姓名">
                    <a class="send">必填</a>
                </div>
                <div class="bord"></div>
                <div class="item phone">
                    <input class="enter" type="number" id="password" placeholder="请输入您的联系方式">
					<a class="send">必填</a>
                </div>
            </div>
			
        </div>
        <a class="use-bonus-now J_open" style="color: #fff;
	padding: 0 10px;
	text-align: center;
	border-radius: 3px;
	-webkit-border-radius: 3px;
	font-size: 14px;
	height: 40px;
	line-height: 40px;
	display: block;
	margin:0;
	padding:0;background: rgba(185,52,20,0.9);" onclick="luru()" id="luru">立即提交</a>
		</div>
	</div>
	<style>
input{
	font-size: 100%;
	outline: 0;
	margin:0;
	padding:0;
}

input,a {
	-webkit-tap-highlight-color: rgba(0,0,0,0);
	margin:0;
	padding:0;
}

input {
	resize: none;
	margin:0;
	padding:0;

}
a {
	text-decoration: none;
	margin:0;
	padding:0;
}
.get-bonus {
	text-align: center;
	margin-left: 10px;
	margin-right: 10px
}

.get-bonus .mobile {
	position: relative
}

.get-bonus .mobile .error-hint {
	color: #c00;
	font-size: 12px;
	position: absolute;
	top: 128px;
	left: 0;
	display: none
}

.get-bonus .mobile .box {
	border: #c6c6c6 solid 1px;
	border-right: none;
	border-left: none;
	background: #fff;
	padding-left: 15px
}

.get-bonus .mobile .box .phone {
	background: url(//i1.dpfile.com/mod/mobile-open-onecent/0.2.1/src/img/mobile.png) no-repeat 0 13px;
	background-size: 14px auto
}

.get-bonus .mobile .box .item {
	height: 45px;
	line-height: 45px;
	padding-left: 15px
}

.get-bonus .mobile .box .code {
	background: url(//i1.dpfile.com/mod/mobile-open-onecent/0.2.1/src/img/mobile.png) no-repeat 0 -20px;
	background-size: 14px auto
}

.get-bonus .mobile .box input {
	padding: 10px 0 10px 15px;
	border: none;
	border-right: 1px solid #c6c6c6;
	border-radius: 0!important;
	width: 60%;
	display: inline-block;
	float: left;
	line-height: 24px;
	font-size: 16px
}

.get-bonus .mobile .box .send {
	color: #666;
	display: inline-block
}

.get-bonus .mobile .box .bord {
	border-top: solid 1px #c6c6c6
}

.get-bonus .enter-phone-mobile {
	position: relative;
	z-index: 4;
	margin: 15px 0 20px
}

.get-bonus .enter-phone-mobile .enter-phone-tip {
	font-size: 16px;
	color: #fff;
	height:30px;
	line-height:30px;
	text-align: left
}

.get-bonus .use-bonus-now {
	font-size: 16px;
	padding-top: 10px;
	padding-bottom: 10px
}


   </style>
<script type="text/javascript">
	if (isDesktop)
		document.write('</div>');
</script>
<script type="text/javascript">

</script>
</body>
</html>


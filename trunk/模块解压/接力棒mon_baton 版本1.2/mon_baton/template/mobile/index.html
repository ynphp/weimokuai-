<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
    <meta name="format-detection" content="telephone=no"/>
    <title>{$baton['title']}</title>
    <link href="{MON_BATON_RES}css/style.css?v=1" rel="stylesheet"
          type="text/css">
    <link rel="stylesheet" type="text/css"
          href="{MON_BATON_RES}/css/sweet-alert.css">
    <script src="http://libs.baidu.com/jquery/1.9.0/jquery.js"></script>
    <script type="text/javascript" src="{MON_BATON_RES}/js/sweet-alert.min.js"></script>
    <style>
        .jb_main {
            width: 90%;
            margin: 10px 5% 10px 5%;
        }
        .pop {
            position: fixed;
            margin: auto,0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            z-index: 1000;
            padding-top: 15%;
        }
        .promptbox{ width:70%; background:url({MON_BATON_RES}css/box_bg.jpg) repeat; border-radius:10px; padding:2%; margin:0 auto;  z-index:20001;left: 10%;
            right: 10%;
            top: 10%;}
        .promptbox .box{border-radius:8px; background-color: #FCFBFA;
            border: 1px #1337C5 solid;}
        .promptbox .box h1{ color:#ffe7bd; text-align:center;padding:3% 0;}
        .promptbox .box .line{ width:100%;}
        .line {
            width: 100%;
            margin-top: 1px;
        }
        .promptbox .box .user{ margin:15px 0; padding:0 5%; }
        .promptbox .box .user .input{position:relative;}
        .promptbox .box .user .input input{ box-sizing: border-box;height:34px;padding: 12px 0 12px 34px;background:  url({MON_BATON_RES}css/user.png) no-repeat 4px center; border:0; color:#000000; border-radius:8px; width:100%; margin:5px auto;font-family: Microsoft YaHei,Helvitica,Verdana,Tohoma,Arial,san-serif; font-size:14px; border:1px #bc7415 solid;}

        .promptbox .box .user .id input{ background: url({MON_BATON_RES}css/phone.png) no-repeat 4px center;}
        .promptbox .box .but{ width:40%; float:left;}

        .promptbox .box .but_con{margin:10px auto 0 auto; width:70%}

        .promptbox .box .user .input_01 input{ text-indent:10px; width:100%;}
        .promptbox .box .user .text{ color:#ffe7bd;margin-left:80px; text-align:center;}
        .promptbox .box .user .text2{ color:#ffe7bd; text-align:center;}
        .button_01:hover {
            background-image: linear-gradient(to top, #ffd33c, #ffa200);
        }

        .promptbox .box h1{
            color: red;
            font-size: large;
        }
        .button_01 {
            font-family: Microsoft YaHei,Helvitica,Verdana,Tohoma,Arial,san-serif;
            font-size: 14px;
            padding: 5px;
            color: #a22d04;
            background-image: linear-gradient(to top, #ffa200, #ffd33c);
            background: -webkit-gradient(linear, left top, left bottom, color-stop(1%,#ffd33c), color-stop(99%,#ffa200));
            border: 1px solid #ffb73b;
            box-shadow: 0px 0px 5px #aa2022;
            text-align: center;
            border-radius: 5px;
            width: 100%;
            cursor: pointer;
        }


        .button_02 {
            font-family: Microsoft YaHei,Helvitica,Verdana,Tohoma,Arial,san-serif;
            font-size: 14px;
            padding: 5px;
            color: #676767;
            background-image: linear-gradient(to top, #f2f2f2, #dedede);
            border: 1px solid #cecece;
            box-shadow: 0px 0px 5px #aa2022;
            text-align: center;
            border-radius: 5px;
            width: 100%;
            cursor: pointer;
        }
        .clr {
            clear: both;
        }

        html, body, div, span, applet, object, iframe, h1, h2, h3, h4, h5, h6, p, blockquote, pre, a, abbr, acronym, address, big, cite, code, del, dfn, em, img, ins, kbd, q, s, samp, small, strike, strong, sub, sup, tt, var, b, u, i, center, dl, dt, dd, ol, ul, li, fieldset, form, label, legend, table, caption, tbody, tfoot, thead, tr, th, td, article, aside, canvas, details, embed, figure, figcaption, footer, header, hgroup, menu, nav, output, ruby, section, summary, time, mark, audio, video {
            margin: 0;
            padding: 0;
            border: 0;
            font-size: 100%;
            font: inherit;
            vertical-align: baseline;
            outline: none;
        }
        #tc4 {
            position: absolute;
            top: 160px;
            left: 20%;
            text-align: center;
            background: #fff;
            width: 220px;
            height: 200px;
            border: 1px #000 solid;
            border-radius: 10px;
            z-index: 999;
        }

        #tc1 {
            position: absolute;
            top: 160px;
            left: 20%;
            text-align: center;
            background: #fff;
            width: 220px;
            height: 290px;
            border: 1px #000 solid;
            border-radius: 10px;
            z-index: 999;
        }

     </style>
</head>
<body>

<div id="adduser" class="pop" style="display: none;">
    <div class="promptbox">
        <div class="box">
            <h1>我要接棒</h1>
            <div class="line">
                <img src="{MON_BATON_RES}images/line_yellow.png" width="100%">
            </div>
            <div class="user">
                <form id="add_form">
                    <div class="input">
                        <input type="text" id="xm" name="xm" placeholder="请输入姓名">
                    </div>
                    <div class="input id">
                        <input type="text" id="tel" name="tel" placeholder="请输入手机号，以便领取奖品">
                        <input type="hidden" name="act" value="add">
                        <input type="hidden" name="act_id" value="2">
                        <input type="hidden" name="tomhash" value="332937">
                        <input type="hidden" name="formhash" value="eefaea70">
                    </div>

                    <div class="input">
                        <textarea placeholder="接棒寄语" style="width: 90%; margin: 10px 5% 10px 5%;" rows="5" id="speak">{$baton['speak']}</textarea>
                    </div>

                </form>
                <div class="but_con">
                    <button class="add_user_btn button_01 but" id="add_user_jb">接棒</button>
                    <button class="button_02 but" onclick="document.getElementById('adduser').style.display='none';" style="margin-left:18%">关闭</button>
                    <div class="clr"></div>
                </div>
            </div>
        </div>
    </div>
</div>


<!--头部菜单-->
<div id="menu">
    <div class="l w33p a_bs top_in h35 b_1">
        <a href="{php echo $this->createMobileUrl('index',array('bid'=>$baton['id']),true)}" class="menu_a">首页</a>
    </div>
    <div class="l w33p a_hs h35 b_1">
        <a href="{php echo $this->createMobileUrl('userbaton',array('bid'=>$baton['id']),true)}" class="menu_a">我的接棒</a>
    </div>
    <div class="l w33p a_hs h35 b_1">
        <a href="{php echo $this->createMobileUrl('rule',array('bid'=>$baton['id']),true)} " class="menu_a">活动说明</a>
    </div>

    <div class="l w33p a_hs h35">
        <a href="{php echo $this->createMobileUrl('ryb',array('bid'=>$baton['id']),true)} " class="menu_a">荣誉榜</a>
    </div>



</div>
<div style='width: 100%; height: 35px; clear: both; float: none;'></div>
<!--头部图片-->
<div id="ryb_img">
    <img src="{if $baton['index_banner']}{php echo MonUtil::getpicurl($baton['index_banner'])}{else}{php echo MonUtil::defaultImg(MonUtil::$IMG_INDEX_BANNER)}{/if}" width="100%"/ >
</div>
<!--主体-->
<div id="wmr">
    <div class="wmr_top">
        <img src="{MON_BATON_RES}images/f1bcf290f9a43039.gif" width="100%"
             style="margin-left: 0%;"/> <img
            src="{MON_BATON_RES}images/c13a79534771cc89.gif" width="30%"
            onclick="jieb();">

        {if $default}
        <div class="wmr_phone" onclick="getData('');">
            <img src="{if $baton['default_logo']}{php echo MonUtil::getpicurl($baton['default_logo'])}{else}{php echo MonUtil::defaultImg(MonUtil::$IMG_DEFAULT_LOGO)}{/if}" width="30%;"
                 style="padding-top: 10px;border: #eb5e54 1px solid"/>

            <div>{$baton['default_name']}</div>
            <ul class="wmr_top_ul">
                <li class="b_3 b_4">
                    <div class="l w30p">接棒时间</div>
                    <div class="l">|{php echo date("Y-m-d", $baton['starttime'])}</div>
                </li>
                <li class="b_5">
                    <div class="l w30p">上一棒</div>
                    <div class="l">|{$baton['default_name']}</div>
                </li>
            </ul>
        </div>
        {else}


        <div class="wmr_phone" onclick="getData({$preUser['id']});">
            <img src="{$preUser['headimgurl']}" width="30%;"
                 style="padding-top: 10px;border: #eb5e54 1px solid"/>

            <div>{$preUser['nickname']}</div>
            <ul class="wmr_top_ul">
                <li class="b_3 b_4">
                    <div class="l w30p">接棒时间</div>
                    <div class="l">|{php echo date("Y-m-d", $preUser['createtime'])}</div>
                </li>
                <li class="b_5">
                    <div class="l w30p">上一棒</div>
                    <div class="l">|{php echo $this->pre_name($preUser['nickname'])}</div>
                </li>
            </ul>
        </div>

        {/if}

    </div>
    <!--留布局-->
    <!--不能动的-->
    {if !empty($user_list_top2)}
    <div class="wmr_liubuju">
        <ul class="wmr_liubuju_ul m_40">
            {if !empty($user_list_top2[0])}
            <li class="l"
                onclick="getData({$user_list_top2[0]['id']});">
                <div class="b_7 pu_top">
                    <img
                            src="{$user_list_top2[0]['headimgurl']}"
                            width="90%" style="margin-top: 3px;"/>

                    <div class="wmr_name">{php echo $this->pre_name($user_list_top2[0]['nickname'])}</div>
                    <div class="wmr_cdwz">第{$user_list_top2[0]['baton_num']}棒</div>
                    <div class="wmr_cwjy">寄语</div>
                </div>
            </li>
            {/if}
            <li class="l">
                <div class="b_8"></div>
            </li>
            {if !empty($user_list_top2[1])}
            <li class="l"
                onclick="getData({$user_list_top2[1]['id']});">
                <div class="b_7 pu_top">
                    <img
                            src="{$user_list_top2[1]['headimgurl']}"
                            width="90%" style="margin-top: 3px;"/>

                    <div class="wmr_name">{php echo $this->pre_name($user_list_top2[1]['nickname'])}</div>
                    <div class="wmr_cdwz">第{$user_list_top2[1]['baton_num']}棒</div>
                    <div class="wmr_cwjy">寄语</div>
                </div>
            </li>
            {/if}


        </ul>
    </div>
    {/if}


    {if !empty($user_list_top2_14)}
				<?php

									for ($index = 0; $index <count($user_list_top2_14);) {
																	
									?>		
				
								<div class="wmr_liubuju ">
											
												<ul class="wmr_liubuju_ul m_70">

														<?php  
															
															for($tempIndex=0;$tempIndex<3;$tempIndex++){  
																	$join_user=$user_list_top2_14[$index];	
														?>
																<li class="l"
																	onclick="getData(<?php echo $join_user['id']; ?>);">
																	<div class="b_7 <?php if($tempIndex%3==1){ echo "m_70" ;}else{echo "pu_top";} ?>">
																		<img
																				src="<?php echo $join_user['headimgurl']; ?>"
																				width="90%" style="margin-top: 3px;"/>

																		<div class="wmr_name"><?php echo $this->pre_name($join_user['nickname']); ?></div>
																		<div class="wmr_cdwz">第<?php echo $join_user['baton_num']; ?>棒</div>
																		<div class="wmr_cwjy">寄语</div>
																	</div>
																</li>
														<?php 
																$index++;
																if($index>=count($user_list_top2_14)){ break;}
														}
															
																
														?>
												</ul>
										
									</div>
								
							<?php }?>
						
    {/if}


</div>
<!--加载更多-->

    <div id="wmr_jiazai" style="clear: both; float: none;">
        <br>

        <div id='jiazaitishi'>加载更多</div>
        <img src="{MON_BATON_RES}images/f9fcfcdf6ca5c3a2.gif" width="30"
             style="margin: 10px 0 0 0;"/> <img
            src="{MON_BATON_RES}images/a8541d09a78f07b7.gif" width="100%"/>

        <div></div>
    </div>

<!--开始体验-->
<div id="wmr_ty" onclick="document.getElementById('sharemcover').style.display='block';">
    <img src="{MON_BATON_RES}images/hfx.gif" height="30"/> <img
        src="{MON_BATON_RES}images/yqhy.gif" height="30"/>
</div>








<!--页脚-->
<div id="foot">
    <div id="foot_1">
        <div id="foot_1_1"></div>
    </div>
    <!-- <div id="foot_2"><img src="/35/template/images/gugao1.gif" width="100%" /></div>  <div id="foot_3"><img src="/35/template/images/gugao2.gif" width="100%" /></div>-->
    <div id="foot_3">

        {$baton['add_intro']}


    </div>
    <div style='text-align: center; font-size: 13px; padding-top: 10px;'>
        <a style='color: gray; display: inline-block;text-decoration: none;text-align: center' href="{$baton['copyright_url']}">{$baton['copyright']}</a>
    </div>
</div>
<!--弹窗1-->
<div id="tc1" style="display: {if TIMESTAMP>$baton['endtime']}block{else}none{/if}">
    <div class="tc1_top">温馨提示</div>
    <div class="tc1_content">
        <span style='color: green'> 活动结束拉，感谢您的参与！</span><br> 总共传递了： <span
            style='color: red'>{php echo $cu_baton-1}棒</span><br>提示：{$baton['end_dialog_tip']}
        <div class="tc1_qd">确定</div>
    </div>
</div>


<!--弹窗2-->
<div id="tc2" style="display: none;">
    <div class="tc2_touxiang">
        <img src="{MON_BATON_RES}images/touxiang.gif" width="80"
             style="border: 3px solid #eb5e54;"/>
    </div>
    <div class="tc2_nicheng">慕容大王</div>
    <div class="tc2_jieban">
        <div class="tc2_wz1">接棒时间：2012年11月12日</div>
        <div class="tc2_wz2">上一棒：飞虎大队长</div>
        <div class="tc2_wz3">建言：</div>
    </div>
    <div class="tc2_gb">
        <img src="{MON_BATON_RES}images/x.png" width="20"/>
    </div>
</div>
<!--弹窗3-->
<div id="sharemcover"
     onclick="document.getElementById('sharemcover').style.display='';"
     style="display: none">
    <img src="{MON_BATON_RES}images/MgnnofmleM3.png">
</div>

<!--弹窗4 -->


<div id="tc4" style="display: none">
    <div class="tc1_top">温馨提示</div>
    <div class="tc1_content">
        <span style='color: green'>{$baton['follow_dialog_tip']}</span>
        <div class="tc1_qd" id="tc_gz" >{$baton['follow_btn']}</div>
    </div>
</div>

<div id="big" class="big" style="display: {if TIMESTAMP>$baton['endtime']}block{else}none{/if}"></div>
<div id="jiazai_data" style="display: none;">1</div>
</body>
<script type="text/javascript">

$(document).ready(function () {

    $("#tc_gz").click(function(){
        window.location.href="{$baton['follow_url']}"
    });

    $("#tc4").click(function(){
        $(this).get(0).style.display="none";
        toggleBack();
    });

    $()

    //接棒
    $("#add_user_jb").click(function(){

        var uname = $("#xm").val();
        var tel = $("#tel").val();
        var speak=$("#speak").val();
        if (uname == "") {
            alert("用户名必须填写");
            return false;
        }

        if (tel == '' || !checkMobile(tel)) {
            alert("手机号格式不正常");
            return false;
        }

        if(speak=="") {
            alert("请填写您的寄语");
            return false;
        }
        var submitData = {
            "uname": uname,
            "tel": tel,
            "speak":speak

        }


        $.post("{php echo $this->createMobileUrl('AjaxJb',array('bid'=>$baton['id']),true)}",submitData,function(res){
             if(res.code==200){

                 swal(
                         {
                             title: "提示!",
                             text: "恭喜您接力成功!您是第"+res.baton_num+"接棒伙伴!",
                             type: "success",
                             showCancelButton: false,
                             confirmButtonColor: "#DD6B55",
                             confirmButtonText: "确定",
                             closeOnConfirm: false,
                             closeOnCancel: false
                         },
                         function(isConfirm){

                             if (isConfirm) {
                                 location.href="{php echo $this->createMobileUrl('UserJBSuccess',array('bid'=>$baton['id']),true)}";
                             }else {  }
                         });


             } else {
                 alert(res.msg);
             }

        },'json');



    });
});



function checkMobile(s) {
    var regu = /^[1][3|8|4|5|7][0-9]{9}$/;
    var re = new RegExp(regu);
    if (re.test(s)) {
        return true;
    } else {
        return false;
    }
}

function jieb() {

         {if TIMESTAMP>$baton['endtime']}
             $("#tc1").get(0).style.display="block";
             toggleBack();
            return ;
        {/if}


    var fanls_enable={$baton['join_fans_enable']};
    var follow="{$follow}";
    if(fanls_enable==1&&!follow) {
        toggleBack();
        $("#tc4").get(0).style.display="block";
        return ;
    }
    {if empty($user)}
        $("#adduser").show();
    {else}
        location.href="{php echo $this->createMobileUrl('userbaton',array('bid'=>$baton['id']),true)}";
    {/if}
}



function toggleBack() {
    if( $("#big").get(0).style.display=="block") {
        $("#big").get(0).style.display="none";
    } else {
        $("#big").get(0).style.display="block"
    }

}
function getData(uid) {

	
    $.get("{php echo $this->createMobileUrl('UserDeatil',array('bid'=>$baton['id']),true)}",{"uid":uid},function(res){
        if(res.code==200){
            $(".tc2_touxiang").html('<img src=\"'+res.headimgurl+'\" height=100px;width=100px;>');
            $(".tc2_touxiang img").css("border","#eb5e54 5px solid");
            $(".tc2_nicheng").html(res.nickname);
            $(".tc2_wz1").html("接棒时间:"+res.time);
            $(".tc2_wz2").html("上一棒:"+res.prenickname);
            $(".tc2_wz3").html("寄语:"+res.speak);
            tc2();
        } else {
            alert(res.msg);
        }

    },'json');

}


$(document).ready(function () {
    $(".tc1_qd").click(function () {
        var divInhalt = document.getElementById("tc1");
        divInhalt.style.display = "none";
        var divBig = document.getElementById("big");
        divBig.style.display = "none";
    });
});

        //加载更多
$(document).ready(function () {
    $("#wmr_jiazai").click(function () {

        var page = $("#jiazai_data").html();
        $.get("{php echo $this->createMobileUrl('UserPage',array('bid'=>$baton['id']),true)}",{"page":page},function(res){
            $("#jiazaitishi").html('加载更多');
            if(res=='nodata') {
                alert("无更多内容");
            } else {
                $("#wmr").append(res);
                $("#jiazai_data").html(parseInt(page)+1);
            }

        });
    });


});
$(document).ready(function () {

    $(".tc2_gb").click(function () {
        var divInhalt = document.getElementById("tc2");
        divInhalt.style.display = "none";
        var divBig = document.getElementById("big");
        divBig.style.display = "none";
    });

    /*
    $("#big").click(function () {
        var divInhalt = document.getElementById("tc1");
        divInhalt.style.display = "none";
        var divInhalt = document.getElementById("tc2");
        divInhalt.style.display = "none";
        var divBig = document.getElementById("big");
        divBig.style.display = "none";
    });*/
});
function tc1() {
    /*
    $('body,html').animate({scrollTop: 0}, 1000);
    var divInhalt = document.getElementById("tc1");
    var divBig = document.getElementById("big");
    var v_left = (document.body.clientWidth - 200) / 2;
    divInhalt.style.left = (v_left) + 'px';
    divBig.style.display = "block";
    divInhalt.style.display = "block";
    document.body.style.overflow = "hidden";*/
}
function tc2() {

    $('body,html').animate({scrollTop: 0}, 1000);
    var divInhalt = document.getElementById("tc2");
    var divBig = document.getElementById("big");
    var v_left = (document.body.clientWidth - 200) / 2 - 10;
    divInhalt.style.left = (v_left) + 'px';
    
    divInhalt.style.display = "block";
    document.body.style.overflow = "hidden";
	$("#tc2").css('z-index',999);
	$("#big").css('z-index',0);
	divBig.style.display = "block";
}

</script>

{php echo register_jssdk(false);}
<script type="text/javascript">
    initShare();

    function initShare(){
        wx.ready(function () {
            sharedata = {
                title: "{php echo str_replace('#name',$userInfo['nickname'],str_replace('#num',$user['baton_num'],$baton['share_title']))}",
                desc: "{php echo str_replace('#name',$userInfo['nickname'],str_replace('#num',$user['baton_num'],$baton['share_content']))}",
                link: "{php echo $this->getShareUrl($baton['id'],$user['id'])}",
                imgUrl: "{$_W['attachurl']}{$baton['share_icon']}",
                success: function(){

                },
                cancel: function(){

                }
            };
            wx.onMenuShareAppMessage(sharedata);
            wx.onMenuShareTimeline(sharedata);
        });
    }

</script>



</html>
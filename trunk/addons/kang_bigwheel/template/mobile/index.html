<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content=" initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <link href="../addons/kang_bigwheel/template/css/square.css" rel="stylesheet" type="text/css" />
	<script type="text/javascript" src="../addons/kang_bigwheel/template/js/zepto.js"></script>
    <script type="text/javascript" src="../addons/kang_bigwheel/template/js/WeixinApi.js"></script>
    <script type="text/javascript" src="../addons/kang_bigwheel/template/js/preloadImg.js"></script>
    <title>{$reply['title']}</title>
</head>
<body style="background-color:#E42C30; background-image: url('../addons/kang_bigwheel/template/images/main_bg.png'); background-size: 100% auto; background-repeat: no-repeat;">

<div id="homepage" style="position: fixed; left: 0; top: 0; width: 100%; height: 100%;  z-index: 999;text-align: center; ">
    <img style="position:absolute;left: 0;top:0; width: 100%; height: 100%;" src="../addons/kang_bigwheel/template/images/home_bg.png" width="100%" height="100%" />

    <img id="home_btn_start" style="position:absolute; bottom: 0; right: 0; width: 100%"
         src="../addons/kang_bigwheel/template/images/home_btn_start.png" />
</div>

<div id="rulepage" style="position: fixed; left: 0; top: 0; width: 100%; height: 100%;  z-index: 990;text-align: center; display: none; ">
    <img style="position:absolute;left: 0;top:0; width: 100%; height: 100%;" src="../addons/kang_bigwheel/template/images/rule.png" width="100%" height="100%" />
</div>

<div style="max-width:500px;">

    <!-- 主页面元素 begin -->
    <div class="nou">
	    <div style="max-width:100%">
		{if !empty($reply['adpic'])}{if !empty($reply['adpicurl'])}<a href="{$reply['adpicurl']}">{/if}<img id="top_img" style="max-width: 100%;height: auto;width: auto\9;"  src="{php echo toimage($reply['adpic'])}" width="100%" border="0">{if !empty($reply['adpicurl'])}</a>{/if}{/if}
        </div>
        <div class="zhuan1" id="lottery">

		    {if $reply['opportunity']==2}
            <!--
			<div class="mingdan">
                <div class="biaoti">我的{$creditnames} <span class="n" id="credit_now">{php echo intval($credit[$reply['credit_type']])}</span> 个  每次 <span class="n">{$reply['credit_times']}</span> {$creditnames}</div>
            </div>
            -->
			{/if}
			{if $reply['opportunity']==1}
			<!--
            <div class="mingdan">
                <div class="biaoti"> 赠送 <span class="n">{$reply['number_times']}</span> 次抽奖机会 剩余 <span class="n" id="number_times">{php echo $reply['number_times']-$fans['totalnum']}</span> 次</div>
            </div>
            -->
			{/if}
			{if $reply['opportunity']==0}
            <!--
			<div class="mingdaninfo">
				<div class="box">					
					<div class="Detail" style="color:#FFF;text-align:center;">{$detail}</div>
				</div>
            </div>
            -->
			{/if}

			<div class="main">
				<div id="outercont">
            		<div id="outer-cont">
               		 <div id="outer"><img src="{php echo toimage($reply['bigwheelpic'])}"></div>
            		</div>
            		<div id="inner-cont">
                		<div id="inner">
                    		<img src="{php echo toimage($reply['bigwheelimg'])}">
                		</div>
            		</div>
       		    </div>
			</div>

            <!--
			<div class="mingdan">
                <div class="biaoti">已有 <span class="n">{php echo $reply['xuninum']+$reply['fansnum']}</span> 人参与此活动</div>
            </div>
            -->
			{if !empty($award_list)&&$reply['awardnum']}
			<!--
            <div class="mingdan">
                <div class="biaoti"><marquee behavior="scroll" scrolldelay="200">{$award_list}</marquee></div>
            </div>
            -->
			{/if}
			{if $share['sharenum']>0}
            <!--
			<div class="boxwhite">
                <div id="shareimg" class="share"><img src="{$share['share_picurl']}"></div>
            </div>
            -->
			{/if}

			<div style="height:55px;">&nbsp;&nbsp;</div>
        </div>
    </div>
    <!-- 主页面元素 end -->

    <!-- 抽奖结果提示框 begin -->
	<div class="panel-box" id="panel_box">
        <div class="panel-content" id="panel-content">
            <div class="panel-close" id="panel-close"></div>

            <span class="icon-prize-useless" id="panelimg"></span>

            <div class="info_lost_guanzhu">
                <img src="../addons/kang_bigwheel/template/images/info_lost_guanzhu.png">
                <br>
                <div  class="info_btn">
                    <input class="btn-guanzhu" name="关注公众号" id="btn_guanzhu" type="button" value="关注公众号">
                </div>
            </div>

            <div class="info_lost_over">
                <img src="../addons/kang_bigwheel/template/images/info_lost_over.png">
            </div>

            <div class="info_lost_1">
                <img src="../addons/kang_bigwheel/template/images/info_lost_1.png">
                <br>
                <div class="info_btn">
                    <input class="btn-share" name="点击发送朋友圈" id="btn_share" type="button" value="点击发送朋友圈">
                </div>
            </div>

            <div class="info_lost_2">
                <img src="../addons/kang_bigwheel/template/images/info_lost_2.png">
            </div>

            <!--
            <div id="cccc">{$reply['ticketinfo']}</div>
            -->
            <div id="cccc"></div>

            <!-- TODO WKL 目前不用通用版 -->
            <!--
			<div id="result_info"{if !$isfans} style="display:none"{/if}>
			    <div id="isfans" style="display:none">{$isfans}</div>
			    <hr class="common-hr" />
                {if $reply['isrealname']}<label>{$isfansname[0]}</label><input name="text" class="px" id="realname" value="{$profile['realname']}" type="text" placeholder="请输入{$isfansname[0]}">{/if}
				{if $reply['ismobile']}<label>{$isfansname[1]}</label><input name="tel" class="px" id="mobile" value="{$profile['mobile']}" type="text" placeholder="请输入{$isfansname[1]}">{/if}
				{if $reply['isqq']}<label>{$isfansname[2]}</label><input name="tel" class="px" id="qq" value="{$profile['qq']}" type="text" placeholder="请输入{$isfansname[2]}">{/if}
				{if $reply['isemail']}<label>{$isfansname[3]}</label><input name="email" class="px" id="email" value="{$profile['email']}" type="text" placeholder="请输入{$isfansname[3]}">{/if}
				{if $reply['isaddress']}<label>{$isfansname[4]}</label><input name="text" class="px" id="address" value="{$profile['address']}" type="text" placeholder="请输入{$isfansname[4]}">{/if}
				{if $reply['isgender']}<label>{$isfansname[5]}</label><select name="gender" id="gender" class="form-control">
						<option value="0"{if $profile['gender']==0} selected {/if}>选择{$isfansname[5]}</option>
						<option value="1"{if $profile['gender']==1} selected {/if}>男</option>
						<option value="2"{if $profile['gender']==2} selected {/if}>女</option>
					</select>{/if}
				{if $reply['istelephone']}<label>{$isfansname[6]}</label><input name="text" class="px" id="telephone" value="{$profile['telephone']}" type="text" placeholder="请输入{$isfansname[6]}">{/if}
				{if $reply['isidcard']}<label>{$isfansname[7]}</label><input name="text" class="px" id="idcard" value="{$profile['idcard']}" type="text" placeholder="请输入{$isfansname[7]}">{/if}
				{if $reply['iscompany']}<label>{$isfansname[8]}</label><input name="text" class="px" id="company" value="{$profile['company']}" type="text" placeholder="请输入{$isfansname[8]}">{/if}
				{if $reply['isoccupation']}<label>{$isfansname[9]}</label><input name="text" class="px" id="occupation" value="{$profile['occupation']}" type="text" placeholder="请输入{$isfansname[9]}">{/if}
				{if $reply['isposition']}<label>{$isfansname[10]}</label><input name="text" class="px" id="position" value="{$profile['position']}" type="text" placeholder="请输入{$isfansname[10]}">{/if}
                <div id="result_info_tip"></div>
				<div class="btn-layout">
                    <input type="reset" class="btn-reset" value="重填"/>
					<input class="btn-confirm" name="确定" id="save-btn" type="button" value="确定">
                </div>
            </div>
			<div id="result_info1" style="display:none">
			    <div style="margin-top:10px;">
                    <input class="btn-confirm" name="放入百宝箱" id="savebtn" type="button" value="放入百宝箱">
                </div>
			</div>
			-->
        </div>
    </div>
    <!-- 抽奖结果提示框 end -->

    <!-- 奖品提示框 begin -->
    <div class="" id="panel_prize_box">
        <div class="panel-content" id="panel_prize_content">
            <div class="panel-close" id="panel_prize_close"></div>

            <div class="prize_quan">
                <img src="../addons/kang_bigwheel/template/images/prize_quan.png">
                <img id="btn_prize_quan" style="position:absolute; bottom: 0; right: 0; width: 100%"
                     src="../addons/kang_bigwheel/template/images/btn_get_prize.png" />
            </div>
            <div class="prize_piao">
                <img src="../addons/kang_bigwheel/template/images/prize_piao.png">
                <img id="btn_prize_piao" style="position:absolute; bottom: 0; right: 0; width: 100%"
                     src="../addons/kang_bigwheel/template/images/btn_get_prize.png" />
            </div>
            <div class="prize_jiashiqi">
                <img src="../addons/kang_bigwheel/template/images/prize_jiashiqi.png">
                <img id="btn_prize_jiashiqi" style="position:absolute; bottom: 0; right: 0; width: 100%"
                     src="../addons/kang_bigwheel/template/images/btn_get_prize.png" />
            </div>
            <div class="prize_t">
                <img src="../addons/kang_bigwheel/template/images/prize_t.png">
                <img id="btn_prize_t" style="position:absolute; bottom: 0; right: 0; width: 100%"
                     src="../addons/kang_bigwheel/template/images/btn_get_prize.png" />
            </div>

        </div>
    </div>
    <!-- 奖品提示框 end -->


    <!-- 分享提示框 begin -->
	<div class="panel-box" id="share_box">
        <div class="panel-share" id="panel-share">
            <div class="panel-close" id="share_close"></div>
            <div id="share_tip"></div>
			<hr class="common-hr" />
			<div style="margin-top:10px;" id="share_miao"><input class="btn-confirm" name="关闭" id="sharebtn" type="button" value="关闭"> </div>
        </div>
    </div>
    <!-- 分享提示框 end -->

    <!-- 领奖提示框 begin -->
    <div class="panel_box_get_prize" id="panel_box_get_prize">

        <!-- 领奖提示框 兑奖码 begin -->
        <div class="get_prize_content" id="get_prize_box_code">
            <div class="get_prize_close" ></div>
            <div class="get_prize_code_title">
                <input class="btn-code" name="兑换码" type="button" value="兑换码">
            </div>
            <div class="get_prize_code" id="get_prize_code"></div>

            <div class="get_prize_input">
                <div class="get_prize_input_left">
                    <p>姓名</p>
                    <p><input type="text" value="" id="get_prize_input_name"></p>
                    <p>电话</p>
                    <p><input type="text" value="" id="get_prize_input_tel"></p>
                    <p id="result_info_tip1"></p>
                </div>
                <div class="get_prize_input_right">
                    <input id="btn_get_prize_code" class="btn-submit" name="提交" type="button" value="提交">
                </div>
            </div>

            <div style="clear:both"></div>

            <div class="tip_success">您的信息已提交，请截图保存好您的兑换码，现场可凭兑换码截图领取吴亦凡见面会门票一张，仅以首次兑换为准，重复兑换无效。</div>

            <!--<hr class="common-hr" />-->
        </div>

        <!-- 领奖提示框 兑奖码 end -->

        <!-- 领奖提示框 兑奖码 begin -->
        <div class="get_prize_content" id="get_prize_box_physical">
            <div class="get_prize_close" ></div>

            <div id="get_prize_tip">请务必真实准确填写以下信息：</div>

            <div class="get_prize_input">
                    <p>收货人：</p>
                    <p><input type="text" value="" id="get_prize_input_name2"></p>
                    <p>联系电话：</p>
                    <p><input type="text" value="" id="get_prize_input_tel2"></p>
                    <p>详细地址：</p>
                    <p><input type="text" value="" id="get_prize_input_address"></p>
                    <p id="result_info_tip2"></p>
                <div>
                    <input id="btn_get_prize_physical" class="btn-submit-red" name="提交" type="button" value="提交">
                </div>
            </div>

            <div style="clear:both"></div>

            <div class="tip_success" style="margin-top: 80px;">
                <p style="font-size: 30px; color:#f00; text-align: center;">感谢您的参与</p>
                <p style="font-size: 25px; color:#000; text-align: center; margin-top: 20px;">我们会在活动结束后的10个工作日内 寄出您的获奖礼品，请耐心等候。</p>
            </div>

        </div>
        <!-- 领奖提示框 兑奖码 end -->

<!--
        <div class="get_prize_content" id="get_prize_content">
            <div class="get_prize_close" ></div>
            <div id="get_prize_tip"></div>

            <div style="margin-top:10px;" id="get_prize_miao">
                <input class="btn-confirm" name="关闭" id="sharebtn" type="button" value="关闭">
            </div>
        </div>
-->
    </div>
    <!-- 领奖提示框 begin -->

</div>
{if $share['sharenum']>0}<div id="pop_share"><img src="{$share['share_pic']}" width="100%" alt="分享到朋友圈"/></div>{/if}
{template 'footer'}
<script type="text/javascript">
		$(function () {
			window.requestAnimFrame = (function () {
                return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame ||
                function (callback) {
                    window.setTimeout(callback, 1000 / 60)
                }
            })();
            var totalDeg = 360 * 3 + 0;
            var steps = [];
            var lostDeg = [{$reply['lostDeg']}];
            var prizeDeg = [{$reply['prizeDeg']}];
            var prize,height,sncode,prizename,prizedes,isfans,credit_now,isphysical;
            var count = 0;
            var now = 0;
            var a = 0.01;
            var outter, inner, timer, running = false;
			$("#shareimg").click(function(){
		   		$("#pop_share").show(500);
                setTimeout(function () {
                    $("#pop_share").hide();
                }, 6000);
	   		});

	   		$("#pop_share").click(function(){
		  		 $("#pop_share").hide(500);
	    	});
            function countSteps() {
                var t = Math.sqrt(2 * totalDeg / a);
                var v = a * t;
                for (var i = 0; i < t; i++) {
                    steps.push((2 * v * i - a * i * i) / 2)
                }
                steps.push(totalDeg)
            }
            function step() {
                outter.style.webkitTransform = 'rotate(' + steps[now++] + 'deg)';
                outter.style.MozTransform = 'rotate(' + steps[now++] + 'deg)';
                if (now < steps.length) {
                    running = true;
                    requestAnimFrame(step)
                } else {
                    running = false;
                    setTimeout(function () {
                        if (prize != null) {


                            $(".icon-prize-useless").show();
                            $(".info_lost_guanzhu").hide();
                            $(".info_lost_over").hide();
                            $(".info_lost_1").hide();
                            $(".info_lost_2").hide();

                             /*
						    if(prize == 0){

                                $("#panelimg").css({"background-image": "url(../addons/kang_bigwheel/template/images/icon_prize_credit.png)"});
                                $("#panel_box").show();
                                $("#savebtn").val('收入囊中');
                                $("#cccc").text(prizename + "获得" + sncode + "个" + prizedes);
							}else{

                                $("#panel_box").show();
								$("#panelimg").css({"background-image": "url("+prizedes['prizepic']+")"});
					            $("#cccc").text(prizedes['prizetype']+"-"+prizedes['prizename']);
					            $("#credit_now").text(credit_now);
							}
							if(credit_now != 0){
							    $("#credit_now").text(credit_now);
							}
							$("#panel-content").css({"height": ""+height+"px"});
							if(isfans){
								$("#result_info").show();
								$("#result_info1").hide();
							}else{
								$("#result_info").hide();
								$("#result_info1").show();
							}
							*/

                            $("#panel_prize_box").show();

                            if(prize == 1 || prize == 4){
                                $(".prize_piao").show();
                                $(".prize_jiashiqi").hide();
                                $(".prize_quan").hide();
                                $(".prize_t").hide();

                                $("#btn_prize_piao").click(function () {
                                    $("#panel_box_get_prize").show();
                                    $("#get_prize_box_code").show();
                                    $("#get_prize_box_physical").hide();

                                    $("#get_prize_box_code .tip_success").hide();
                                    $("#get_prize_box_code .get_prize_input").show();
                                });

                                $("#get_prize_code").html(sncode);


                            }else if(prize == 2){
                                $(".prize_jiashiqi").show();
                                $(".prize_piao").hide();
                                $(".prize_quan").hide();
                                $(".prize_t").hide();

                                $("#btn_prize_jiashiqi").click(function () {
                                    $("#panel_box_get_prize").show();
                                    $("#get_prize_box_code").hide();
                                    $("#get_prize_box_physical").show();

                                    // 复位控件
                                    $("#get_prize_box_physical .tip_success").hide();
                                    $("#get_prize_box_physical .get_prize_input").show();
                                    $("#get_prize_box_physical #get_prize_tip").show();
                                });

                                $("#get_prize_code").html(sncode);

                            }else if(prize == 3 || prize == 5){
                                $(".prize_quan").show();
                                $(".prize_piao").hide();
                                $(".prize_jiashiqi").hide();
                                $(".prize_t").hide();

                                // 优惠券领取地址
                                //TODO WKL 后台增加选项
                                $("#btn_prize_quan").click(function () {
                                    window.location.href = "http://wanyouxibu.com/blog";
                                });
                            }else if(prize == 6){
                                $(".prize_t").show();
                                $(".prize_piao").hide();
                                $(".prize_jiashiqi").hide();
                                $(".prize_quan").hide();

                                $("#btn_prize_t").click(function () {
                                    $("#panel_box_get_prize").show();
                                    $("#get_prize_box_code").hide();
                                    $("#get_prize_box_physical").show();

                                    // 复位控件
                                    $("#get_prize_box_physical .tip_success").hide();
                                    $("#get_prize_box_physical .get_prize_input").show();
                                    $("#get_prize_box_physical #get_prize_tip").show();

                                });

                                $("#get_prize_code").html(sncode);
                            }

                        } else {
                            console.log("没有中奖" );

                            if(prizename == '未关注') {

                                if (credit_now != "") {
                                    // 引导关注页

//                                    alert("credit_now  "+credit_now);
//                                    alert("没有中奖，现在去关注公众号，中奖率会提高哦");
//                                    window.location.href=credit_now;


                                    $(".icon-prize-useless").hide();
                                    $(".info_lost_guanzhu").show();
                                    $(".info_lost_over").hide();
                                    $(".info_lost_1").hide();
                                    $(".info_lost_2").hide();

                                    $("#panel_box").show();

                                    $("#btn_guanzhu").show();
                                    // 跳转到专注引导页
                                    $("#btn_guanzhu").click(function () {
                                        window.location.href = credit_now;
                                    });


                                } else {
                                    alert("没有中奖，关注公众号，中奖率会提高哦");
                                }


//                                $("#result_info").hide();
//                                $("#result_info1").show();
                            }else if(prizename == '第一次抽奖不中') {
                                $(".icon-prize-useless").hide();
                                $(".info_lost_guanzhu").hide();
                                $(".info_lost_over").hide();
                                $(".info_lost_1").show();
                                $(".info_lost_2").hide();

                                $("#panel_box").show();
                            }else if(prizename == '第二次抽奖不中') {
                                $(".icon-prize-useless").hide();
                                $(".info_lost_guanzhu").hide();
                                $(".info_lost_over").hide();
                                $(".info_lost_1").hide();
                                $(".info_lost_2").show();

                                $("#panel_box").show();
                            }else{
                                $(".icon-prize-useless").hide();
                                $(".info_lost_guanzhu").hide();
                                $(".info_lost_over").hide();
                                $(".info_lost_1").hide();
                                $(".info_lost_2").show();

                                $("#panel_box").show();

                                //TODO WKL 没有中奖
                            }

                        }
                    },
                    200)
                }
            }
			{if $isfans}
                $("#panel_box").show();
                $("#panel-content").css({"height": "{$isfansh}px"});
			{/if}
            function run(){
                running = true;
                        timer = setInterval(function () {
                            i += 5;
                            outter.style.webkitTransform = 'rotate(' + i + 'deg)';
                            outter.style.MozTransform = 'rotate(' + i + 'deg)'
                        },
                        1)
            }
            function start(deg) {
                deg = deg || lostDeg[parseInt(lostDeg.length * Math.random())];
                running = true;
                clearInterval(timer);
                totalDeg = 360 * 2 + deg;
                steps = [];
                now = 0;
                countSteps();
                requestAnimFrame(step)
            }
            window.start = start;
            outter = document.getElementById('outer');
            inner = document.getElementById('inner');
            i = 10;
            $("#inner").click(function () {
	        if($("#isfans").text()==1){

                $("#panel_box").show();
                $("#panel-content").css({"height": "{$isfansh}px"});

			}else{
			    if (running) return;
                $.ajax({
                    url: "{php echo $this->createMobileUrl('get_award', array('rid' => $rid))}",
                    dataType: "json",
                    data: {
                        t: Math.random()
                    },
                    beforeSend: function () {

                    },
                    success: function (data) {
                        if (data.success) {

                            console.dir(data);

							if(data.success==1) {
                                run();
                                prize = data.prizetype;
                                prizename = data.name;
                                prizedes = data.award;
                                sncode = data.sn;
								isfans = data.isfans;
								height = data.height;
                                credit_now = data.credit_now;
                                isphysical = data.isphysical;
								if(data.prizetype==0){
								    start();
								}else{
								    start(prizeDeg[data.prizetype - 1]);
								}
								if($("#credit_now").length>0){
							        $("#credit_now").text(parseInt($("#credit_now").text())-{$reply['credit_times']});
						        }
						        if($("#count").length>0){
							        $("#count").text(parseInt($("#count").text())+1);
						        }
						        if($("#totalcount").length>0){
							        $("#totalcount").text(parseInt($("#totalcount").text())+1)
						        }
                            }else{
                                prize = null;  clearInterval(timer);


                                /*
								$("#panelimg").css({"background-image": "url(../addons/kang_bigwheel/template/images/icon_prize_useless.png)"});
                                $("#panel_box").show();
                                $("#savebtn").val('关闭');
                                $("#cccc").text(data.msg);
                                */

                                if(data.msg=="超过当日限制次数"){
                                    $(".icon-prize-useless").hide();
                                    $("#result_info").hide();
                                    $("#result_info1").hide();

                                    $(".info_lost_guanzhu").hide();
                                    $(".info_lost_over").show();
                                    $(".info_lost_1").hide();
                                    $(".info_lost_2").hide();

                                    $("#panel_box").show();
                                }else{
                                    alert(data.msg);
                                }


                            }
                        } else {
                            prize = null;run();
                            start();
                        }
                        running = false;
                        count++;

                    },
                    error: function () {
                        prize = null;
                        start();
                        running = false;
                        count++;
                    },
                    timeout: 15000
                })
            }
            })
        });

        $("#save-btn").bind("click",function () {
            var btn = $(this);
            {if $reply['isrealname']}
			var realname = $("#realname").val();
            if (realname == '') {
				$("#result_info_tip").text("请输入{$isfansname[0]}");
                return
            }
			var partten = /[\u4e00-\u9fa5]/g;
            if(!partten.test(realname)){
               $("#result_info_tip").text("请输入正确的{$isfansname[0]}");
			   return;
            }
			{/if}
			{if $reply['ismobile']}
			var mobile = $("#mobile").val();
            if (mobile == '') {
                $("#result_info_tip").text("请输入{$isfansname[1]}");
                return
            }
			var partten = /^1\d{10}$/;
            if(!partten.test(mobile)){
               $("#result_info_tip").text("请输入正确的{$isfansname[1]}");
			   return;
            }
			{/if}
			{if $reply['isqq']}
			var qq = $("#qq").val();
            if (qq == '') {
                $("#result_info_tip").text("请输入{$isfansname[2]}");
                return
            }
            var partten = /^[1-9]{1}\d{4,11}$/;
            if(!partten.test(qq)){
               $("#result_info_tip").text("请输入正确的{$isfansname[2]}");
			   return;
            }
			{/if}
			{if $reply['isemail']}
			var email = $("#email").val();
            if (email == '') {
                $("#result_info_tip").text("请输入{$isfansname[3]}");
                return
            }
			var partten = /^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/;
            if(!partten.test(email)){
               $("#result_info_tip").text("请输入正确的{$isfansname[3]}");
			   return;
            }
			{/if}
			{if $reply['isaddress']}
			var address = $("#address").val();
            if (address == '') {
                $("#result_info_tip").text("请输入{$isfansname[4]}");
                return
            }
			{/if}
			{if $reply['isgender']}
			var gender = $("#gender").val();
            if (gender == '0') {
                $("#result_info_tip").text("请选择{$isfansname[5]}");
                return
            }
			{/if}
			{if $reply['istelephone']}
			var telephone = $("#telephone").val();
            if (telephone == '') {
                $("#result_info_tip").text("请输入{$isfansname[6]}");
                return
            }
			{/if}
			{if $reply['isidcard']}
			var idcard = $("#idcard").val();
            if (idcard == '') {
                $("#result_info_tip").text("请输入{$isfansname[7]}");
                return
            }
			{/if}
			{if $reply['iscompany']}
			var company = $("#company").val();
            if (company == '') {
                $("#result_info_tip").text("请输入{$isfansname[8]}");
                return
            }
			{/if}
			{if $reply['isoccupation']}
			var occupation = $("#occupation").val();
            if (occupation == '') {
                $("#result_info_tip").text("请输入{$isfansname[9]}");
                return
            }
			{/if}
			{if $reply['isposition']}
			var position = $("#position").val();
            if (position == '') {
                $("#result_info_tip").text("请输入{$isfansname[10]}");
                return
            }
			{/if}
            var submitData = {
                    code: $("#sncode").text(),
                    {if $reply['isrealname']}realname: realname,{/if}
					{if $reply['ismobile']}mobile: mobile,{/if}
					{if $reply['isqq']}qq: qq,{/if}
					{if $reply['isemail']}email: email,{/if}
					{if $reply['isaddress']}address: address,{/if}
					{if $reply['isgender']}gender: gender,{/if}
					{if $reply['istelephone']}telephone: telephone,{/if}
					{if $reply['isidcard']}idcard: idcard,{/if}
					{if $reply['iscompany']}company: company,{/if}
					{if $reply['isoccupation']}occupation: occupation,{/if}
					{if $reply['isposition']}position: position,{/if}
            };
           	$.post('{php echo $this->createMobileUrl('settel', array('rid' => $rid))}', submitData, function(data) {
			if (data.success == true) {
				$("#result_info").html("<br/><br/>" + data.msg + "<br/><div id='share_miao'>3秒后自动关闭</div>");
				djstime(3);
				setTimeout(function () {
				    $("#panel_box").hide();
					$("#result_info").hide();
					$("#isfans").text('0');
				},4000)
				return
			} else {
			    $("#result_info_tip").text(data.msg);
				return
			}
			},"json")
        });


    $("#btn_get_prize_code").bind("click",function () {
        var btn = $(this);
        var realname = $("#get_prize_input_name").val();
        if (realname == '') {
            $("#result_info_tip1").text("请输入姓名");
            return
        }
        var partten = /[\u4e00-\u9fa5]/g;
        if(!partten.test(realname)){
            $("#result_info_tip1").text("请输入正确的姓名");
            return;
        }
        var mobile = $("#get_prize_input_tel").val();
        if (mobile == '') {
            $("#result_info_tip1").text("请输入电话");
            return
        }
        var partten = /^1\d{10}$/;
        if(!partten.test(mobile)){
            $("#result_info_tip1").text("请输入正确的电话");
            return;
        }

        var submitData = {
            code: $("#sncode").text(),
            realname: realname,
            mobile: mobile,
            address: '未登记'
        };
        $.post('{php echo $this->createMobileUrl('settel', array('rid' => $rid))}', submitData, function(data) {
            if (data.success == true) {

                $("#panel_prize_box").hide();

                $(".prize_piao").hide();
                $(".prize_jiashiqi").hide();
                $(".prize_quan").hide();
                $(".prize_t").hide();

//                $("#panel_box_get_prize").hide();
//                $("#get_prize_box_code").hide();
                $("#get_prize_box_physical").hide();

                $("#result_info_tip1").text("");
                $("#get_prize_input_name").val("");
                $("#get_prize_input_tel").val("");

//                alert("虚拟 ok");

                $("#get_prize_box_code .tip_success").show();
                $("#get_prize_box_code .get_prize_input").hide().css("display","none");



                return
            } else {
                $("#result_info_tip1").text(data.msg);
                return
            }
        },"json")

    });

    $("#btn_get_prize_physical").bind("click",function () {
        var btn = $(this);
        var realname = $("#get_prize_input_name2").val();
        if (realname == '') {
            $("#result_info_tip2").text("请输入收货人");
            return
        }
        var partten = /[\u4e00-\u9fa5]/g;
        if(!partten.test(realname)){
            $("#result_info_tip2").text("请输入正确的收货人");
            return;
        }
        var mobile = $("#get_prize_input_tel2").val();
        if (mobile == '') {
            $("#result_info_tip2").text("请输入联系电话");
            return
        }
        var partten = /^1\d{10}$/;
        if(!partten.test(mobile)){
            $("#result_info_tip2").text("请输入正确的联系电话");
            return;
        }

        var address = $("#get_prize_input_address").val();
        if (address == '') {
            $("#result_info_tip2").text("请输入详细地址");
            return
        }

        var submitData = {
            code: $("#sncode").text(),
            realname: realname,
            mobile: mobile,
            address: address
        };
        $.post('{php echo $this->createMobileUrl('settel', array('rid' => $rid))}', submitData, function(data) {
            if (data.success == true) {
                $("#panel_prize_box").hide();

                $(".prize_piao").hide();
                $(".prize_jiashiqi").hide();
                $(".prize_quan").hide();
                $(".prize_t").hide();

//                $("#panel_box_get_prize").hide();
                $("#get_prize_box_code").hide();
//                $("#get_prize_box_physical").hide();

                $("#result_info_tip2").text("");
                $("#get_prize_input_name2").val("");
                $("#get_prize_input_tel2").val("");
                $("#get_prize_input_address").val("");

                $("#get_prize_box_physical .tip_success").show();
                $("#get_prize_box_physical .get_prize_input").hide().css("display","none");

                $("#get_prize_box_physical #get_prize_tip").hide();

                return
            } else {
                $("#result_info_tip2").text(data.msg);
                return
            }
        },"json")
    });

	$("#shareimg").click(function(){
        $("#pop_share").fadeToggle();
	});

	$("#pop_share").click(function(){
	    $("#pop_share").fadeToggle();
	});
	$("#panel-close").click(function(){
		$("#panel_box").hide();
	});
	$("#savebtn").click(function(){
		$("#panel_box").hide();
	});
	$("#share_close").click(function(){
		$("#share_box").hide();
	});
	$("#sharebtn").click(function(){
		$("#share_box").hide();
	});

    $("#btn_share").click(function(){
        $("#pop_share").show(500);
        setTimeout(function () {
            $("#pop_share").hide();
        }, 6000);
    });

    $("#home_btn_start").click(function(){
        $("#homepage").hide(500);
        $("#rulepage").show(500);
        setTimeout(function () {
            $("#rulepage").hide();
        }, 10000);
    });

    $("#rulepage").click(function(){
        $("#rulepage").hide();
    });

    $("#panel_prize_close").click(function(){
        $("#panel_prize_box").hide();
    });

    $(".get_prize_close").click(function(){
        $("#panel_box_get_prize").hide();
    });

/*倒计时*/
function djstime(miao){
	var e1=$("#share_miao").first();
	var i=miao;
	var interval=setInterval(function(){
		e1.html(i+"秒自动关闭");
		$("#share_miao").css("line-height","35px");
		i--;
		if(i<0){
			$("#share_miao").css({cursor:"pointer"});
			$("#share_miao").css("line-height","18px");
			clearInterval(interval);
		}
	},1000);
}
</script>
<!-- 微信分享设置 -->
<script>var require = { urlArgs: 'v={php echo date('YmdH');}' };</script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script src="{$_W['siteroot']}app/resource/js/require.js"></script>
<script src="{$_W['siteroot']}app/resource/js/app/config.js"></script>
<script type="text/javascript">
	// jssdk config 对象
	jssdkconfig = {php echo json_encode($_W['account']['jssdkconfig']);} || {};
	// 是否启用调试
	jssdkconfig.debug = false;

	jssdkconfig.jsApiList = [
		'checkJsApi',
		'onMenuShareTimeline',
		'onMenuShareAppMessage',
		'onMenuShareQQ',
		'onMenuShareWeibo',
		'showOptionMenu'
	];

	wx.config(jssdkconfig);
	require(['jquery', 'util'], function($, util){
		var sharedata = {
	        "imgUrl" : "{$shareimg}",
	        "link" : "{$sharelink}",
	        "desc" : "{$sharedesc}",
	        "title" : "{$sharetitle}"
	    };

		wx.ready(function () {
			wx.showOptionMenu();
			wx.onMenuShareAppMessage({
			    title: sharedata.title,
			    desc: sharedata.desc,
			    link: sharedata.link,
			    imgUrl: sharedata.imgUrl,
			    {if !empty($share['share_cancel'])}
				// 分享取消
				cancel: function (res) {
			        $("#share_tip").text("{$share['share_cancel']}");
			        $("#share_miao").text("5秒后自动关闭");
			        $("#share_box").show();
			        djstime(5);
			        setTimeout(function () {
			            $("#share_box").hide();
			        }, 6000);
			    },
				{/if}
				{if !empty($share['share_fail'])}
				// 分享取消
			    fail: function (res) {
			        $("#share_tip").text("{$share['share_fail']}");
			        $("#share_miao").text("5秒后自动关闭");
			        $("#share_box").show();
			        djstime(5);
			        setTimeout(function () {
			            $("#share_box").hide();
			        }, 6000);
			    },
				{/if}
				{if !empty($share['share_confirm'])}
				// 分享成功
				success : function(resp) {
				    // 分享成功了，我们是不是可以做一些分享统计呢？
				    $.getJSON('{php echo $this->createMobileUrl('get_share', array('rid' => $rid,'from_user' => $page_from_user))}', function(data){
			    	    if(data.success==1) {
                    	    $("#share_tip").text("{$share['share_confirm']}");
			   	     	}else{
                            if(data.msg == null){

                                $("#share_tip").text("超过每天分享有效次数");
                            }else{

                                $("#share_tip").text(data.msg);
                            }
			    	    }
			    	    $("#share_miao").text("5秒后自动关闭");
			    	    $("#share_box").show();
			   	        djstime(5);
			    	    setTimeout(function () {
                    	    $("#share_box").hide();
                	    }, 6000);
				    });


                    $(".icon-prize-useless").hide();
                    $(".info_lost_guanzhu").hide();
                    $(".info_lost_over").hide();
                    $(".info_lost_1").hide();
                    $(".info_lost_2").hide();
                    $("#panel_box").hide();
				},
				{/if}
			});
			wx.onMenuShareTimeline({
			    title: sharedata.title,
			    desc: sharedata.desc,
			    link: sharedata.link,
			    imgUrl: sharedata.imgUrl,
			    {if !empty($share['share_cancel'])}
				// 分享取消
				cancel: function (res) {
			        $("#share_tip").text("{$share['share_cancel']}");
			        $("#share_miao").text("5秒后自动关闭");
			        $("#share_box").show();
			        djstime(5);
			        setTimeout(function () {
			            $("#share_box").hide();
			        }, 6000);
			    },
				{/if}
				{if !empty($share['share_fail'])}
				// 分享取消
			    fail: function (res) {
			        $("#share_tip").text("{$share['share_fail']}");
			        $("#share_miao").text("5秒后自动关闭");
			        $("#share_box").show();
			        djstime(5);
			        setTimeout(function () {
			            $("#share_box").hide();
			        }, 6000);
			    },
				{/if}
				{if !empty($share['share_confirm'])}
				// 分享成功
				success : function(resp) {
				    // 分享成功了，我们是不是可以做一些分享统计呢？
				    $.getJSON('{php echo $this->createMobileUrl('get_share', array('rid' => $rid,'from_user' => $page_from_user))}', function(data){
			    	    if(data.success==1) {
                    	    $("#share_tip").text("{$share['share_confirm']}");
			   	     	}else{
                            if(data.msg == null){

                                $("#share_tip").text("超过每天分享有效次数");
                            }else{

                                $("#share_tip").text(data.msg);
                            }
			    	    }
			    	    $("#share_miao").text("5秒后自动关闭");
			    	    $("#share_box").show();
			   	        djstime(5);
			    	    setTimeout(function () {
                    	    $("#share_box").hide();
                	    }, 6000);
				    });


                    $(".icon-prize-useless").hide();
                    $(".info_lost_guanzhu").hide();
                    $(".info_lost_over").hide();
                    $(".info_lost_1").hide();
                    $(".info_lost_2").hide();
                    $("#panel_box").hide();
				},
				{/if}
			});
			wx.onMenuShareQQ({
			    title: sharedata.title,
			    desc: sharedata.desc,
			    link: sharedata.link,
			    imgUrl: sharedata.imgUrl,
			    {if !empty($share['share_cancel'])}
				// 分享取消
				cancel: function (res) {
			        $("#share_tip").text("{$share['share_cancel']}");
			        $("#share_miao").text("5秒后自动关闭");
			        $("#share_box").show();
			        djstime(5);
			        setTimeout(function () {
			            $("#share_box").hide();
			        }, 6000);
			    },
				{/if}
				{if !empty($share['share_fail'])}
				// 分享取消
			    fail: function (res) {
			        $("#share_tip").text("{$share['share_fail']}");
			        $("#share_miao").text("5秒后自动关闭");
			        $("#share_box").show();
			        djstime(5);
			        setTimeout(function () {
			            $("#share_box").hide();
			        }, 6000);
			    },
				{/if}
				{if !empty($share['share_confirm'])}
				// 分享成功
				success : function(resp) {
				    // 分享成功了，我们是不是可以做一些分享统计呢？
				    $.getJSON('{php echo $this->createMobileUrl('get_share', array('rid' => $rid,'from_user' => $page_from_user))}', function(data){
			    	    if(data.success==1) {
                    	    $("#share_tip").text("{$share['share_confirm']}");
			   	     	}else{
			        	    $("#share_tip").text(data.msg);
			    	    }
			    	    $("#share_miao").text("5秒后自动关闭");
			    	    $("#share_box").show();
			   	        djstime(5);
			    	    setTimeout(function () {
                    	    $("#share_box").hide();
                	    }, 6000);
				    });
				},
				{/if}
			});
			wx.onMenuShareWeibo({
			    title: sharedata.title,
			    desc: sharedata.desc,
			    link: sharedata.link,
			    imgUrl: sharedata.imgUrl,
			    {if !empty($share['share_cancel'])}
				// 分享取消
				cancel: function (res) {
			        $("#share_tip").text("{$share['share_cancel']}");
			        $("#share_miao").text("5秒后自动关闭");
			        $("#share_box").show();
			        djstime(5);
			        setTimeout(function () {
			            $("#share_box").hide();
			        }, 6000);
			    },
				{/if}
				{if !empty($share['share_fail'])}
				// 分享取消
			    fail: function (res) {
			        $("#share_tip").text("{$share['share_fail']}");
			        $("#share_miao").text("5秒后自动关闭");
			        $("#share_box").show();
			        djstime(5);
			        setTimeout(function () {
			            $("#share_box").hide();
			        }, 6000);
			    },
				{/if}
				{if !empty($share['share_confirm'])}
				// 分享成功
				success : function(resp) {
				    // 分享成功了，我们是不是可以做一些分享统计呢？
				    $.getJSON('{php echo $this->createMobileUrl('get_share', array('rid' => $rid,'from_user' => $page_from_user))}', function(data){
			    	    if(data.success==1) {
                    	    $("#share_tip").text("{$share['share_confirm']}");
			   	     	}else{
			        	    $("#share_tip").text(data.msg);
			    	    }
			    	    $("#share_miao").text("5秒后自动关闭");
			    	    $("#share_box").show();
			   	        djstime(5);
			    	    setTimeout(function () {
                    	    $("#share_box").hide();
                	    }, 6000);
				    });
				},
				{/if}
			});

		});
	});
</script>



<!-- 图片预加载 begin --->
<script type="text/javascript">

    var gameStart = function () {

        console.log("----  预加载完毕  ----");
    };

    var imgArr = [
        '../addons/kang_bigwheel/template/images/home_bg.png',
        '../addons/kang_bigwheel/template/images/home_btn_start.png',
        '../addons/kang_bigwheel/template/images/main_bg.png',
        '../addons/kang_bigwheel/template/images/activity-inner.png',
        '../addons/kang_bigwheel/template/images/activity-lottery-6.png',
        '../addons/kang_bigwheel/template/images/info_lost_1.png',
        '../addons/kang_bigwheel/template/images/info_lost_2.png',
        '../addons/kang_bigwheel/template/images/info_lost_guanzhu.png',
        '../addons/kang_bigwheel/template/images/info_lost_over.png',
        '../addons/kang_bigwheel/template/images/main_bg.png',
        '../addons/kang_bigwheel/template/images/main_logo.png',
        '../addons/kang_bigwheel/template/images/prize_bg.png',
        '../addons/kang_bigwheel/template/images/btn_get_prize.png',
        '../addons/kang_bigwheel/template/images/prize_jiashiqi.png',
        '../addons/kang_bigwheel/template/images/prize_piao.png',
        '../addons/kang_bigwheel/template/images/prize_quan.png',
        '../addons/kang_bigwheel/template/images/prize_t.png'
    ];

    preloadimg(imgArr, gameStart);

</script>
<!-- 图片预加载 end --->

<!-- 百度统计wanyouxibu.com -->
<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?4c75a08c5ed53483840001824d223513";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

</body>
</html>
